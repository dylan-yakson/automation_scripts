[
    {
        "id": "5e6a6d77.e19104",
        "type": "tab",
        "label": "OrderApp_Sessions",
        "disabled": false,
        "info": ""
    },
    {
        "id": "34623ca.2719ac4",
        "type": "tab",
        "label": "OrderApp_API_Products",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ba7af92d.7e0a98",
        "type": "tab",
        "label": "OrderApp_API_Customers",
        "disabled": false,
        "info": ""
    },
    {
        "id": "861ea5f8.708aa8",
        "type": "tab",
        "label": "OrderApp_API_Orders",
        "disabled": false,
        "info": ""
    },
    {
        "id": "20fa09d1.2a2986",
        "type": "tab",
        "label": "OrderApp_API_Salesman",
        "disabled": true,
        "info": ""
    },
    {
        "id": "4d643218.bdf09c",
        "type": "tab",
        "label": "Salesman Analytics",
        "disabled": false,
        "info": "This flow is for the salesman anaylytics to potentially be displayed in the order app"
    },
    {
        "id": "e4db3e08.3ae77",
        "type": "tab",
        "label": "OrderApp_API_OrderSubmission",
        "disabled": true,
        "info": ""
    },
    {
        "id": "20a6f2ef.da319e",
        "type": "tab",
        "label": "OrderApp_API_QuoteSubmission",
        "disabled": false,
        "info": ""
    },
    {
        "id": "1db3bfc.a3dac4",
        "type": "tab",
        "label": "OrderApp_API_Order_PDFView",
        "disabled": false,
        "info": ""
    },
    {
        "id": "993daf64.ba03f",
        "type": "tab",
        "label": "OrderApp_API_Quote_PDFView",
        "disabled": false,
        "info": ""
    },
    {
        "id": "5a101241.a21a8c",
        "type": "tab",
        "label": "OrderApp_API_Orders_Dev",
        "disabled": false,
        "info": "Orders Flow from TestDB"
    },
    {
        "id": "3d33a84f.1ae768",
        "type": "tab",
        "label": "OrderApp_API_Order_PDFView_Dev",
        "disabled": false,
        "info": ""
    },
    {
        "id": "bfa4b585.801268",
        "type": "tab",
        "label": "OrderApp_API_OrderSubmission",
        "disabled": false,
        "info": ""
    },
    {
        "id": "27eac956.6dc1d6",
        "type": "tab",
        "label": "OrderApp_API_OrderSubmission_PRIMUS",
        "disabled": false,
        "info": ""
    },
    {
        "id": "93d64002.30cc8",
        "type": "tab",
        "label": "DispatchApp_API_Orders",
        "disabled": false,
        "info": ""
    },
    {
        "id": "f2cbf0d9.c520a",
        "type": "tab",
        "label": "DispatchApp_API_OrderSubmission",
        "disabled": false,
        "info": ""
    },
    {
        "id": "facee7fa.33b2e8",
        "type": "tab",
        "label": "DispatchApp_API_Users",
        "disabled": false,
        "info": ""
    },
    {
        "id": "64c352fe.7a49dc",
        "type": "tab",
        "label": "DispatchApp_API_Okta_SyncUsers",
        "disabled": false,
        "info": ""
    },
    {
        "id": "a1af6fb4.de437",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "fbbd1ed9.96d06",
        "type": "tab",
        "label": "OrderApp_API_Fuel_Pricing",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3846e700.384eea",
        "type": "mongodb",
        "hostname": "keyperformance-shard-00-00-909d2.mongodb.net",
        "topology": "direct",
        "connectOptions": "ssl=true&replicaSet=KeyPerformance-shard-0&readPreference=primary&connectTimeoutMS=10000&authSource=admin&authMechanism=SCRAM-SHA-1",
        "port": "27017",
        "db": "products",
        "name": "Products DB"
    },
    {
        "id": "c5ee0161.50223",
        "type": "mongodb",
        "hostname": "keyperformance-shard-00-00-909d2.mongodb.net",
        "topology": "direct",
        "connectOptions": "ssl=true&replicaSet=KeyPerformance-shard-0&readPreference=primary&connectTimeoutMS=10000&authSource=admin&authMechanism=SCRAM-SHA-1",
        "port": "27017",
        "db": "archive",
        "name": "Archive DB"
    },
    {
        "id": "700c5562.ab96fc",
        "type": "mongodb",
        "hostname": "keyperformance-shard-00-00-909d2.mongodb.net",
        "topology": "direct",
        "connectOptions": "ssl=true&replicaSet=KeyPerformance-shard-0&readPreference=primary&connectTimeoutMS=10000&authSource=admin&authMechanism=SCRAM-SHA-1",
        "port": "27017",
        "db": "customers",
        "name": "Customers DB"
    },
    {
        "id": "f76d58a.2802ea8",
        "type": "mongodb",
        "hostname": "keyperformance-shard-00-00-909d2.mongodb.net",
        "topology": "direct",
        "connectOptions": "ssl=true&replicaSet=KeyPerformance-shard-0&readPreference=primary&connectTimeoutMS=10000&authSource=admin&authMechanism=SCRAM-SHA-1",
        "port": "27017",
        "db": "test",
        "name": "Test Database"
    },
    {
        "id": "50415189.3a11b",
        "type": "mongodb",
        "hostname": "keyperformance-shard-00-00.909d2.mongodb.net:27017",
        "topology": "direct",
        "connectOptions": "ssl=true&replicaSet=KeyPerformance-shard-0&readPreference=primary&connectTimeoutMS=10000&authSource=admin&authMechanism=SCRAM-SHA-1&3t.uriVersion=3&3t.connection.name=KeyPerformance-shard-0&3t.databases=admin,test&3t.alwaysShowAuthDB=true&3t.alwaysShowDBFromUserRole=true&3t.sslTlsVersion=TLS",
        "port": "27017",
        "db": "orders",
        "name": "findOrders"
    },
    {
        "id": "35febbb2.4b1d94",
        "type": "mongodb",
        "hostname": "keyperformance-shard-00-00-909d2.mongodb.net",
        "topology": "direct",
        "connectOptions": "ssl=true&replicaSet=KeyPerformance-shard-0&readPreference=primary&connectTimeoutMS=10000&authSource=admin&authMechanism=SCRAM-SHA-1",
        "port": "27017",
        "db": "admin",
        "name": "AdminDB"
    },
    {
        "id": "6733cef8.a8ac2",
        "type": "mongodb",
        "hostname": "keyperformance-shard-00-00-909d2.mongodb.net",
        "topology": "direct",
        "connectOptions": "ssl=true&replicaSet=KeyPerformance-shard-0&readPreference=primary&connectTimeoutMS=10000&authSource=admin&authMechanism=SCRAM-SHA-1",
        "port": "27017",
        "db": "Company_Analytics",
        "name": "Analytic Database"
    },
    {
        "id": "66e7a294.1f543c",
        "type": "mongodb",
        "hostname": "keyperformance-shard-00-00-909d2.mongodb.net",
        "topology": "direct",
        "connectOptions": "ssl=true&replicaSet=KeyPerformance-shard-0&readPreference=primary&connectTimeoutMS=10000&authSource=admin&authMechanism=SCRAM-SHA-1",
        "port": "27017",
        "db": "test",
        "name": "Test Database"
    },
    {
        "id": "598f3aa.f9b8ac4",
        "type": "http in",
        "z": "5e6a6d77.e19104",
        "name": "newSession_POST",
        "url": "/api/newsession",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 20,
        "wires": [
            [
                "b12e8101.3401f"
            ]
        ]
    },
    {
        "id": "e797afd2.aa9b8",
        "type": "function",
        "z": "5e6a6d77.e19104",
        "name": "FormatInsertSessionInfo",
        "func": "let SID = msg.req.headers.sid;\nlet email = msg.req.headers.email;\nlet name = msg.req.headers.name;\nlet expiresOn = msg.req.headers.expireson;\n\n\nmsg.payload = {\n    SID,\n    email,\n    name,\n    expiresOn\n    \n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 170,
        "y": 280,
        "wires": [
            [
                "7f0b9670.761dd8",
                "367a91de.ab1e5e",
                "5eb9c74e.b70d78"
            ]
        ]
    },
    {
        "id": "d022473d.d42ac8",
        "type": "http response",
        "z": "5e6a6d77.e19104",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1520,
        "y": 540,
        "wires": []
    },
    {
        "id": "5eb9c74e.b70d78",
        "type": "debug",
        "z": "5e6a6d77.e19104",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 540,
        "wires": []
    },
    {
        "id": "cbea7c59.39946",
        "type": "http in",
        "z": "34623ca.2719ac4",
        "name": "Get products",
        "url": "/api/getProducts",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 60,
        "wires": [
            [
                "f4791bf1.2c9df8",
                "121c4283.739cad"
            ]
        ]
    },
    {
        "id": "f4791bf1.2c9df8",
        "type": "function",
        "z": "34623ca.2719ac4",
        "name": "",
        "func": "msg.payload = {}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 60,
        "wires": [
            [
                "6c608995.834c48"
            ]
        ]
    },
    {
        "id": "b40b4e72.ceefc",
        "type": "http response",
        "z": "34623ca.2719ac4",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 700,
        "y": 60,
        "wires": []
    },
    {
        "id": "121c4283.739cad",
        "type": "debug",
        "z": "34623ca.2719ac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 140,
        "wires": []
    },
    {
        "id": "6c608995.834c48",
        "type": "mongodb in",
        "z": "34623ca.2719ac4",
        "mongodb": "3846e700.384eea",
        "name": "Pull Products",
        "collection": "products",
        "operation": "find",
        "x": 450,
        "y": 60,
        "wires": [
            [
                "121c4283.739cad",
                "b40b4e72.ceefc"
            ]
        ]
    },
    {
        "id": "98854755.c5dbc8",
        "type": "http in",
        "z": "34623ca.2719ac4",
        "name": "Get Packages",
        "url": "/api/getAllPackages",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 240,
        "wires": [
            [
                "9953d70d.81ac48",
                "e61b021.0176e"
            ]
        ]
    },
    {
        "id": "9953d70d.81ac48",
        "type": "function",
        "z": "34623ca.2719ac4",
        "name": "",
        "func": "msg.payload = {}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 240,
        "wires": [
            [
                "dc903d97.2a969"
            ]
        ]
    },
    {
        "id": "19721552.c8fd7b",
        "type": "http response",
        "z": "34623ca.2719ac4",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 680,
        "y": 240,
        "wires": []
    },
    {
        "id": "e61b021.0176e",
        "type": "debug",
        "z": "34623ca.2719ac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 340,
        "wires": []
    },
    {
        "id": "dc903d97.2a969",
        "type": "mongodb in",
        "z": "34623ca.2719ac4",
        "mongodb": "3846e700.384eea",
        "name": "Pull Packages",
        "collection": "packages",
        "operation": "find",
        "x": 460,
        "y": 240,
        "wires": [
            [
                "e61b021.0176e",
                "19721552.c8fd7b"
            ]
        ]
    },
    {
        "id": "e938f8cd.884588",
        "type": "http in",
        "z": "34623ca.2719ac4",
        "name": "Get Packages for Product",
        "url": "/api/getProductPackages",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 420,
        "wires": [
            [
                "7cbc1bb8.ae8004",
                "daf929e5.b89678"
            ]
        ]
    },
    {
        "id": "7cbc1bb8.ae8004",
        "type": "function",
        "z": "34623ca.2719ac4",
        "name": "",
        "func": "let productId = msg.req.headers.id\nmsg.payload = {ID: productId}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 440,
        "wires": [
            [
                "26eb7f52.16f4f"
            ]
        ]
    },
    {
        "id": "548ce182.bc037",
        "type": "http response",
        "z": "34623ca.2719ac4",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 680,
        "y": 440,
        "wires": []
    },
    {
        "id": "daf929e5.b89678",
        "type": "debug",
        "z": "34623ca.2719ac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 540,
        "wires": []
    },
    {
        "id": "26eb7f52.16f4f",
        "type": "mongodb in",
        "z": "34623ca.2719ac4",
        "mongodb": "3846e700.384eea",
        "name": "Pull Packages",
        "collection": "packages",
        "operation": "find",
        "x": 500,
        "y": 440,
        "wires": [
            [
                "daf929e5.b89678",
                "548ce182.bc037"
            ]
        ]
    },
    {
        "id": "f4b4531b.fafac",
        "type": "catch",
        "z": "34623ca.2719ac4",
        "name": "Error - GetProductPackages",
        "scope": [
            "e938f8cd.884588",
            "7cbc1bb8.ae8004",
            "26eb7f52.16f4f"
        ],
        "uncaught": false,
        "x": 400,
        "y": 540,
        "wires": [
            [
                "548ce182.bc037"
            ]
        ]
    },
    {
        "id": "724b1a86.7befb4",
        "type": "catch",
        "z": "34623ca.2719ac4",
        "name": "Error - GetPackages",
        "scope": [
            "98854755.c5dbc8",
            "9953d70d.81ac48",
            "dc903d97.2a969"
        ],
        "uncaught": false,
        "x": 410,
        "y": 320,
        "wires": [
            [
                "19721552.c8fd7b"
            ]
        ]
    },
    {
        "id": "ef41f9e7.a17848",
        "type": "catch",
        "z": "34623ca.2719ac4",
        "name": "Error - GetProducts",
        "scope": [
            "cbea7c59.39946",
            "f4791bf1.2c9df8",
            "6c608995.834c48"
        ],
        "uncaught": false,
        "x": 430,
        "y": 140,
        "wires": [
            [
                "b40b4e72.ceefc",
                "121c4283.739cad"
            ]
        ]
    },
    {
        "id": "e9d0ac37.bcdc7",
        "type": "http in",
        "z": "ba7af92d.7e0a98",
        "name": "getCustomerAddresses",
        "url": "/api/getCustomerAddresses",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 100,
        "wires": [
            [
                "7f930058.f3665",
                "bb7a27b1.b8e408"
            ]
        ]
    },
    {
        "id": "7f930058.f3665",
        "type": "function",
        "z": "ba7af92d.7e0a98",
        "name": "",
        "func": "msg.payload = {}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 100,
        "wires": [
            [
                "19feff7e.9565c1"
            ]
        ]
    },
    {
        "id": "1c533915.056947",
        "type": "http response",
        "z": "ba7af92d.7e0a98",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1060,
        "y": 100,
        "wires": []
    },
    {
        "id": "bb7a27b1.b8e408",
        "type": "debug",
        "z": "ba7af92d.7e0a98",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 200,
        "wires": []
    },
    {
        "id": "19feff7e.9565c1",
        "type": "mongodb in",
        "z": "ba7af92d.7e0a98",
        "mongodb": "700c5562.ab96fc",
        "name": "Pull Cust Addresses",
        "collection": "customers",
        "operation": "find",
        "x": 500,
        "y": 100,
        "wires": [
            [
                "bb7a27b1.b8e408",
                "de5f24f0.063768",
                "1c533915.056947"
            ]
        ]
    },
    {
        "id": "f1bd0b3f.62d5f8",
        "type": "http in",
        "z": "ba7af92d.7e0a98",
        "name": "getCustomerNameSuggestions",
        "url": "/api/getCustomerNameSuggestions",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 440,
        "wires": [
            [
                "61dacac1.ef4554",
                "4dbb010e.c16a9"
            ]
        ]
    },
    {
        "id": "61dacac1.ef4554",
        "type": "function",
        "z": "ba7af92d.7e0a98",
        "name": "",
        "func": "let productId = msg.req.headers.id\nmsg.payload = {ID: productId}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 440,
        "wires": [
            [
                "fb52083b.233a68"
            ]
        ]
    },
    {
        "id": "ab663c76.5805",
        "type": "http response",
        "z": "ba7af92d.7e0a98",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1160,
        "y": 440,
        "wires": []
    },
    {
        "id": "4dbb010e.c16a9",
        "type": "debug",
        "z": "ba7af92d.7e0a98",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 580,
        "wires": []
    },
    {
        "id": "fb52083b.233a68",
        "type": "mongodb in",
        "z": "ba7af92d.7e0a98",
        "mongodb": "700c5562.ab96fc",
        "name": "Pull Customer Addresses",
        "collection": "customers",
        "operation": "find",
        "x": 590,
        "y": 440,
        "wires": [
            [
                "4dbb010e.c16a9",
                "7101bd7a.b9a6f4"
            ]
        ]
    },
    {
        "id": "9ee71850.7dad38",
        "type": "catch",
        "z": "ba7af92d.7e0a98",
        "name": "Error - GetProductPackages",
        "scope": [
            "f1bd0b3f.62d5f8",
            "61dacac1.ef4554",
            "fb52083b.233a68"
        ],
        "uncaught": false,
        "x": 520,
        "y": 580,
        "wires": [
            [
                "ab663c76.5805"
            ]
        ]
    },
    {
        "id": "fe22da0d.c88968",
        "type": "catch",
        "z": "ba7af92d.7e0a98",
        "name": "Error - GetProducts",
        "scope": [
            "e9d0ac37.bcdc7",
            "7f930058.f3665",
            "19feff7e.9565c1"
        ],
        "uncaught": false,
        "x": 430,
        "y": 240,
        "wires": [
            [
                "1c533915.056947"
            ]
        ]
    },
    {
        "id": "de5f24f0.063768",
        "type": "function",
        "z": "ba7af92d.7e0a98",
        "d": true,
        "name": "Format Response",
        "func": "let result = msg.payload;\n\nlet addressIDSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].customerID\n    }\n    addressIDSuggestions.push(obj);\n}\nlet addressNameSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].name\n    }\n    addressNameSuggestions.push(obj);\n}\n\nlet returnObj = {\n    nameSuggestions: addressNameSuggestions,\n    idSuggestions: addressIDSuggestions,\n    customerAddresses: result\n}\n\nmsg.payload = returnObj\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 40,
        "wires": [
            [
                "1c533915.056947"
            ]
        ]
    },
    {
        "id": "7101bd7a.b9a6f4",
        "type": "function",
        "z": "ba7af92d.7e0a98",
        "name": "Format Response",
        "func": "let result = msg.payload;\nlet addressNameSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].name\n    }\n    addressNameSuggestions.push(obj);\n}\n\nmsg.payload = addressNameSuggestions\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 360,
        "wires": [
            [
                "ab663c76.5805"
            ]
        ]
    },
    {
        "id": "72f3b170.5d3a3",
        "type": "http in",
        "z": "861ea5f8.708aa8",
        "name": "PullOrders",
        "url": "/api/pullOrders",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 60,
        "y": 80,
        "wires": [
            [
                "9834159c.03d1f8",
                "8d13d3c6.cfe0b"
            ]
        ]
    },
    {
        "id": "f3f3260e.489ec8",
        "type": "function",
        "z": "861ea5f8.708aa8",
        "name": "",
        "func": "let email = msg.req.headers.email\nmsg.payload = { \n        \"requestPayload.sales.email\" : email.toLowerCase()\n    }\nmsg.sort = {\"createdDate\":-1}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 40,
        "wires": [
            [
                "fe756780.927968",
                "9834159c.03d1f8"
            ]
        ]
    },
    {
        "id": "a6091a4e.6d9208",
        "type": "http response",
        "z": "861ea5f8.708aa8",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1200,
        "y": 100,
        "wires": []
    },
    {
        "id": "9834159c.03d1f8",
        "type": "debug",
        "z": "861ea5f8.708aa8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1090,
        "y": 220,
        "wires": []
    },
    {
        "id": "fe756780.927968",
        "type": "mongodb in",
        "z": "861ea5f8.708aa8",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders by Salesman Email",
        "collection": "orders",
        "operation": "find",
        "x": 670,
        "y": 40,
        "wires": [
            [
                "a7d8fa4d.89b328",
                "a6091a4e.6d9208"
            ]
        ]
    },
    {
        "id": "cf8c2538.8d2a78",
        "type": "catch",
        "z": "861ea5f8.708aa8",
        "name": "Error - GetProducts",
        "scope": [
            "72f3b170.5d3a3",
            "f3f3260e.489ec8",
            "fe756780.927968"
        ],
        "uncaught": false,
        "x": 1030,
        "y": 20,
        "wires": [
            [
                "a6091a4e.6d9208"
            ]
        ]
    },
    {
        "id": "a7d8fa4d.89b328",
        "type": "function",
        "z": "861ea5f8.708aa8",
        "d": true,
        "name": "Format Response",
        "func": "let result = msg.payload;\n\nlet addressIDSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].customerID\n    }\n    addressIDSuggestions.push(obj);\n}\nlet addressNameSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].name\n    }\n    addressNameSuggestions.push(obj);\n}\n\nlet returnObj = {\n    nameSuggestions: addressNameSuggestions,\n    idSuggestions: addressIDSuggestions,\n    customerAddresses: result\n}\nmsg.payload = returnObj\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 80,
        "wires": [
            [
                "a6091a4e.6d9208"
            ]
        ]
    },
    {
        "id": "8d13d3c6.cfe0b",
        "type": "switch",
        "z": "861ea5f8.708aa8",
        "name": "",
        "property": "req.headers.email",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 190,
        "y": 120,
        "wires": [
            [
                "f3f3260e.489ec8"
            ],
            [
                "a6eece0.e07bc3"
            ]
        ]
    },
    {
        "id": "a6eece0.e07bc3",
        "type": "function",
        "z": "861ea5f8.708aa8",
        "name": "Invalid Email Response",
        "func": "msg.payload = {\"Error\":\"true\",\"Message\":\"Please enter valid email\"}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 220,
        "wires": [
            [
                "26019601.0af09a"
            ]
        ]
    },
    {
        "id": "26019601.0af09a",
        "type": "http response",
        "z": "861ea5f8.708aa8",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 680,
        "y": 220,
        "wires": []
    },
    {
        "id": "7bbcd17d.09f7e",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "formattQuery",
        "func": "let salesman = msg.req.headers.email\nmsg.payload = {\"requestPayload.sales.email\" : salesman.toLowerCase()}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 800,
        "wires": [
            [
                "350301fc.d9c0ae"
            ]
        ]
    },
    {
        "id": "69460251.970f5c",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "Create All Customers List",
        "func": "let allCustomers = [];\n\nconst getLastSoldDate = (productName) => {\n    let lastDate = new Date('1900-11-15T21:04:05.310+0000');\n    for(let eachPayload in msg.payload){\n        for(let eachPayloadItem in msg.payload[eachPayload]['requestPayload']['items']['items']){\n            if(msg.payload[eachPayload]['requestPayload']['items']['items'][eachPayloadItem]['Description'] == productName){\n                if(msg.payload[eachPayload]['createdDate'] > lastDate){\n                    lastDate = msg.payload[eachPayload]['createdDate'];\n                }\n            }\n        }\n    }\n    return lastDate;\n}\n\nconst getTotalOrders = (name) => {\n    let counter = 0;\n    for(let eachPayload in msg.payload){\n        if(msg.payload[eachPayload]['requestPayload']['destination']['Customer'] == name){\n            counter++;\n        }\n    }\n    return counter;\n}\n\nconst newCustomerFormat = (fullItemList) => {\n    let itemNameStager = [];\n    for(let eachFullItem in fullItemList){\n        let newFlag = true;\n        for(let eachObject in itemNameStager){\n            if(itemNameStager[eachObject] == fullItemList[eachFullItem][\"Description\"]){\n                newFlag = false;\n                let newAmount = itemNameStager[eachObject]['timesSold'] + 1;\n                itemNameStager[eachObject]['timesSold'] = newAmount;\n            }\n        }\n        if(newFlag == true){\n            itemNameStager.push({ \"productName\" :fullItemList[eachFullItem]['Description'], \"timesSold\" : 1, \"lastSold\" : getLastSoldDate(fullItemList[eachFullItem]['Description']) }) \n        }\n       \n    }\n    return itemNameStager;\n}\n\n\nfor(let each in msg.payload){\n    let gatheredCustomers = [];\n    \n    allCustomers.map((item)=>{\n        gatheredCustomers.push(item.customer);\n    })\n    \n    if(gatheredCustomers.includes(msg.payload[each]['requestPayload']['destination']['Customer']) == false){\n        let stager = {\n            'customer' : msg.payload[each]['requestPayload']['destination']['Customer'],\n            'totalOrders' : getTotalOrders(msg.payload[each]['requestPayload']['destination']['Customer']),\n            'customerItems' : newCustomerFormat(msg.payload[each]['requestPayload']['items']['items'])\n        };\n        allCustomers.push(stager);\n    }\n    else{\n        for(let eachItem in allCustomers){\n            if(allCustomers[eachItem]['customer'] == msg.payload[each]['requestPayload']['destination']['Customer']){\n                for(let eachProduct in msg.payload[each]['requestPayload']['items']['items']){\n                    let newProductFlag = true;\n                    for(let eachProductSaved in allCustomers[eachItem]['customerItems']){\n                        if(allCustomers[eachItem]['customerItems'][eachProductSaved]['productName'] == msg.payload[each]['requestPayload']['items']['items'][eachProduct]['Description']){\n                            newProductFlag = false;\n                            let newProductAmount = allCustomers[eachItem]['customerItems'][eachProductSaved]['timesSold'] + 1;\n                            allCustomers[eachItem]['customerItems'][eachProductSaved]['timesSold'] = newProductAmount \n                        }\n                    }\n                    if(newProductFlag == true){\n                        allCustomers[eachItem]['customerItems'].push({\"productName\" : msg.payload[each]['requestPayload']['items']['items'][eachProduct]['Description'], \"timesSold\" : 1, \"lastSold\" : getLastSoldDate(msg.payload[each]['requestPayload']['items']['items'][eachProduct]['Description']) }) \n                    }\n                   \n                }\n            }\n        }\n    }\n}\n\nmsg.payload = allCustomers;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 800,
        "wires": [
            [
                "18b0a297.ffefbd",
                "958f96c5.9d0268"
            ]
        ]
    },
    {
        "id": "18b0a297.ffefbd",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 960,
        "y": 860,
        "wires": []
    },
    {
        "id": "63bc56b.fa2c9a8",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "View All Previous Customers",
        "info": "",
        "x": 710,
        "y": 740,
        "wires": []
    },
    {
        "id": "cb5cd67.be19f28",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "formattQuery",
        "func": "msg.payload['requestPayload.sales.email'] = msg.userEmail;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1040,
        "wires": [
            [
                "bad3b8e7.0c6028"
            ]
        ]
    },
    {
        "id": "2c931efa.2c17d2",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "Create All Products List",
        "func": "let allProducts = [];\n\nfor(let each in msg.payload){\n    for(let eachProduct in msg.payload[each]['requestPayload'][\"items\"]['items']){\n        if(allProducts.includes(msg.payload[each]['requestPayload'][\"items\"]['items'][eachProduct]['Description']) == false){\n            allProducts.push(msg.payload[each]['requestPayload'][\"items\"]['items'][eachProduct]['Description'])\n        }\n    }\n}\n\nmsg.previousProducts = allProducts;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1060,
        "wires": [
            [
                "945dfdc8.f48db",
                "91aa7c99.02107"
            ]
        ]
    },
    {
        "id": "945dfdc8.f48db",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "previousProducts",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 1120,
        "wires": []
    },
    {
        "id": "fe087c8d.8f7f7",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "View Previous WareHouse Items Sold",
        "info": "",
        "x": 710,
        "y": 1000,
        "wires": []
    },
    {
        "id": "5a992a3b.452ce4",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "Sort All Orders",
        "func": "let twenty21 = { \"Jan\": [],\"Feb\": [],\"Mar\": [],\"Apr\": [],\"May\": [],\"Jun\": [],\"Jul\": [],\"Aug\": [],\"Sep\": [],\"Oct\": [],\"Nov\": [],\"Dec\": []};\nlet twenty20 = { \"Jan\": [],\"Feb\": [],\"Mar\": [],\"Apr\": [],\"May\": [],\"Jun\": [],\"Jul\": [],\"Aug\": [],\"Sep\": [],\"Oct\": [],\"Nov\": [],\"Dec\": []};\nlet twenty19 = { \"Jan\": [],\"Feb\": [],\"Mar\": [],\"Apr\": [],\"May\": [],\"Jun\": [],\"Jul\": [],\"Aug\": [],\"Sep\": [],\"Oct\": [],\"Nov\": [],\"Dec\": []};\nlet twenty18 = { \"Jan\": [],\"Feb\": [],\"Mar\": [],\"Apr\": [],\"May\": [],\"Jun\": [],\"Jul\": [],\"Aug\": [],\"Sep\": [],\"Oct\": [],\"Nov\": [],\"Dec\": []};\n\nfor(let each in msg.payload){\n   let orderDate = msg.payload[each]['createdDate'];\n   let date21 = new Date(\"12/31/2020\");\n   let date20 = new Date(\"12/31/2019\");\n   let date19 = new Date(\"12/31/2018\");\n   let date18 = new Date(\"12/31/2017\");\n   if(orderDate > date21){\n       if(orderDate > new Date(\"11/30/21\")){\n          (twenty21['Dec']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"10/31/21\")){\n          (twenty21['Nov']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"09/30/21\")){\n          (twenty21['Oct']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"08/31/21\")){\n          (twenty21['Sep']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"07/31/21\")){\n          (twenty21['Aug']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"06/30/21\")){\n          (twenty21['Jul']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"05/31/21\")){\n          (twenty21['Jun']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"04/30/21\")){\n          (twenty21['May']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"03/31/21\")){\n          (twenty21['Apr']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"02/28/21\")){\n          (twenty21['Mar']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"01/31/21\")){\n          (twenty21['Feb']).push(msg.payload[each]) \n       }\n       else if(orderDate <= new Date(\"01/31/21\")){\n          (twenty21['Jan']).push(msg.payload[each]) \n       }\n       \n   }\n   else if(orderDate > date20){\n       if(orderDate > new Date(\"11/30/20\")){\n          (twenty20['Dec']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"10/31/20\")){\n          (twenty20['Nov']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"09/30/20\")){\n          (twenty20['Oct']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"08/31/20\")){\n          (twenty20['Sep']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"07/31/20\")){\n          (twenty20['Aug']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"06/30/20\")){\n          (twenty20['Jul']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"05/31/20\")){\n          (twenty20['Jun']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"04/30/20\")){\n          (twenty20['May']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"03/31/20\")){\n          (twenty20['Apr']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"02/28/20\")){\n          (twenty20['Mar']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"01/31/20\")){\n          (twenty20['Feb']).push(msg.payload[each]) \n       }\n       else if(orderDate <= new Date(\"01/31/20\")){\n          (twenty20['Jan']).push(msg.payload[each]) \n       }\n   }\n   else if(orderDate > date19){\n       if(orderDate > new Date(\"11/30/19\")){\n          (twenty19['Dec']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"10/31/19\")){\n          (twenty19['Nov']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"09/30/19\")){\n          (twenty19['Oct']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"08/31/19\")){\n          (twenty19['Sep']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"07/31/19\")){\n          (twenty19['Aug']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"06/30/19\")){\n          (twenty19['Jul']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"05/31/19\")){\n          (twenty19['Jun']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"04/30/19\")){\n          (twenty19['May']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"03/31/19\")){\n          (twenty19['Apr']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"02/28/19\")){\n          (twenty19['Mar']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"01/31/19\")){\n          (twenty19['Feb']).push(msg.payload[each]) \n       }\n       else if(orderDate <= new Date(\"01/31/19\")){\n          (twenty19['Jan']).push(msg.payload[each]) \n       }\n   }\n   else if(orderDate > date18){\n      if(orderDate > new Date(\"11/30/18\")){\n          (twenty18['Dec']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"10/31/18\")){\n          (twenty18['Nov']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"09/30/18\")){\n          (twenty18['Oct']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"08/31/18\")){\n          (twenty18['Sep']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"07/31/18\")){\n          (twenty18['Aug']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"06/30/18\")){\n          (twenty18['Jul']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"05/31/18\")){\n          (twenty18['Jun']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"04/30/18\")){\n          (twenty18['May']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"03/31/18\")){\n          (twenty18['Apr']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"02/28/18\")){\n          (twenty18['Mar']).push(msg.payload[each]) \n       }\n       else if(orderDate > new Date(\"01/31/18\")){\n          (twenty18['Feb']).push(msg.payload[each]) \n       }\n       else if(orderDate <= new Date(\"01/31/18\")){\n          (twenty18['Jan']).push(msg.payload[each]) \n       }\n   }\n}\n\nmsg.payload = [\n   { \"orders_2021\":twenty21, \"total_2021\" : (twenty21['Jan'].length + twenty21['Feb'].length + twenty21['Mar'].length + twenty21['Apr'].length + twenty21['May'].length + twenty21['Jun'].length + twenty21['Jul'].length + twenty21['Aug'].length + twenty21['Sep'].length + twenty21['Oct'].length + twenty21['Nov'].length + twenty21['Dec'].length)},\n   { \"orders_2020\":twenty20, \"total_2020\" : (twenty20['Jan'].length + twenty20['Feb'].length + twenty20['Mar'].length + twenty20['Apr'].length + twenty20['May'].length + twenty20['Jun'].length + twenty20['Jul'].length + twenty20['Aug'].length + twenty20['Sep'].length + twenty20['Oct'].length + twenty20['Nov'].length + twenty20['Dec'].length)},\n   { \"orders_2019\":twenty19, \"total_2019\" : (twenty19['Jan'].length + twenty19['Feb'].length + twenty19['Mar'].length + twenty19['Apr'].length + twenty19['May'].length + twenty19['Jun'].length + twenty19['Jul'].length + twenty19['Aug'].length + twenty19['Sep'].length + twenty19['Oct'].length + twenty19['Nov'].length + twenty19['Dec'].length)},\n   { \"orders_2018\":twenty18, \"total_2018\" : (twenty18['Jan'].length + twenty18['Feb'].length + twenty18['Mar'].length + twenty18['Apr'].length + twenty18['May'].length + twenty18['Jun'].length + twenty18['Jul'].length + twenty18['Aug'].length + twenty18['Sep'].length + twenty18['Oct'].length + twenty18['Nov'].length + twenty18['Dec'].length)},\n]\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 540,
        "wires": [
            [
                "e867582d.eb6568",
                "1f336135.a62d8f",
                "b4bcf94c.5521b8"
            ]
        ]
    },
    {
        "id": "e867582d.eb6568",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 600,
        "wires": []
    },
    {
        "id": "67add1ab.40482",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "View Orders By Month",
        "info": "",
        "x": 690,
        "y": 480,
        "wires": []
    },
    {
        "id": "9815cf53.2446d",
        "type": "file",
        "z": "4d643218.bdf09c",
        "name": "createfile",
        "filename": "C:\\Users\\Dillon Lee\\Documents\\sortedOrdersTest.txt",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1280,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "1f336135.a62d8f",
        "type": "function",
        "z": "4d643218.bdf09c",
        "d": true,
        "name": "changePayload for txt file creation",
        "func": "msg.payload = msg.sortedOrders;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 440,
        "wires": [
            [
                "9815cf53.2446d"
            ]
        ]
    },
    {
        "id": "814b7d33.6e30b",
        "type": "file",
        "z": "4d643218.bdf09c",
        "name": "createfile",
        "filename": "C:\\Users\\Dillon Lee\\Documents\\previousItemsTest.txt",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1260,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "91aa7c99.02107",
        "type": "function",
        "z": "4d643218.bdf09c",
        "d": true,
        "name": "changePayload for txt file creation",
        "func": "msg.payload = msg.previousProducts;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 1020,
        "wires": [
            [
                "814b7d33.6e30b"
            ]
        ]
    },
    {
        "id": "73d511a6.bf9c6",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "Create All Products List",
        "func": "\nlet allPrices = [];\nlet allProducts = [];\nlet mostRecent = {\n    \"price\" : \"never sold\",\n    \"mostRecentDate\" : new Date(\"2001-01-01T15:41:03.136Z\"),\n    \"customer\" : \"n/a\"\n};\n\n\nfor(let each in msg.payload){\n    for(let eachProduct in msg.payload[each]['requestPayload'][\"items\"]['items']){\n      \n           let stager = {\n               \"productName\" : \"\",\n               \"soldPrice\" : \"\",\n               \"referenceDate\" : \"\",\n               \"packageType\" : \"\"\n           };\n           stager.productName = msg.payload[each]['requestPayload'][\"items\"]['items'][eachProduct][\"Description\"];\n           stager.soldPrice = msg.payload[each]['requestPayload'][\"items\"]['items'][eachProduct][\"PricePerGal\"];\n           stager.referenceDate = msg.payload[each]['createdDate'];\n           stager.packageType = msg.payload[each]['requestPayload'][\"items\"]['items'][eachProduct][\"Package\"];\n           \n           allProducts.push(stager);\n           if(new Date(stager.referenceDate) > mostRecent.mostRecentDate && stager.packageType == msg.packageRequest){\n               mostRecent.price = stager.soldPrice;\n               mostRecent.mostRecentDate = new Date(stager.referenceDate)\n               mostRecent.customer = msg.payload[each]['requestPayload']['destination']['Customer'];\n           }\n           allPrices.push(stager.soldPrice)\n       \n    }\n}\n\nlet runningTotal = 0;\nfor(let each in allPrices){\n    runningTotal = runningTotal + parseFloat(allPrices[each])\n}\nlet averagePrice = runningTotal/(allPrices.length);\n\nmsg.finalResult = allProducts;\nmsg.mostRecentResult = mostRecent;\nmsg.productAverage = averagePrice;\n\nmsg.payload = mostRecent;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 1380,
        "wires": [
            [
                "474d9028.86de3",
                "3ffae9bd.da8476"
            ]
        ]
    },
    {
        "id": "474d9028.86de3",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 1520,
        "wires": []
    },
    {
        "id": "fb05f39f.3fca9",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "View Previous Sold Price for an Item & Packaging",
        "info": "",
        "x": 720,
        "y": 1320,
        "wires": []
    },
    {
        "id": "f9e2dd1b.9253c",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "Create All Products List",
        "func": "let janAvg = [];\n\nfor(let each in msg.payload){\n    for(let eachItem in msg.payload[each]['requestPayload']['items']['items']){\n        if(msg.payload[each]['requestPayload']['items']['items'][eachItem]['ID'] == msg.productID && msg.payload[each]['requestPayload']['items']['items'][eachItem]['Package'] == msg.productPackaging){\n            if((msg.payload[each]['createdDate']).slice(5,7) == '01'){\n                janAvg.push(msg.payload[each])\n            }\n        }\n    }\n}\n\nmsg.jan = janAvg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 1700,
        "wires": [
            [
                "e59595b2.2269e8"
            ]
        ]
    },
    {
        "id": "552b4e2a.1e8b8",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "Company Price Avg By Month",
        "info": "",
        "x": 660,
        "y": 1640,
        "wires": []
    },
    {
        "id": "150612e2.b9e5bd",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "enter product & packaging",
        "props": [
            {
                "p": "productID",
                "v": "1002",
                "vt": "str"
            },
            {
                "p": "productPackaging",
                "v": "TOTE",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 330,
        "y": 1700,
        "wires": [
            [
                "42a3d1cc.7bcad"
            ]
        ]
    },
    {
        "id": "e59595b2.2269e8",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "jan",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 1680,
        "wires": []
    },
    {
        "id": "39521ca3.3492f4",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders",
        "collection": "orders",
        "operation": "find",
        "x": 630,
        "y": 1460,
        "wires": [
            [
                "73d511a6.bf9c6"
            ]
        ]
    },
    {
        "id": "42a3d1cc.7bcad",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders",
        "collection": "orders",
        "operation": "find",
        "x": 570,
        "y": 1760,
        "wires": [
            [
                "f9e2dd1b.9253c"
            ]
        ]
    },
    {
        "id": "7f37f8e4.698fb8",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "enter salesman email",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "userEmail",
                "v": "b.young@kppetro.com",
                "vt": "str"
            },
            {
                "p": "sortedOrders",
                "v": "{}",
                "vt": "json"
            },
            {
                "p": "previousCustomers",
                "v": "{}",
                "vt": "json"
            },
            {
                "p": "previousProducts",
                "v": "{}",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"requestPayload.sales.email\":\"\"}",
        "payloadType": "json",
        "x": 260,
        "y": 1060,
        "wires": [
            [
                "cb5cd67.be19f28"
            ]
        ]
    },
    {
        "id": "bad3b8e7.0c6028",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders",
        "collection": "orders",
        "operation": "find",
        "x": 590,
        "y": 1100,
        "wires": [
            [
                "2c931efa.2c17d2"
            ]
        ]
    },
    {
        "id": "350301fc.d9c0ae",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders",
        "collection": "orders",
        "operation": "find",
        "x": 610,
        "y": 860,
        "wires": [
            [
                "69460251.970f5c"
            ]
        ]
    },
    {
        "id": "4e4d82f9.7c387c",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders",
        "collection": "orders",
        "operation": "find",
        "x": 590,
        "y": 580,
        "wires": [
            [
                "5a992a3b.452ce4"
            ]
        ]
    },
    {
        "id": "1c00322c.685e8e",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "Get Prices per product per package",
        "url": "/api/getProductPreviousPrices",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 240,
        "y": 1300,
        "wires": [
            [
                "2760c770.49f568"
            ]
        ]
    },
    {
        "id": "2760c770.49f568",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "",
        "func": "let salesman = msg.req.headers.email\nlet productId = msg.req.headers.id\nlet packageType = msg.req.headers.package\nmsg.payload = {\"requestPayload.sales.email\" : salesman , \"requestPayload.items.items.ID\" : productId,  \"requestPayload.items.items.Package\" : packageType}\nmsg.packageRequest = packageType;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 1360,
        "wires": [
            [
                "39521ca3.3492f4"
            ]
        ]
    },
    {
        "id": "3ffae9bd.da8476",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1060,
        "y": 1340,
        "wires": []
    },
    {
        "id": "61596873.a3eae8",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "manual test",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"requestPayload.sales.email\" : \"d.lee@kppetro.com\" , \"requestPayload.items.items.ID\" : \"1813\",  \"requestPayload.items.items.Package\" : \"Each\"}",
        "payloadType": "json",
        "x": 230,
        "y": 1420,
        "wires": [
            [
                "39521ca3.3492f4"
            ]
        ]
    },
    {
        "id": "cea2b7e2.f171e8",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "Get all previously sold-to customers",
        "url": "/api/getPreviousCustomers",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 780,
        "wires": [
            [
                "7bbcd17d.09f7e"
            ]
        ]
    },
    {
        "id": "958f96c5.9d0268",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1060,
        "y": 780,
        "wires": []
    },
    {
        "id": "f85305e.f391cf8",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "Get all previous months data",
        "url": "/api/getPreviousMonths",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 560,
        "wires": [
            [
                "51db7e88.b7a84"
            ]
        ]
    },
    {
        "id": "51db7e88.b7a84",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "formattQuery",
        "func": "let salesman = msg.req.headers.email\nmsg.payload = {\"requestPayload.sales.email\" : salesman.toLowerCase()}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 520,
        "wires": [
            [
                "4e4d82f9.7c387c"
            ]
        ]
    },
    {
        "id": "b4bcf94c.5521b8",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1020,
        "y": 520,
        "wires": []
    },
    {
        "id": "7f0b9670.761dd8",
        "type": "mongodb out",
        "z": "5e6a6d77.e19104",
        "mongodb": "35febbb2.4b1d94",
        "name": "InsertSession",
        "collection": "sessions",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "store",
        "x": 460,
        "y": 340,
        "wires": []
    },
    {
        "id": "dc45c3d1.5decd",
        "type": "catch",
        "z": "5e6a6d77.e19104",
        "name": "Throw Error",
        "scope": [
            "e797afd2.aa9b8",
            "7f0b9670.761dd8"
        ],
        "uncaught": false,
        "x": 1430,
        "y": 300,
        "wires": [
            [
                "7ef4c1c5.862e2"
            ]
        ]
    },
    {
        "id": "7ef4c1c5.862e2",
        "type": "function",
        "z": "5e6a6d77.e19104",
        "name": "FormatErrorObject",
        "func": "let errorMessage = msg.error.message || ''\n\nmsg.payload = {\n    Error: \"true\",\n    Message: errorMessage\n    \n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 380,
        "wires": [
            [
                "d022473d.d42ac8"
            ]
        ]
    },
    {
        "id": "a9c55dde.3427b",
        "type": "function",
        "z": "5e6a6d77.e19104",
        "name": "FormatCheckIfSuccessfulQuery",
        "func": "msg.payload = {\n        email: msg.req.headers.email,\n        SID: msg.req.headers.sid\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 400,
        "wires": [
            [
                "f15ba82b.4b27e8"
            ]
        ]
    },
    {
        "id": "4b4b42cb.546abc",
        "type": "debug",
        "z": "5e6a6d77.e19104",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 20,
        "wires": []
    },
    {
        "id": "e5bc17b.a3ec0e8",
        "type": "debug",
        "z": "5e6a6d77.e19104",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1130,
        "y": 360,
        "wires": []
    },
    {
        "id": "367a91de.ab1e5e",
        "type": "delay",
        "z": "5e6a6d77.e19104",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 440,
        "y": 280,
        "wires": [
            [
                "a9c55dde.3427b"
            ]
        ]
    },
    {
        "id": "f15ba82b.4b27e8",
        "type": "mongodb in",
        "z": "5e6a6d77.e19104",
        "mongodb": "35febbb2.4b1d94",
        "name": "FindSessionInfo",
        "collection": "sessions",
        "operation": "find",
        "x": 900,
        "y": 460,
        "wires": [
            [
                "e5bc17b.a3ec0e8",
                "1f0f0397.c5c09c"
            ]
        ]
    },
    {
        "id": "b12e8101.3401f",
        "type": "function",
        "z": "5e6a6d77.e19104",
        "name": "FormatCheckIfSuccessfulQuery",
        "func": "msg.headers = msg.req.headers;\nmsg.payload = {\n        email: msg.req.headers.email,\n        SID: msg.req.headers.sid\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 130,
        "y": 100,
        "wires": [
            [
                "bc0cbf4b.b8444"
            ]
        ]
    },
    {
        "id": "bc0cbf4b.b8444",
        "type": "mongodb in",
        "z": "5e6a6d77.e19104",
        "mongodb": "35febbb2.4b1d94",
        "name": "FindSessionInfo",
        "collection": "sessions",
        "operation": "find",
        "x": 360,
        "y": 80,
        "wires": [
            [
                "b1d6a636.07e798"
            ]
        ]
    },
    {
        "id": "b1d6a636.07e798",
        "type": "switch",
        "z": "5e6a6d77.e19104",
        "name": "DoesSessionAlreadyExist",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 610,
        "y": 40,
        "wires": [
            [
                "b4cb190d.9f7f18"
            ],
            [
                "e797afd2.aa9b8"
            ]
        ]
    },
    {
        "id": "b4cb190d.9f7f18",
        "type": "function",
        "z": "5e6a6d77.e19104",
        "name": "CheckIfExpired",
        "func": "let expDate = msg.payload[0].expiresOn\nvar dates = {\n    convert:function(d) {\n        // Converts the date in d to a date-object. The input can be:\n        //   a date object: returned without modification\n        //  an array      : Interpreted as [year,month,day]. NOTE: month is 0-11.\n        //   a number     : Interpreted as number of milliseconds\n        //                  since 1 Jan 1970 (a timestamp) \n        //   a string     : Any format supported by the javascript engine, like\n        //                  \"YYYY/MM/DD\", \"MM/DD/YYYY\", \"Jan 31 2009\" etc.\n        //  an object     : Interpreted as an object with year, month and date\n        //                  attributes.  **NOTE** month is 0-11.\n        return (\n            d.constructor === Date ? d :\n            d.constructor === Array ? new Date(d[0],d[1],d[2]) :\n            d.constructor === Number ? new Date(d) :\n            d.constructor === String ? new Date(d) :\n            typeof d === \"object\" ? new Date(d.year,d.month,d.date) :\n            NaN\n        );\n    },\n    compare:function(a,b) {\n        // Compare two dates (could be of any type supported by the convert\n        // function above) and returns:\n        //  -1 : if a < b\n        //   0 : if a = b\n        //   1 : if a > b\n        // NaN : if a or b is an illegal date\n        // NOTE: The code inside isFinite does an assignment (=).\n        return (\n            isFinite(a=this.convert(a).valueOf()) &&\n            isFinite(b=this.convert(b).valueOf()) ?\n            (a>b)-(a<b) :\n            NaN\n        );\n    },\n    inRange:function(d,start,end) {\n        // Checks if date in d is between dates in start and end.\n        // Returns a boolean or NaN:\n        //    true  : if d is between start and end (inclusive)\n        //    false : if d is before start or after end\n        //    NaN   : if one or more of the dates is illegal.\n        // NOTE: The code inside isFinite does an assignment (=).\n       return (\n            isFinite(d=this.convert(d).valueOf()) &&\n            isFinite(start=this.convert(start).valueOf()) &&\n            isFinite(end=this.convert(end).valueOf()) ?\n            start <= d && d <= end :\n            NaN\n        );\n    }\n}\nlet date = new Date(Date.now())\nlet formattedExpDate = new Date(expDate);\nconsole.log(date.toISOString());\nconsole.log(formattedExpDate.toISOString());\n\n// -1 if a < b\n// 0 if a = b\n// 1 if a > b\nlet result = dates.compare(formattedExpDate,date)\nmsg.payload = {}\nswitch(result){\n    case -1:\n        msg.payload.expired = true;\n        break;\n    case 0:\n        msg.payload.expired = true;\n        break;\n    case 1:\n        msg.payload.expired = false;\n        break;\n}\n \nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 40,
        "wires": [
            [
                "4b4b42cb.546abc",
                "57d391b.151c87"
            ]
        ]
    },
    {
        "id": "57d391b.151c87",
        "type": "switch",
        "z": "5e6a6d77.e19104",
        "name": "IsSessionExpired",
        "property": "payload.expired",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 160,
        "wires": [
            [
                "f9614254.dc96f",
                "7a8b78bf.29c778"
            ],
            [
                "a9c55dde.3427b",
                "7a8b78bf.29c778"
            ]
        ]
    },
    {
        "id": "1f0f0397.c5c09c",
        "type": "function",
        "z": "5e6a6d77.e19104",
        "name": "FormatResponse",
        "func": "msg.payload = msg.payload[0]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 480,
        "wires": [
            [
                "d022473d.d42ac8"
            ]
        ]
    },
    {
        "id": "7a8b78bf.29c778",
        "type": "debug",
        "z": "5e6a6d77.e19104",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1090,
        "y": 220,
        "wires": []
    },
    {
        "id": "f9614254.dc96f",
        "type": "function",
        "z": "5e6a6d77.e19104",
        "name": "FormatClearOldSessionInfo",
        "func": "let SID = msg.req.headers.sid;\nlet email = msg.req.headers.email;\n\nmsg.payload = {\n    SID: SID,\n    email: email\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 80,
        "wires": [
            [
                "7eb9ac76.c725a4",
                "57b5d0f4.527a"
            ]
        ]
    },
    {
        "id": "7eb9ac76.c725a4",
        "type": "mongodb out",
        "z": "5e6a6d77.e19104",
        "mongodb": "35febbb2.4b1d94",
        "name": "DeleteExpiredSession",
        "collection": "sessions",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "delete",
        "x": 1480,
        "y": 20,
        "wires": []
    },
    {
        "id": "57b5d0f4.527a",
        "type": "delay",
        "z": "5e6a6d77.e19104",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1460,
        "y": 100,
        "wires": [
            [
                "e797afd2.aa9b8"
            ]
        ]
    },
    {
        "id": "96f3d068.50f9a",
        "type": "http in",
        "z": "e4db3e08.3ae77",
        "name": "submitOrder",
        "url": "/api/submitOrder",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 70,
        "y": 60,
        "wires": [
            [
                "3c336342.87399c",
                "e9ab25ec.e32368"
            ]
        ]
    },
    {
        "id": "be11c396.5b0df",
        "type": "http response",
        "z": "e4db3e08.3ae77",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1520,
        "y": 280,
        "wires": []
    },
    {
        "id": "f7aa7348.549c7",
        "type": "catch",
        "z": "e4db3e08.3ae77",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 1710,
        "y": 100,
        "wires": [
            [
                "460d7aa0.469344"
            ]
        ]
    },
    {
        "id": "1b610de7.cfad72",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Get Order Number ",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 160,
        "wires": [
            [
                "f275a6c6.1f6d38"
            ]
        ]
    },
    {
        "id": "34910043.c893a",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 180,
        "wires": [
            [
                "2e030343.c81d4c"
            ]
        ]
    },
    {
        "id": "17d4dcbc.bbeba3",
        "type": "catch",
        "z": "e4db3e08.3ae77",
        "name": "Error - WarehouseOrder",
        "scope": [
            "b8c1042f.3bc318",
            "2f6d584.e3e2aa8",
            "68473089.a1f94",
            "8e88d13e.fab83",
            "8076105a.7e787",
            "47d98265.20719c"
        ],
        "uncaught": false,
        "x": 1700,
        "y": 140,
        "wires": [
            [
                "8f6aa2f4.eaa4c"
            ]
        ]
    },
    {
        "id": "f275a6c6.1f6d38",
        "type": "mongodb in",
        "z": "e4db3e08.3ae77",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetOrderNumber",
        "collection": "counter",
        "operation": "find",
        "x": 810,
        "y": 120,
        "wires": [
            [
                "1ee1fb48.a1e0b5",
                "73b928c.997a8d8"
            ]
        ]
    },
    {
        "id": "73b928c.997a8d8",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.payload[0].sequence_value\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = `DJ0F${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.orderNumber = `DJ0W${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.order;\nmsg.orderToEmail = msg.order.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 120,
        "wires": [
            [
                "34910043.c893a"
            ]
        ]
    },
    {
        "id": "8f6aa2f4.eaa4c",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 140,
        "wires": []
    },
    {
        "id": "b8c1042f.3bc318",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Generate BlendSheet PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\nfunction createBlendSheet(invoice, path) {\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n  generateHeader(doc);\n  generateCustomerInformation(doc, invoice);\n  generateInvoiceTable(doc, invoice);\n  generateFooter(doc,invoice);\n\n  doc.end();\n  doc.pipe(fs.createWriteStream(path));\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Blending\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    // .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 150);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop + 15)\n    .text(formatDate(new Date()), 150, customerInformationTop + 15)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop + 30)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop + 30\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop + 45)\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop + 45)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 60)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 60)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 30)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 30)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -15)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -5\n    )\n    \n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop + 40) \n    .text(invoice.origin.address, 380, customerInformationTop + 40)\n\n    .moveDown();\n\n  generateHr(doc, 290);\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Quantity\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description,\n      item.Package,\n      item.Quantity\n    //   formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n//   generateTableRow(\n//     doc,\n//     subtotalPosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     \"Subtotal\",\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n\n  const paidToDatePosition = subtotalPosition + 20;\n  // generateTableRow(\n  //   doc,\n  //   paidToDatePosition,\n  //   \"\",\n  //   \"\",\n  //   \"\",\n  //   \"Paid To Date\",\n  //   \"\",\n  //   formatCurrency(invoice.paid)\n  // );\n\n  const duePosition = paidToDatePosition + 25;\n//   doc.font(\"Helvetica-Bold\");\n//   generateTableRow(\n//     doc,\n//     duePosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     `${sentenceCase(invoice.sales.quoteType)} Total`,\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n//   doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 120, y)\n    .text(package, 300, y)\n    .text(unitCost, 320, y, { width: 90, align: \"right\" })\n    .text(quantity, 370, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\n\ntry{\n   createBlendSheet(msg.payload, msg.blendfilename )\n    msg.order = msg.payload\n    msg.payload = \"New Order Created\"\n    msg.topic = \"TEST - NEW ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.blendfilename), path: msg.blendfilename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 600,
        "y": 540,
        "wires": [
            [
                "2f6d584.e3e2aa8"
            ]
        ]
    },
    {
        "id": "2f6d584.e3e2aa8",
        "type": "e-mail",
        "z": "e4db3e08.3ae77",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com,d.lee@kppetro.com",
        "dname": "Send Blendsheet Email",
        "x": 1150,
        "y": 540,
        "wires": []
    },
    {
        "id": "68473089.a1f94",
        "type": "e-mail",
        "z": "e4db3e08.3ae77",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Warehouse Confirmation Email",
        "x": 1190,
        "y": 580,
        "wires": []
    },
    {
        "id": "8e88d13e.fab83",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Order Created'\n    msg.topic = \"TEST - NEW ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 580,
        "y": 580,
        "wires": [
            [
                "41184938.e40068"
            ]
        ]
    },
    {
        "id": "8076105a.7e787",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Format Warehouse Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\ninvoiceData.items.items = invoiceData.items.items.map(item => {\n    if(item.Package.packName){\n        let package = item.Package.packName;\n        item.Package = package\n    }\n    return item;\n    \n})\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 500,
        "wires": [
            [
                "47d98265.20719c",
                "9424483a.2718d8"
            ]
        ]
    },
    {
        "id": "47d98265.20719c",
        "type": "mongodb out",
        "z": "e4db3e08.3ae77",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Warehouse Order Into MongoDB",
        "collection": "orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 930,
        "y": 500,
        "wires": []
    },
    {
        "id": "9424483a.2718d8",
        "type": "delay",
        "z": "e4db3e08.3ae77",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1280,
        "y": 400,
        "wires": [
            [
                "be11c396.5b0df"
            ]
        ]
    },
    {
        "id": "1ee1fb48.a1e0b5",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Format Counter Update",
        "func": "let count = msg.payload[0].sequence_value\nmsg.query = {_id: 'orderid'}\nmsg.payload = { $set: {sequence_value: Number(count) + 1}};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 60,
        "wires": [
            [
                "76306416.a17ccc"
            ]
        ]
    },
    {
        "id": "76306416.a17ccc",
        "type": "mongodb out",
        "z": "e4db3e08.3ae77",
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Order Counter",
        "collection": "counter",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 1320,
        "y": 60,
        "wires": []
    },
    {
        "id": "460d7aa0.469344",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 100,
        "wires": []
    },
    {
        "id": "3c336342.87399c",
        "type": "switch",
        "z": "e4db3e08.3ae77",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 290,
        "y": 200,
        "wires": [
            [
                "1b610de7.cfad72"
            ],
            [
                "f4b0a6c6.3f2768"
            ]
        ]
    },
    {
        "id": "f4b0a6c6.3f2768",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 280,
        "wires": [
            [
                "be11c396.5b0df"
            ]
        ]
    },
    {
        "id": "2e030343.c81d4c",
        "type": "switch",
        "z": "e4db3e08.3ae77",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 310,
        "y": 300,
        "wires": [
            [
                "92db5a64.9b2d98",
                "6d857b82.11fb24"
            ],
            [
                "b8c1042f.3bc318",
                "8076105a.7e787",
                "8e88d13e.fab83"
            ],
            [
                "f4b0a6c6.3f2768"
            ]
        ]
    },
    {
        "id": "92db5a64.9b2d98",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Fuel Order Created'\n    msg.topic = \"TEST - NEW FUEL ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 590,
        "y": 360,
        "wires": [
            [
                "df11faa3.ab5f28"
            ]
        ]
    },
    {
        "id": "5ce7658d.814cec",
        "type": "e-mail",
        "z": "e4db3e08.3ae77",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Fuel Confirmation Email",
        "x": 1170,
        "y": 360,
        "wires": []
    },
    {
        "id": "6d857b82.11fb24",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Format Fuel Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 400,
        "wires": [
            [
                "def934f1.cd4298",
                "9424483a.2718d8"
            ]
        ]
    },
    {
        "id": "def934f1.cd4298",
        "type": "mongodb out",
        "z": "e4db3e08.3ae77",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Fuel Order Into MongoDB",
        "collection": "Fuel_Orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 890,
        "y": 420,
        "wires": []
    },
    {
        "id": "50e5fc7.ec48404",
        "type": "catch",
        "z": "e4db3e08.3ae77",
        "name": "Error - FuelOrder",
        "scope": [
            "92db5a64.9b2d98",
            "5ce7658d.814cec",
            "6d857b82.11fb24",
            "def934f1.cd4298"
        ],
        "uncaught": false,
        "x": 1720,
        "y": 180,
        "wires": [
            [
                "4a9e8307.aebd6c"
            ]
        ]
    },
    {
        "id": "4a9e8307.aebd6c",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 180,
        "wires": []
    },
    {
        "id": "ff277ad3.588328",
        "type": "http in",
        "z": "20a6f2ef.da319e",
        "name": "submitQuote",
        "url": "/api/submitQuote",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 70,
        "y": 60,
        "wires": [
            [
                "cfbaf4f9.709be8"
            ]
        ]
    },
    {
        "id": "d4c9f2f6.3bc46",
        "type": "http response",
        "z": "20a6f2ef.da319e",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1480,
        "y": 360,
        "wires": []
    },
    {
        "id": "52b0af52.b6a04",
        "type": "catch",
        "z": "20a6f2ef.da319e",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 1270,
        "y": 80,
        "wires": [
            [
                "ce5b32f3.1b891"
            ]
        ]
    },
    {
        "id": "b4e59b92.9c1ed8",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Get Order Number ",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 100,
        "wires": [
            [
                "13b0f968.05efc7"
            ]
        ]
    },
    {
        "id": "6715ef03.1a3b9",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: PurchaseOrderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 220,
        "wires": [
            [
                "c98c3c46.bf79c"
            ]
        ]
    },
    {
        "id": "c7299629.ebed18",
        "type": "catch",
        "z": "20a6f2ef.da319e",
        "name": "Error - WarehouseOrder",
        "scope": [
            "a9b8cac.ec62938",
            "594d3f10.ccc1d",
            "15d6148c.eb477b",
            "d63c3335.78419",
            "e58fee4c.e5c07",
            "d13749c5.37e368"
        ],
        "uncaught": false,
        "x": 1260,
        "y": 140,
        "wires": [
            [
                "dbc5dc99.c518",
                "d4c9f2f6.3bc46"
            ]
        ]
    },
    {
        "id": "13b0f968.05efc7",
        "type": "mongodb in",
        "z": "20a6f2ef.da319e",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetOrderNumber",
        "collection": "quoteCounter",
        "operation": "find",
        "x": 710,
        "y": 100,
        "wires": [
            [
                "ca6e2f9c.01eaa",
                "84a500a0.f3664"
            ]
        ]
    },
    {
        "id": "84a500a0.f3664",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.payload[0].sequence_value\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = `DJ0F${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Quote.pdf`\n} else {\n    msg.orderNumber = `DJ0W${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Quote.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Quote_BlendSheet.pdf`\nmsg.payload = msg.order;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 220,
        "wires": [
            [
                "6715ef03.1a3b9"
            ]
        ]
    },
    {
        "id": "dbc5dc99.c518",
        "type": "debug",
        "z": "20a6f2ef.da319e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 140,
        "wires": []
    },
    {
        "id": "15d6148c.eb477b",
        "type": "e-mail",
        "z": "20a6f2ef.da319e",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com",
        "dname": "Send Warehouse Confirmation Email",
        "x": 790,
        "y": 560,
        "wires": []
    },
    {
        "id": "d63c3335.78419",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Quote Created'\n    msg.topic = \"TEST - NEW WAREHOUSE QUOTE CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 440,
        "y": 560,
        "wires": [
            [
                "15d6148c.eb477b"
            ]
        ]
    },
    {
        "id": "e58fee4c.e5c07",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Format Warehouse Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 520,
        "wires": [
            [
                "d13749c5.37e368",
                "d6bf49c4.3928f8"
            ]
        ]
    },
    {
        "id": "d13749c5.37e368",
        "type": "mongodb out",
        "z": "20a6f2ef.da319e",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Warehouse Order Into MongoDB",
        "collection": "quotes",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 770,
        "y": 500,
        "wires": []
    },
    {
        "id": "d6bf49c4.3928f8",
        "type": "delay",
        "z": "20a6f2ef.da319e",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1060,
        "y": 440,
        "wires": [
            [
                "d4c9f2f6.3bc46"
            ]
        ]
    },
    {
        "id": "ca6e2f9c.01eaa",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Format Counter Update",
        "func": "let count = msg.payload[0].sequence_value\nmsg.query = {_id: 'orderid'}\nmsg.payload = { $set: {sequence_value: Number(count) + 1}};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 100,
        "wires": [
            [
                "7d41b4c3.a477cc"
            ]
        ]
    },
    {
        "id": "7d41b4c3.a477cc",
        "type": "mongodb out",
        "z": "20a6f2ef.da319e",
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Quote Counter",
        "collection": "quoteCounter",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 980,
        "y": 200,
        "wires": []
    },
    {
        "id": "ce5b32f3.1b891",
        "type": "debug",
        "z": "20a6f2ef.da319e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 80,
        "wires": []
    },
    {
        "id": "cfbaf4f9.709be8",
        "type": "switch",
        "z": "20a6f2ef.da319e",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 230,
        "y": 140,
        "wires": [
            [
                "b4e59b92.9c1ed8"
            ],
            [
                "2ca7810a.2cb9de"
            ]
        ]
    },
    {
        "id": "2ca7810a.2cb9de",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 280,
        "wires": [
            [
                "d4c9f2f6.3bc46"
            ]
        ]
    },
    {
        "id": "c98c3c46.bf79c",
        "type": "switch",
        "z": "20a6f2ef.da319e",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 190,
        "y": 340,
        "wires": [
            [
                "6f001c8.b0ac4e4",
                "8d67300c.6ef31"
            ],
            [
                "e58fee4c.e5c07",
                "d63c3335.78419"
            ],
            [
                "2ca7810a.2cb9de"
            ]
        ]
    },
    {
        "id": "6f001c8.b0ac4e4",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Fuel Quote Created'\n    msg.topic = \"TEST - NEW FUEL QUOTE CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 450,
        "y": 380,
        "wires": [
            [
                "8e695882.9b9c18"
            ]
        ]
    },
    {
        "id": "8e695882.9b9c18",
        "type": "e-mail",
        "z": "20a6f2ef.da319e",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com",
        "dname": "Send Fuel Confirmation Email",
        "x": 710,
        "y": 380,
        "wires": []
    },
    {
        "id": "8d67300c.6ef31",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Format Fuel Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 420,
        "wires": [
            [
                "ecf4ebe0.0810f8",
                "d6bf49c4.3928f8"
            ]
        ]
    },
    {
        "id": "ecf4ebe0.0810f8",
        "type": "mongodb out",
        "z": "20a6f2ef.da319e",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Fuel Order Into MongoDB",
        "collection": "quotes",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 710,
        "y": 420,
        "wires": []
    },
    {
        "id": "7eaf103e.fb472",
        "type": "catch",
        "z": "20a6f2ef.da319e",
        "name": "Error - FuelOrder",
        "scope": [
            "6f001c8.b0ac4e4",
            "8e695882.9b9c18",
            "8d67300c.6ef31",
            "ecf4ebe0.0810f8"
        ],
        "uncaught": false,
        "x": 1240,
        "y": 200,
        "wires": [
            [
                "72f3ddc1.ddea44",
                "d4c9f2f6.3bc46"
            ]
        ]
    },
    {
        "id": "72f3ddc1.ddea44",
        "type": "debug",
        "z": "20a6f2ef.da319e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 200,
        "wires": []
    },
    {
        "id": "41184938.e40068",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\n\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 840,
        "y": 580,
        "wires": [
            [
                "68473089.a1f94"
            ]
        ]
    },
    {
        "id": "df11faa3.ab5f28",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 860,
        "y": 360,
        "wires": [
            [
                "5ce7658d.814cec"
            ]
        ]
    },
    {
        "id": "bff48b8f.b8dbc8",
        "type": "comment",
        "z": "20a6f2ef.da319e",
        "name": "Give time for mongodb to throw error if failed",
        "info": "",
        "x": 1170,
        "y": 480,
        "wires": []
    },
    {
        "id": "e9ab25ec.e32368",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 40,
        "wires": []
    },
    {
        "id": "161442ca.f6331d",
        "type": "http in",
        "z": "1db3bfc.a3dac4",
        "name": "pullPDF",
        "url": "/api/pullPDF",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 50,
        "y": 160,
        "wires": [
            [
                "39c1a0c8.a95cd",
                "830794a2.e8cfe8"
            ]
        ]
    },
    {
        "id": "3e2566ee.cadd7a",
        "type": "http response",
        "z": "1db3bfc.a3dac4",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1820,
        "y": 460,
        "wires": []
    },
    {
        "id": "5f96b2ef.ef6efc",
        "type": "catch",
        "z": "1db3bfc.a3dac4",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 930,
        "y": 20,
        "wires": [
            [
                "394fea8f.26e536"
            ]
        ]
    },
    {
        "id": "2a73e0c3.4ef6e",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 460,
        "wires": [
            [
                "ee829549.6ca398"
            ]
        ]
    },
    {
        "id": "cc8b0fe4.75da1",
        "type": "catch",
        "z": "1db3bfc.a3dac4",
        "name": "Error - WarehouseOrder",
        "scope": [
            "2826e2ee.95740e",
            "4618b585.ec040c",
            "4d1b2c46.fd7d14",
            "fb9e2fe1.3fc93",
            "8a14d479.990468",
            "ff11391d.38e388"
        ],
        "uncaught": false,
        "x": 920,
        "y": 60,
        "wires": [
            [
                "aca71b46.86a708"
            ]
        ]
    },
    {
        "id": "fde1a036.34971",
        "type": "mongodb in",
        "z": "1db3bfc.a3dac4",
        "mongodb": "c5ee0161.50223",
        "name": "GetFuelOrderByOrderNumber",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 890,
        "y": 380,
        "wires": [
            [
                "f25f1b86.78fa98"
            ]
        ]
    },
    {
        "id": "f25f1b86.78fa98",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.payload[0].requestPayload;\nmsg.orderToEmail = msg.payload.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 460,
        "wires": [
            [
                "2a73e0c3.4ef6e"
            ]
        ]
    },
    {
        "id": "aca71b46.86a708",
        "type": "debug",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 60,
        "wires": []
    },
    {
        "id": "fb9e2fe1.3fc93",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 390, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 390, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      390,\n      customerInformationTop -10\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.payload = msg.filename;\n    msg.order = msg.payload\n    return msg;\n        \n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 660,
        "y": 660,
        "wires": [
            [
                "22f4a634.f53b1a",
                "93307bbb.443508"
            ]
        ]
    },
    {
        "id": "394fea8f.26e536",
        "type": "debug",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 20,
        "wires": []
    },
    {
        "id": "39c1a0c8.a95cd",
        "type": "switch",
        "z": "1db3bfc.a3dac4",
        "name": "Check If Order number Exists in headers",
        "property": "req.headers.ordernumber",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 300,
        "y": 200,
        "wires": [
            [
                "bcc34536.3432f8"
            ],
            [
                "7eef2ae4.f0a3e4"
            ]
        ]
    },
    {
        "id": "c049eb81.cef918",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.statusCode = 400;\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply the orderNumber to Pull its PDF\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 300,
        "wires": [
            [
                "3e2566ee.cadd7a"
            ]
        ]
    },
    {
        "id": "8a66c8e8.5397d8",
        "type": "switch",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 290,
        "y": 340,
        "wires": [
            [
                "14d9c2eb.bf727d"
            ],
            [
                "8343238f.c919b"
            ],
            [
                "c049eb81.cef918"
            ]
        ]
    },
    {
        "id": "ee829549.6ca398",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n\treturn msg;\t\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1190,
        "y": 420,
        "wires": [
            [
                "8b895c75.de4af",
                "bd3f0d50.77d3c",
                "42669b7f.97a204"
            ]
        ]
    },
    {
        "id": "2c0e0667.cc8cfa",
        "type": "catch",
        "z": "1db3bfc.a3dac4",
        "name": "Error - FuelOrder",
        "scope": [
            "ee829549.6ca398",
            "61d68c6.ebf0d74",
            "c49fc058.3bf37",
            "dbed8433.02ae28"
        ],
        "uncaught": false,
        "x": 940,
        "y": 100,
        "wires": [
            [
                "b3819289.1154b"
            ]
        ]
    },
    {
        "id": "b3819289.1154b",
        "type": "debug",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 100,
        "wires": []
    },
    {
        "id": "830794a2.e8cfe8",
        "type": "debug",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 140,
        "wires": []
    },
    {
        "id": "bcc34536.3432f8",
        "type": "switch",
        "z": "1db3bfc.a3dac4",
        "name": "Check If Order Type Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 240,
        "wires": [
            [
                "8a66c8e8.5397d8"
            ],
            [
                "c049eb81.cef918"
            ]
        ]
    },
    {
        "id": "7eef2ae4.f0a3e4",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "No OrderNumber",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.statusCode = 400;\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply the orderNumber to Pull its PDF\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 200,
        "wires": [
            [
                "3e2566ee.cadd7a"
            ]
        ]
    },
    {
        "id": "8343238f.c919b",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "Get Order Number ",
        "func": "let order = msg.req.headers.ordernumber\nmsg.orderNo = order\nmsg.orderNumber = order;\nmsg.payload = {\"PO\": order };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 130,
        "y": 540,
        "wires": [
            [
                "e3a8c573.fefe28"
            ]
        ]
    },
    {
        "id": "d91a989a.914138",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 660,
        "wires": [
            [
                "fb9e2fe1.3fc93"
            ]
        ]
    },
    {
        "id": "e3a8c573.fefe28",
        "type": "mongodb in",
        "z": "1db3bfc.a3dac4",
        "mongodb": "c5ee0161.50223",
        "name": "GetWarehouseOrderByOrderNumber",
        "collection": "orders",
        "operation": "find",
        "x": 410,
        "y": 580,
        "wires": [
            [
                "6a2984a1.cd5ecc"
            ]
        ]
    },
    {
        "id": "6a2984a1.cd5ecc",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.payload[0].requestPayload;\nmsg.orderToEmail = msg.payload.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 100,
        "y": 660,
        "wires": [
            [
                "d91a989a.914138"
            ]
        ]
    },
    {
        "id": "14d9c2eb.bf727d",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "Get Order Number ",
        "func": "let order = msg.req.headers.ordernumber\nmsg.orderNo = order\nmsg.payload = {\"PO\": order };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 380,
        "wires": [
            [
                "fde1a036.34971"
            ]
        ]
    },
    {
        "id": "8b895c75.de4af",
        "type": "debug",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1590,
        "y": 300,
        "wires": []
    },
    {
        "id": "22f4a634.f53b1a",
        "type": "debug",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1130,
        "y": 560,
        "wires": []
    },
    {
        "id": "773c222a.505d6c",
        "type": "file",
        "z": "1db3bfc.a3dac4",
        "name": "Delete New PDF File After Transmition",
        "filename": "",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "delete",
        "encoding": "none",
        "x": 1670,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "bd3f0d50.77d3c",
        "type": "delay",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1420,
        "y": 660,
        "wires": [
            [
                "773c222a.505d6c"
            ]
        ]
    },
    {
        "id": "71f91490.79d07c",
        "type": "http in",
        "z": "993daf64.ba03f",
        "name": "/api/pullQuotePDF",
        "url": "/api/pullQuotePDF",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 60,
        "wires": [
            [
                "2bec8630.ae848a",
                "ebc5b9a9.a72658"
            ]
        ]
    },
    {
        "id": "7ca1a576.b559ec",
        "type": "http response",
        "z": "993daf64.ba03f",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1680,
        "y": 340,
        "wires": []
    },
    {
        "id": "2814084b.7169f8",
        "type": "catch",
        "z": "993daf64.ba03f",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 1790,
        "y": 120,
        "wires": [
            [
                "14caec9.b8e8f13"
            ]
        ]
    },
    {
        "id": "8e6e1fb6.28c39",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 380,
        "wires": [
            [
                "e58b0c5d.0d0d1"
            ]
        ]
    },
    {
        "id": "f3e918ab.32cf78",
        "type": "catch",
        "z": "993daf64.ba03f",
        "name": "Error - WarehouseOrder",
        "scope": [
            "2826e2ee.95740e",
            "4618b585.ec040c",
            "4d1b2c46.fd7d14",
            "3d4d0e6c.26f192",
            "8a14d479.990468",
            "ff11391d.38e388"
        ],
        "uncaught": false,
        "x": 1780,
        "y": 160,
        "wires": [
            [
                "585c88f1.6be9f8"
            ]
        ]
    },
    {
        "id": "709d261a.c3a2c8",
        "type": "mongodb in",
        "z": "993daf64.ba03f",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetFuelQuoteByOrderNumber",
        "collection": "Fuel_Quotes",
        "operation": "find",
        "x": 970,
        "y": 300,
        "wires": [
            [
                "50a39da8.5f21c4",
                "23b0a265.364d6e"
            ]
        ]
    },
    {
        "id": "50a39da8.5f21c4",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.payload[0].requestPayload;\nmsg.orderToEmail = msg.payload.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 380,
        "wires": [
            [
                "8e6e1fb6.28c39"
            ]
        ]
    },
    {
        "id": "585c88f1.6be9f8",
        "type": "debug",
        "z": "993daf64.ba03f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2010,
        "y": 160,
        "wires": []
    },
    {
        "id": "3d4d0e6c.26f192",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Order Created'\n    msg.topic = \"TEST - NEW ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 740,
        "y": 580,
        "wires": [
            [
                "3b500280.71cd1e",
                "6ed344ec.f8fdcc"
            ]
        ]
    },
    {
        "id": "14caec9.b8e8f13",
        "type": "debug",
        "z": "993daf64.ba03f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2010,
        "y": 120,
        "wires": []
    },
    {
        "id": "2bec8630.ae848a",
        "type": "switch",
        "z": "993daf64.ba03f",
        "name": "Check If Order number Exists in headers",
        "property": "req.headers.ordernumber",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 360,
        "y": 220,
        "wires": [
            [
                "29a35217.18f78e"
            ],
            [
                "c112ba07.274e48"
            ]
        ]
    },
    {
        "id": "a25a042.01164f8",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply the orderNumber to Pull its PDF\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 140,
        "wires": [
            [
                "7ca1a576.b559ec"
            ]
        ]
    },
    {
        "id": "c1d785c0.7b8f08",
        "type": "switch",
        "z": "993daf64.ba03f",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 510,
        "y": 300,
        "wires": [
            [
                "27362cc1.448634"
            ],
            [
                "885868c2.4b9108"
            ],
            [
                "a25a042.01164f8"
            ]
        ]
    },
    {
        "id": "e58b0c5d.0d0d1",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Fuel Order Created'\n    msg.topic = \"TEST - NEW FUEL ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1290,
        "y": 380,
        "wires": [
            [
                "6ed344ec.f8fdcc",
                "23b0a265.364d6e",
                "5377cc4.9b3e434"
            ]
        ]
    },
    {
        "id": "f64b67a4.39ace8",
        "type": "catch",
        "z": "993daf64.ba03f",
        "name": "Error - FuelOrder",
        "scope": [
            "e58b0c5d.0d0d1",
            "61d68c6.ebf0d74",
            "c49fc058.3bf37",
            "dbed8433.02ae28"
        ],
        "uncaught": false,
        "x": 1800,
        "y": 200,
        "wires": [
            [
                "c947b7b5.466368"
            ]
        ]
    },
    {
        "id": "c947b7b5.466368",
        "type": "debug",
        "z": "993daf64.ba03f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2010,
        "y": 200,
        "wires": []
    },
    {
        "id": "ebc5b9a9.a72658",
        "type": "debug",
        "z": "993daf64.ba03f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 370,
        "y": 60,
        "wires": []
    },
    {
        "id": "29a35217.18f78e",
        "type": "switch",
        "z": "993daf64.ba03f",
        "name": "Check If Order Type Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 730,
        "y": 100,
        "wires": [
            [
                "c1d785c0.7b8f08"
            ],
            [
                "a25a042.01164f8"
            ]
        ]
    },
    {
        "id": "c112ba07.274e48",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "No OrderNumber",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply the orderNumber to Pull its PDF\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 220,
        "wires": [
            [
                "7ca1a576.b559ec"
            ]
        ]
    },
    {
        "id": "885868c2.4b9108",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "Get Order Number ",
        "func": "let order = msg.req.headers.ordernumber\nmsg.orderNo = order\nmsg.orderNumber = order;\nmsg.payload = {\"PO\": order };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 460,
        "wires": [
            [
                "71a9a815.de7a88"
            ]
        ]
    },
    {
        "id": "f359ef74.32d87",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 580,
        "wires": [
            [
                "3d4d0e6c.26f192"
            ]
        ]
    },
    {
        "id": "71a9a815.de7a88",
        "type": "mongodb in",
        "z": "993daf64.ba03f",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetWarehouseQuotesByOrderNumber",
        "collection": "quotes",
        "operation": "find",
        "x": 490,
        "y": 500,
        "wires": [
            [
                "36aa7969.7e5456",
                "3b500280.71cd1e"
            ]
        ]
    },
    {
        "id": "36aa7969.7e5456",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.payload[0].requestPayload;\nmsg.orderToEmail = msg.payload.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 580,
        "wires": [
            [
                "f359ef74.32d87"
            ]
        ]
    },
    {
        "id": "27362cc1.448634",
        "type": "function",
        "z": "993daf64.ba03f",
        "name": "Get Order Number ",
        "func": "let order = msg.req.headers.ordernumber\nmsg.orderNo = order\nmsg.payload = {\"PO\": order };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 300,
        "wires": [
            [
                "709d261a.c3a2c8"
            ]
        ]
    },
    {
        "id": "23b0a265.364d6e",
        "type": "debug",
        "z": "993daf64.ba03f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 280,
        "wires": []
    },
    {
        "id": "3b500280.71cd1e",
        "type": "debug",
        "z": "993daf64.ba03f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 500,
        "wires": []
    },
    {
        "id": "6ed344ec.f8fdcc",
        "type": "file in",
        "z": "993daf64.ba03f",
        "name": "",
        "filename": "",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "base64",
        "x": 1510,
        "y": 420,
        "wires": [
            [
                "7ca1a576.b559ec"
            ]
        ]
    },
    {
        "id": "a3430c0.6485af8",
        "type": "file",
        "z": "993daf64.ba03f",
        "name": "Delete New PDF File After Transmition",
        "filename": "",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "delete",
        "encoding": "none",
        "x": 1750,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "5377cc4.9b3e434",
        "type": "delay",
        "z": "993daf64.ba03f",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1480,
        "y": 480,
        "wires": [
            [
                "a3430c0.6485af8"
            ]
        ]
    },
    {
        "id": "39ac212f.e3768e",
        "type": "catch",
        "z": "1db3bfc.a3dac4",
        "name": "Error - File Read",
        "scope": [
            "723de4b4.47b1dc"
        ],
        "uncaught": false,
        "x": 940,
        "y": 140,
        "wires": [
            [
                "8305ad06.d84ce"
            ]
        ]
    },
    {
        "id": "8305ad06.d84ce",
        "type": "debug",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 140,
        "wires": []
    },
    {
        "id": "213afdd8.163d12",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "Pull Base64 PDF",
        "func": "let message = false;\nfs.readFile(msg.payload,  (err,data) => {\n    if(err){throw err};\n    let encodedData =  data.toString('base64');\n    // Respond with base64 encoded pdf of order\n    message = encodedData\n    msg.payload = encodedData\n    return msg;\n})\nlet getbase64pdf = async () => {\n    let pdfData = await fs.readFileSync(msg.payload);\n    let encodedData = pdfData.toString('base64');\n    msg.payload = encodedData\n    return encodedData\n}\n    return getbase64pdf().then(result=>{\n        msg.payload = result;\n        return msg\n    });\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1030,
        "y": 660,
        "wires": [
            [
                "3e2566ee.cadd7a",
                "bd3f0d50.77d3c",
                "22f4a634.f53b1a"
            ]
        ]
    },
    {
        "id": "edcb8344.c14c4",
        "type": "function",
        "z": "1db3bfc.a3dac4",
        "name": "Pull Base64 PDF",
        "func": "let message = false;\n\nlet getbase64pdf = async () => {\n    let pdfData = await fs.readFileSync(msg.payload);\n    let encodedData = pdfData.toString('base64');\n    msg.payload = encodedData\n    return encodedData\n}\n    return getbase64pdf().then(result=>{\n        msg.payload = result;\n        return msg\n    });\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1550,
        "y": 460,
        "wires": [
            [
                "3e2566ee.cadd7a",
                "8b895c75.de4af"
            ]
        ]
    },
    {
        "id": "93307bbb.443508",
        "type": "delay",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 860,
        "y": 660,
        "wires": [
            [
                "213afdd8.163d12"
            ]
        ]
    },
    {
        "id": "42669b7f.97a204",
        "type": "delay",
        "z": "1db3bfc.a3dac4",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1400,
        "y": 420,
        "wires": [
            [
                "edcb8344.c14c4"
            ]
        ]
    },
    {
        "id": "c4e478b5.fd8b28",
        "type": "http in",
        "z": "861ea5f8.708aa8",
        "name": "pullFuelOrders",
        "url": "/api/pullFuelOrders",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 400,
        "wires": [
            [
                "e73a672d.d95c08",
                "7a8370b8.c45f6"
            ]
        ]
    },
    {
        "id": "734a1591.e3284c",
        "type": "function",
        "z": "861ea5f8.708aa8",
        "name": "",
        "func": "let email = msg.req.headers.email\nmsg.payload = { \n        \"requestPayload.sales.email\" : email.toLowerCase()\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 400,
        "wires": [
            [
                "f2f00e2e.c144f"
            ]
        ]
    },
    {
        "id": "290016b.79defea",
        "type": "http response",
        "z": "861ea5f8.708aa8",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1540,
        "y": 460,
        "wires": []
    },
    {
        "id": "e73a672d.d95c08",
        "type": "debug",
        "z": "861ea5f8.708aa8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 580,
        "wires": []
    },
    {
        "id": "f2f00e2e.c144f",
        "type": "mongodb in",
        "z": "861ea5f8.708aa8",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders by Salesman Email",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 830,
        "y": 400,
        "wires": [
            [
                "bca257a9.1baf58",
                "290016b.79defea",
                "e73a672d.d95c08"
            ]
        ]
    },
    {
        "id": "9a3e4520.4e0f38",
        "type": "catch",
        "z": "861ea5f8.708aa8",
        "name": "Error - GetProducts",
        "scope": [
            "c4e478b5.fd8b28",
            "734a1591.e3284c",
            "f2f00e2e.c144f"
        ],
        "uncaught": false,
        "x": 1370,
        "y": 380,
        "wires": [
            [
                "290016b.79defea"
            ]
        ]
    },
    {
        "id": "bca257a9.1baf58",
        "type": "function",
        "z": "861ea5f8.708aa8",
        "d": true,
        "name": "Format Response",
        "func": "let result = msg.payload;\n\nlet addressIDSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].customerID\n    }\n    addressIDSuggestions.push(obj);\n}\nlet addressNameSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].name\n    }\n    addressNameSuggestions.push(obj);\n}\n\nlet returnObj = {\n    nameSuggestions: addressNameSuggestions,\n    idSuggestions: addressIDSuggestions,\n    customerAddresses: result\n}\nmsg.payload = returnObj\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1270,
        "y": 480,
        "wires": [
            [
                "290016b.79defea"
            ]
        ]
    },
    {
        "id": "7a8370b8.c45f6",
        "type": "switch",
        "z": "861ea5f8.708aa8",
        "name": "",
        "property": "req.headers.email",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 290,
        "y": 480,
        "wires": [
            [
                "734a1591.e3284c"
            ],
            [
                "c555f407.240a38"
            ]
        ]
    },
    {
        "id": "c555f407.240a38",
        "type": "function",
        "z": "861ea5f8.708aa8",
        "name": "Invalid Email Response",
        "func": "msg.payload = {\"Error\":\"true\",\"Message\":\"Please enter valid email\"}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 540,
        "wires": [
            [
                "6b33bdaa.5f99d4"
            ]
        ]
    },
    {
        "id": "6b33bdaa.5f99d4",
        "type": "http response",
        "z": "861ea5f8.708aa8",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 880,
        "y": 540,
        "wires": []
    },
    {
        "id": "7b70adb2.e5b6a4",
        "type": "http in",
        "z": "5a101241.a21a8c",
        "name": "PullOrders",
        "url": "/api/pullOrdersDev",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 80,
        "y": 160,
        "wires": [
            [
                "7be9d643.d56578",
                "71d6a341.6464ec"
            ]
        ]
    },
    {
        "id": "42000290.12369c",
        "type": "function",
        "z": "5a101241.a21a8c",
        "name": "",
        "func": "let email = msg.req.headers.email\nmsg.payload = { \n        \"requestPayload.sales.email\" : email.toLowerCase()\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 120,
        "wires": [
            [
                "af77bb9a.0e8ce8",
                "7be9d643.d56578"
            ]
        ]
    },
    {
        "id": "18415e43.4b9a42",
        "type": "http response",
        "z": "5a101241.a21a8c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1220,
        "y": 180,
        "wires": []
    },
    {
        "id": "7be9d643.d56578",
        "type": "debug",
        "z": "5a101241.a21a8c",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 300,
        "wires": []
    },
    {
        "id": "af77bb9a.0e8ce8",
        "type": "mongodb in",
        "z": "5a101241.a21a8c",
        "mongodb": "f76d58a.2802ea8",
        "name": "Pull Orders by Salesman Email",
        "collection": "orders",
        "operation": "find",
        "x": 690,
        "y": 120,
        "wires": [
            [
                "58fdecfe.3bffd4",
                "18415e43.4b9a42"
            ]
        ]
    },
    {
        "id": "89403abc.3339c8",
        "type": "catch",
        "z": "5a101241.a21a8c",
        "name": "Error - GetProducts",
        "scope": [
            "7b70adb2.e5b6a4",
            "42000290.12369c",
            "af77bb9a.0e8ce8"
        ],
        "uncaught": false,
        "x": 1050,
        "y": 100,
        "wires": [
            [
                "18415e43.4b9a42"
            ]
        ]
    },
    {
        "id": "58fdecfe.3bffd4",
        "type": "function",
        "z": "5a101241.a21a8c",
        "d": true,
        "name": "Format Response",
        "func": "let result = msg.payload;\n\nlet addressIDSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].customerID\n    }\n    addressIDSuggestions.push(obj);\n}\nlet addressNameSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].name\n    }\n    addressNameSuggestions.push(obj);\n}\n\nlet returnObj = {\n    nameSuggestions: addressNameSuggestions,\n    idSuggestions: addressIDSuggestions,\n    customerAddresses: result\n}\nmsg.payload = returnObj\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 160,
        "wires": [
            [
                "18415e43.4b9a42"
            ]
        ]
    },
    {
        "id": "71d6a341.6464ec",
        "type": "switch",
        "z": "5a101241.a21a8c",
        "name": "",
        "property": "req.headers.email",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 210,
        "y": 200,
        "wires": [
            [
                "42000290.12369c"
            ],
            [
                "803d6152.ac376"
            ]
        ]
    },
    {
        "id": "803d6152.ac376",
        "type": "function",
        "z": "5a101241.a21a8c",
        "name": "Invalid Email Response",
        "func": "msg.payload = {\"Error\":\"true\",\"Message\":\"Please enter valid email\"}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 300,
        "wires": [
            [
                "b607c090.22ecd"
            ]
        ]
    },
    {
        "id": "b607c090.22ecd",
        "type": "http response",
        "z": "5a101241.a21a8c",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 700,
        "y": 300,
        "wires": []
    },
    {
        "id": "fa70f998.9a15e8",
        "type": "http in",
        "z": "5a101241.a21a8c",
        "name": "pullFuelOrders",
        "url": "/api/pullFuelOrdersDev",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 480,
        "wires": [
            [
                "bef7f2a5.21eac",
                "d831df69.05a48"
            ]
        ]
    },
    {
        "id": "898f3d8c.66b5f",
        "type": "function",
        "z": "5a101241.a21a8c",
        "name": "",
        "func": "let email = msg.req.headers.email\nmsg.payload = { \n        \"requestPayload.sales.email\" : email.toLowerCase()\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 480,
        "wires": [
            [
                "23937bf1.b4c5d4"
            ]
        ]
    },
    {
        "id": "6508c82e.8962f8",
        "type": "http response",
        "z": "5a101241.a21a8c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1560,
        "y": 540,
        "wires": []
    },
    {
        "id": "bef7f2a5.21eac",
        "type": "debug",
        "z": "5a101241.a21a8c",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 660,
        "wires": []
    },
    {
        "id": "23937bf1.b4c5d4",
        "type": "mongodb in",
        "z": "5a101241.a21a8c",
        "mongodb": "f76d58a.2802ea8",
        "name": "Pull Orders by Salesman Email",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 850,
        "y": 480,
        "wires": [
            [
                "96450ca0.01e5a",
                "6508c82e.8962f8",
                "bef7f2a5.21eac"
            ]
        ]
    },
    {
        "id": "fa1a0ecf.03783",
        "type": "catch",
        "z": "5a101241.a21a8c",
        "name": "Error - GetProducts",
        "scope": [
            "fa70f998.9a15e8",
            "898f3d8c.66b5f",
            "23937bf1.b4c5d4"
        ],
        "uncaught": false,
        "x": 1390,
        "y": 460,
        "wires": [
            [
                "6508c82e.8962f8"
            ]
        ]
    },
    {
        "id": "96450ca0.01e5a",
        "type": "function",
        "z": "5a101241.a21a8c",
        "d": true,
        "name": "Format Response",
        "func": "let result = msg.payload;\n\nlet addressIDSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].customerID\n    }\n    addressIDSuggestions.push(obj);\n}\nlet addressNameSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].name\n    }\n    addressNameSuggestions.push(obj);\n}\n\nlet returnObj = {\n    nameSuggestions: addressNameSuggestions,\n    idSuggestions: addressIDSuggestions,\n    customerAddresses: result\n}\nmsg.payload = returnObj\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 560,
        "wires": [
            [
                "6508c82e.8962f8"
            ]
        ]
    },
    {
        "id": "d831df69.05a48",
        "type": "switch",
        "z": "5a101241.a21a8c",
        "name": "",
        "property": "req.headers.email",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 310,
        "y": 560,
        "wires": [
            [
                "898f3d8c.66b5f"
            ],
            [
                "971c4fb3.3a5a4"
            ]
        ]
    },
    {
        "id": "971c4fb3.3a5a4",
        "type": "function",
        "z": "5a101241.a21a8c",
        "name": "Invalid Email Response",
        "func": "msg.payload = {\"Error\":\"true\",\"Message\":\"Please enter valid email\"}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 620,
        "wires": [
            [
                "1fa0b4a1.fa66db"
            ]
        ]
    },
    {
        "id": "1fa0b4a1.fa66db",
        "type": "http response",
        "z": "5a101241.a21a8c",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 900,
        "y": 620,
        "wires": []
    },
    {
        "id": "9ff1a801.0a3168",
        "type": "http in",
        "z": "3d33a84f.1ae768",
        "name": "pullPDF",
        "url": "/api/pullPDFDev",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 160,
        "wires": [
            [
                "a477fa0c.6fecd8",
                "c622db00.7c77c8"
            ]
        ]
    },
    {
        "id": "a05dba05.9f7858",
        "type": "http response",
        "z": "3d33a84f.1ae768",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1860,
        "y": 460,
        "wires": []
    },
    {
        "id": "51ff7edd.54e6c",
        "type": "catch",
        "z": "3d33a84f.1ae768",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 970,
        "y": 20,
        "wires": [
            [
                "1d65449f.f7478b"
            ]
        ]
    },
    {
        "id": "90354cc3.9fac6",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 460,
        "wires": [
            [
                "9ddea37f.841b3"
            ]
        ]
    },
    {
        "id": "4b538f15.e868",
        "type": "catch",
        "z": "3d33a84f.1ae768",
        "name": "Error - WarehouseOrder",
        "scope": [
            "2826e2ee.95740e",
            "4618b585.ec040c",
            "4d1b2c46.fd7d14",
            "bf18ddc4.700f8",
            "8a14d479.990468",
            "ff11391d.38e388"
        ],
        "uncaught": false,
        "x": 960,
        "y": 60,
        "wires": [
            [
                "edf7e66a.15d108"
            ]
        ]
    },
    {
        "id": "680eef67.68733",
        "type": "mongodb in",
        "z": "3d33a84f.1ae768",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetFuelOrderByOrderNumber",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 930,
        "y": 380,
        "wires": [
            [
                "b0f88127.9ae94"
            ]
        ]
    },
    {
        "id": "b0f88127.9ae94",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.payload[0].requestPayload;\nmsg.orderToEmail = msg.payload.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 460,
        "wires": [
            [
                "90354cc3.9fac6"
            ]
        ]
    },
    {
        "id": "edf7e66a.15d108",
        "type": "debug",
        "z": "3d33a84f.1ae768",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1190,
        "y": 60,
        "wires": []
    },
    {
        "id": "bf18ddc4.700f8",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHoAAAB6CAYAAABwWUfkAAAACXBIWXMAAAsSAAALEgHS3X78AAAWRElEQVR4nO1dXWwc13U+d3aXnJCSVxKXlVLAoCIHLpoWJQMUyIMDcAK3sNE+iEUKBOiL6CJhgdaIqPTJAVpRDdqXPoguVARRW4h6CdK4ramiKJr+wCsgeWgRwORD+9LEFmGgkeWVxJVEarjDmVucM2eGw+Xu/N07q1mKH7AgLXN3Z+4399zzf4SUEoYZptWYAYDo6ywALNvN1nKe2zKtxip/xiYANAFgDQDu2M3W2jCv09ARzcTOAYAFALP4b2LUAKgI/wUA8vHuut1szeT47BMA8FDUqwAeADgeSFcCOLRGbSaeXsNG/FAQbVqNOSYXX3VhGgCjBoiaABgx9v+xB+Dd3cHfPmM3W3cyfs88VMQN4/TIwf/Z8UDuSP6JTwFsAADu/pVhIL1agmvoCd65i0RuRdRp15oGEMlxwP+ND4Aj8aHIKr6tvp8/YoAg/isgPADZ8abA9i5K271oWo2A9OWsD9egUModzefkeTFWSUduF+SWC7KdXXybVmPTmByp04OS5fu2XQDbA2nTTr+UVz8oEtlWcHC4gySLE9XMJCP4PdOm1Tib9j10PBiQmWT6PrzWUzXg925m/oABoKxEr0nHy/9uVMr8RZ/L8K45YVbyfyfCV9pKeV6XlmhetNwgsQ8wn+H9c5BDeoTo+A9mWRWzUhLNi9UOFi8PsojvQGznOSYCSP/BvJ37AwpGabVuEt87clb0sHRSIRDfjvzQtBqJ7zjMYhtKTnQTHG8WzZm8MFBBclMeAZXsSlgUbFs3lT6kQJR7RzsSlJY/4i0rFMix+5zuaHYnrrC5sWg3W1nNjjVaPK/EKmOAXdrN7TzOEl6nwK26WNQlFrKE7NVqQk2ch5q4gL/zDWUBPRhSQSEbFMg1CnAn6z3yOq0J05iGikAPW551SgXtRAcki7HKtDE5AsbECCpF01nINq3GEjlN0J89CNGrCDFKRwTe4xr75RMRWacpdLbgWkFNzPI6pXb0pIVWFygFBQBuYPRHjO9XouTmLroKMQJk9bM1TathkbiviCn6DBW79hmAXK+Pd/G4uc3HVb/7xIdhRRyv1sXx7OuUB9qIDklGt+VYb025303wE7wCBsyK8Sp03/xQwaMwKZEOADe79ROVdVKBFqLTXHx4E37Aoc2RKQxeoJi+SP5iJFhVVHu+ckTnpicBdv37k14YVw5BEbEAGO40wA99Vg31Q82RIB/totnV5qjWkmk1FsGAq+KFFOu07SLh2shWJjoLyQH4JvC/2mLU8MVXd1w5LVzp27Ad/umGSQJr/MLdtBlj+uBZeYKzSs7yf1NwQ9Q4NDqSn3iMaMn2Ll5XG71vrLNkWSctZCsRzWfNu1lIDkAhPU9mfh8BycUFxPCgv0vXu7I/lCJIfJRYkdcU6QsUMq3kIl0+dn2dI2sI9DGd+8pk5yY61BpPVOu5yMoDzO544gZx33W201eLDvbzvc5T4MNA0jUdMynBZzYmN8zkfYhzEc1P/FovrbEIkAjbot3bDs71Z5XJwZYBkn6BzD+VYycD5AMHH/B13tmZyc5MdODJQTsZRXah6Hjg4fnmE7zMSk0pAvv8sC+FhONaFLnD8aS738G1uGk3W1nCr4Q8RC+jF4cM/KIeZDyD27v4BJeO4G7sI3wcRXq10HXxPu7gb2/YzdZKlrfmIbrQsznidLjFNmgpk+26wSIdN8G0cbJaiDjnszqX+M57RuNNvZdH2+4LdDRsOsEunrebrVU9HzxYsPv2Mu3uur6jTVX7VtG6yX5mH22uzwjhSPAeOCia0HU4V1YxnRYs9VahJqbIblbc3DrsaVU7eh4MuJHFCdANuolHJKrfLjJMN2iEYVoDziuvj+9c+pLdbOVObNDhGcObuUA7O6PWGbmJzMrFsICUVwMuUrZL1nMbJR1q2p76+ujyda9g3DmLmIqIozmVJ3UYkMdNrJNk0By9aopRY1ZM1BL/VrfDfhiQiWy0me/t4M9cNnMv6LQBzqYRTc8jyeCnMOOufIP0kaScdYyi+WupLdtEC9EUfsNkgQR3KAUi/DN5/nkiOQCR7cEl9nDF/i2bZufZlFWGMtGsXS4l2owYn910gBWvobSRdYAK8Dy46eFaxKXDVYTvZcteEdoTOnb0MsWU49J+8Mzxb+zmYdWus4DOXUeu84PfF5SOVRHTfL4rQdWORsfA+0lOE/Jbb7m5uhAcVrAkvCPq1Xp3ft2+tdvTac6qOJJUd/QyaZBxJOO5vEX5T1q0x8MCJm2e/Pox1SSUYjVq1DlwkhsHdjTZxH656VqkWcuBrA0uTHvX+LnR/o8LiuxPOngjpSwOLwOw6F+MGudjzVIM17ZIzB9o18HRsxnOhpnhvi4H1nsf0WGzFoytutysBbVD/4nb6CJ/RdSrU7Fi50hkJyIU4QnRQI5c3eadbUWIrZPiNsppSn4W6obdbO3LDe8mehFq4iqduVFgfNjhLEpM58EidSGgZ1OXAHuxUyUf7fOAsElOXIwf1/OTjk8a2tg1wy8c6M5Y3XO2fD5qwnZ/7HzPpwqfGNNPm0ERY5wZhQMPQxcwrIZ5zUckJ4MsEVducC54b1QE4DGJa4+VHWEKUzeDRlgCvNj1zz5Y1k+nro6I+zOUANt00UoKxHOGJbm1G29bp1WdfQ73lQZF3zpHMl5D3lNkNw9FdkgZwF6z+F2dErRZDahHvWr7iNaSLXK0m1WwxGunDPaVh7s6SvSs0JDnJLdJ9tw+2s3ZwWd1m/PW1eCL7/07mrZ40HFPEfxEPvduTgWsgIZdzXVl00GpchCJsLTsZptqn9rd/mzTanwFAD4d996sDhXTanwRAH4177UOCD+zm62/zfhVy9L2LgrVTg9BWw9X4q5eDYmGUQ3xDV/k9IpMvSWOV6f7vY2lQGqiTatxCWriW8KsjOe80sGg44H565PfA0f+lJ1M7yQRj0eeaTXWpe1Oq+pMuKvltruP6FmhQ2zv9CU6vuY5Q/sK02r8MdTEFR3ZlcWj4jfb8eAl2fFeAtv7smk13gKAa3az9dcxX98E25sGVeXY55S8kgZHoNQTzvdcpYU5SEyr8S9irHKl0CqRImD4Jg+6lo3TI+ir+Cu8F9NqTPX5tlUdChlvXuppblAKkA7buRNq29pzsnFBTKvxQ1GvvlZ4vVfRQC8jerZOVF8DgH/tRXboTVRt1MObF51h+NuMqGooDiuooRothCH+XZyqvRIXQBk2cPfilwHgO30u/TZ3O1KDzzURfRaDFOSRSdtlrwdkAS0STavxG1AR/2NM1D47bI1r0oDINo3XTKvx1R5/jp0T83+44xcqMqwqebA8WJPt3XnZhmlq6YAXMJKxOl9z57xAszYmRsZiz2Ou2YKy9ZcPdB5qkdHftYy5dtLuYFJGt3K2hvM8Mslax/dKspmL/3KLlePVKnuwqDSVAhuOtGR7d04CnA+jVglZJJEWxlq8YabVuCbGKn+QeB5jQP6BswUeXAOAuzq+Wxv8o+w0+g8kar4VQQEjcayrU4LfnPYVPKLsZmsj8vWbaVpZE6k7Xk9yo/rSvpVkotDZsUIeFVfOyS0XX+cxIzEhnXddxxqRZn28+lpi6rBfXfhTTh3+oY7vLgrXr1//LwD4o69/95vH5Jb7OjUReGGvjhqlp3Tc34r6ElAho67ESF4faSDvO0HXo4DYvtm1fbcMPw0B6c1ATe/5hb7SoNogBpWufxInqr8c6yhAUf2QbvDv7Wbrt1W+c4DoHDt27FvfvvDn247jvLP8b9/5xw/ubXzDmBgZJ0lpxEjLGKIZ1Noq6VZ0ajhqZpUB7xkTtViSUTx593a25Y73tSEimXDy5Ek4d+7c2JkzZy784eu/v3Dp1d9707vv/CRBPGuRkqCZ6PyKmJ898Zm+eoDH+WcPnB+BB59L8CqVCtevX0ef/CumadJl1et1mJqaOv2LL/7CtUuvLvypd7/zcYx2vSkVR04E0EO0pzj/4oWYvh8d2sVo/n3Dbra+2KWwlBpM8t+cOXMGDGPvBmu1Grz44ovjnz1z7trLk+eushfsx73XVs8d6nEz7So+dXGPW9Vv4ia3XfQT/4MOoq9fv47RtLdUPycOlUrl5WPHjn0KRfbY2NiBv0TiJycnx9989auvff2731wvWqHUQ7TqmIJtt38pKfqJ0cwyjVfkpvPfmKmqQXR/utFoTE9MTCh+jBpQjN+/f/8LdrNVeBROj+hW9ZU/5SrLGDGFNqgxOTIuRikgcCgSG548eQKO4/zvIL5LpzKmlKQvt93LXOHfH+jAmcBU1+oF02qsxUR/So+dnR24e/fuT7A0Nu5aKXdbA3QSrVS0bTdbfwKOTCabY9viVG0aDPhP8ocPGR4+fAgfffTRh67r/trCwkKcztHXd5EVsUSjS5SqN5J2q4akBdgj+2veJ52txEJxFOUTI6ehJt6hZISSw3EcIviDDz7Yvnfv3k3Xdb+UQDLfaOLaziFHSeMZDihjkU62VpjQPxo/8VUYFFPQ8vShomVajf/z7ne+H3qO+qEmkOwxuelcMa3Gr+hyoiAp+FLB06dPw8/a3t7Gnz8CANSsv52G4DAhJOb+SUm1vWm57V4FR17FFKR+HY+rsJ/cuVy9qat7AW4dgQ272fpn02r8kvdJ5z/EiepLsS5R1MqxtdNjMr/QaXNe1QR79OgRtFqtdQ3ROHz/zxYWFrImCAIdhUlKLuos2KEQ4/R+D/O+pFdZg72g1Hjc4JdHHey1RLCQLNNqvCo3d2+BhOmkpAMKgtTEtNx08Nz+XXxYFC9hbWFh4VnWdFuZEkLiSb9khGOHML1lLF93edirDNDSWCUAko0lt7K9+wNuchN/DXvn9veH4dxOwEzuPD4mPdLkb42IloouTEJNP9EB7Gbrdbnt/iWG5RJdgv65PS5MA8/tvyviegYES4uS68eoNw0ds5phz94rrODdbrbelDteKvMrOLfF8eqXh9HeZp2prlxUwbxinbQRFkurkj1ysIJPN9j8+k3v3s6TNNc7xPa2RSU1ql2BnXD2SPhR60qj9hlcgJ1l3H5mkJLlwVcwvEdRn078C00/cbyKKT3fi57bgdnT66VqWmnAvNJ0+vAm9/L4Aju6CR05DQeDLNkwIgC2iehC2zGz+fUF+cC5klEOfQ7F+F/8zp/9uN1u32y323F/+0zSkzI3JIgB59pTCnZItNzxLqoe/ai1y0e7mGxvFd3Sgm3lvObPxrMiMgX0NCTwwh1NPASPTZO0M4W87gAsvo96iuXHoo5CBd7NG4EDi4jmRMB1LfU+/kVeKGI07mEH16lP8WZRg72/ciZ6EKxyLrIaaiIowj7a1dmxJD6V32kVRXdl6z6i/XmR6l/COdmLRU03P4xgs3SWEvxVwZWt0TzvkGi2pzekraFZyogR9K88NMNQBoAlckHrqGzdDmdXh+gWEiuY1tMTHjdwxQoJrBB4kNCCeG9XH53VCeCzeTa2OsWDcN2pvVenv/SVT4nofVUb3fHoFXQzCtbAKad4p2c/0DXarbbXv0/3CMWw69L2jpq9JmMFJ+HH7Waa8LfjbdBmtD1LPu6ac40/sbQHefKg3V2ec6D2yrQat72PO0ESwe1Ik9e1aKwZ64Jke/eyMPu3iqRKwU7nPHh6QpeHETT5LmlMBW66rXBERahJh0WRjoukz0SSPw4kT/Zq44yi9kSamRem1bgjjldjL5JH/bvGz4/2/SMUSU9/cG8ww5hLhLCxfSN+JhaPFL5lN1uJ7mVW6ta6O08cSCXKmCGyKLd23yXbuc910v+zvcPTqkATgkl3tD5xUaqOFwxGT6XY9vNIKllsdA54cJtG/MRAnEyehfUcYhkzYnhASl94fteCK6opWjrSfedJnY9rrHL4ulIogWd6XjBO1GLXhtZ1b0i6EpQp4Cftbe7oe4QE8Bl6QyDJcRkkaE75knJRR6cnXXttCSvvdXWmPawIxg3T2MKEMCQ1D/KonZeW8iMtRPMTt6aj1/RhRThJv55ukj5Nz9HYzkvXyEI8c2bpzDlCr/XxSR6rxM64ioIb9Vwu08hCfzK8wjDswwxenyZNwcnQ9ZAbzuGvq2HVhgKUiN5TLKqqJEuao3XIwHVrN5JGHfUDkT1eweBQU5Xs3CMLQ3GU8yaiwNgpdho6LOP/dY39D8Azr9Z5FHMuDTwX0SHJ45V64pTZtMAJ6BgRc+X6MI8dZim3IkaNKXIUabJr2A2am+zMlxG67sY0kgxcYTE5gqIKG7i/T87+IQKui2k10LHxHvn/J/SRDKSckd093a8fehLyXMoytTssop2y4Ue8yMlfEahx3hmGs5sVLqxhu0gPa0LXw1zAfP5TZNXM5hkznFl0px2HqwOU5OAP/aKZjGWbiscLHoYZtYyTikFwVueZ9alyRr9PHp6Cb45cgVsh4evcEvGZNavhB32eokmYsTlehbjonS5w79Pcc6RVtG50kgzOfg4I36a+4kGj0+VBKW18hPiviqgPYgcHiAwLt/Ler+pE+CUw4HIusjE9ycjXuoris5i/ZpM/eINdhU2ec62rlfTZyPhenJVdx3xrMWbkmz+C0b3uybApwCTjH76hIsmUiIZgsDiG3LKQjaYUl79Slf7xmBaRCQhJ3/GieW13mPg7QQeGXuc7i+HgvJvhzkp7c5k5Dyuph0ssXL8TPl2nX7ud/l6dcJSwEsmgg2jISrbfTJ2cIyx+lygD8gUN573HpSg069qjDjpUJZqmnhoT7HgoWM+5zHmuZcsNghO3eFbnIlTEBdKeE9aJMm43aZ2USQZdRENKsvuJoVB7rYkpA21zDVP1eiJaX6ZKZAzoPh+7gfNnsSuhL/c6qUAb0ftu4tTBZLeki2cxiu7PyzSSoB6f/lpKdDjv3e+Kv9RvDGOg26ATpPtIKIJk0E00RKJZUdOL7b9UWiMrQbhA/niHAZguyuBsEE68eJtJjjWBeq4TnuVbtE7zcWMT8kA70bBniqxQ5EVCapK7PsPibAzloEnRYII2+B5Ta/1M9jI6n3gACn7GXBEmYyFEQyRthkcwzGU1e1iUPzROj5RehJPi9MDBWuTM5UdBgIiLJOaKmAQIRRINe2RBnovneqT3jDOjhVybVrgSvI/JDDqZ8161dFyMQ6GDHhWfTkvUhiRPGCWO3zlxJk+e1yCm55d5omf+znkMjuGm+lty3CiEXanAzfasIqftqqDMRFtKTcm5zBfNlBT9SS1pe5dFPf/XUedEn+hSotAzOi/YxPqQzue8rlHfHk2lIIWK36RCgAY9fi0Hy1VL2eWhrIfgTHju5YXdfzp9N1iXuKVUgOC3sq6XtfC/tEQLldDnntjO4llSm8Ju7B+1XzaUlWhL8ojcPM1zuA/LRkbHwyr5wfP0RMUI1eNw/vYR0RkwB668hGesd3fH156zkJ5BbIdvCcR32nH71IXApTAi2tDy8e5tjjSVMqmxlMpYFAfGQIwa3PVI9I5yYVTy7g7+9vmsrkRySdbEDVLKenwu7HogcUZXEAr1O+f2nGFRNpSe6CiYdItJp34dRHxV+M1aqgLkrkytbff4fF/bb/g1ZNSkB48QJyS2zXbyqs5slkFgqIjuRoR4/Hk2Micqd8UHD2CZZlLXoq9hLSqAYSe6F1T864hB+J0HDgD4f4Olp7lWqb4LAAAAAElFTkSuQmCC\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 390, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 390, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      390,\n      customerInformationTop -10\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.payload = msg.filename;\n    msg.order = msg.payload\n    return msg;\n        \n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 700,
        "y": 660,
        "wires": [
            [
                "5cb5b00e.80624",
                "13692907.f7c157"
            ]
        ]
    },
    {
        "id": "1d65449f.f7478b",
        "type": "debug",
        "z": "3d33a84f.1ae768",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1190,
        "y": 20,
        "wires": []
    },
    {
        "id": "a477fa0c.6fecd8",
        "type": "switch",
        "z": "3d33a84f.1ae768",
        "name": "Check If Order number Exists in headers",
        "property": "req.headers.ordernumber",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 340,
        "y": 200,
        "wires": [
            [
                "a4e1a331.8a1d7"
            ],
            [
                "bca151bd.07903"
            ]
        ]
    },
    {
        "id": "6e12b5ae.929c7c",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.statusCode = 400;\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply the orderNumber to Pull its PDF\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 300,
        "wires": [
            [
                "a05dba05.9f7858"
            ]
        ]
    },
    {
        "id": "4c5cfb0d.274604",
        "type": "switch",
        "z": "3d33a84f.1ae768",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 330,
        "y": 340,
        "wires": [
            [
                "5cfc50c6.e7fd9"
            ],
            [
                "b1eb1353.a5f09"
            ],
            [
                "6e12b5ae.929c7c"
            ]
        ]
    },
    {
        "id": "9ddea37f.841b3",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n\treturn msg;\t\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1230,
        "y": 420,
        "wires": [
            [
                "6a7461f.6f1e4a",
                "4e6cafd1.0faa5",
                "c28a01dc.d286"
            ]
        ]
    },
    {
        "id": "bc57acdb.eee0e",
        "type": "catch",
        "z": "3d33a84f.1ae768",
        "name": "Error - FuelOrder",
        "scope": [
            "9ddea37f.841b3",
            "61d68c6.ebf0d74",
            "c49fc058.3bf37",
            "dbed8433.02ae28"
        ],
        "uncaught": false,
        "x": 980,
        "y": 100,
        "wires": [
            [
                "fa5419b7.bfb9d8"
            ]
        ]
    },
    {
        "id": "fa5419b7.bfb9d8",
        "type": "debug",
        "z": "3d33a84f.1ae768",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1190,
        "y": 100,
        "wires": []
    },
    {
        "id": "c622db00.7c77c8",
        "type": "debug",
        "z": "3d33a84f.1ae768",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 330,
        "y": 140,
        "wires": []
    },
    {
        "id": "a4e1a331.8a1d7",
        "type": "switch",
        "z": "3d33a84f.1ae768",
        "name": "Check If Order Type Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 690,
        "y": 240,
        "wires": [
            [
                "4c5cfb0d.274604"
            ],
            [
                "6e12b5ae.929c7c"
            ]
        ]
    },
    {
        "id": "bca151bd.07903",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "No OrderNumber",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.statusCode = 400;\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply the orderNumber to Pull its PDF\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 200,
        "wires": [
            [
                "a05dba05.9f7858"
            ]
        ]
    },
    {
        "id": "b1eb1353.a5f09",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "Get Order Number ",
        "func": "let order = msg.req.headers.ordernumber\nmsg.orderNo = order\nmsg.orderNumber = order;\nmsg.payload = {\"PO\": order };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 170,
        "y": 540,
        "wires": [
            [
                "6abfc307.1b1c5c"
            ]
        ]
    },
    {
        "id": "58164aab.600744",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 660,
        "wires": [
            [
                "bf18ddc4.700f8"
            ]
        ]
    },
    {
        "id": "6abfc307.1b1c5c",
        "type": "mongodb in",
        "z": "3d33a84f.1ae768",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetWarehouseOrderByOrderNumber",
        "collection": "orders",
        "operation": "find",
        "x": 450,
        "y": 580,
        "wires": [
            [
                "5561f0d0.3b5e6"
            ]
        ]
    },
    {
        "id": "5561f0d0.3b5e6",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.payload[0].requestPayload;\nmsg.orderToEmail = msg.payload.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 140,
        "y": 660,
        "wires": [
            [
                "58164aab.600744"
            ]
        ]
    },
    {
        "id": "5cfc50c6.e7fd9",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "Get Order Number ",
        "func": "let order = msg.req.headers.ordernumber\nmsg.orderNo = order\nmsg.payload = {\"PO\": order };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 380,
        "wires": [
            [
                "680eef67.68733"
            ]
        ]
    },
    {
        "id": "6a7461f.6f1e4a",
        "type": "debug",
        "z": "3d33a84f.1ae768",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1630,
        "y": 300,
        "wires": []
    },
    {
        "id": "5cb5b00e.80624",
        "type": "debug",
        "z": "3d33a84f.1ae768",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 560,
        "wires": []
    },
    {
        "id": "faf64741.ce4248",
        "type": "file",
        "z": "3d33a84f.1ae768",
        "name": "Delete New PDF File After Transmition",
        "filename": "",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "delete",
        "encoding": "none",
        "x": 1710,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "4e6cafd1.0faa5",
        "type": "delay",
        "z": "3d33a84f.1ae768",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1460,
        "y": 660,
        "wires": [
            [
                "faf64741.ce4248"
            ]
        ]
    },
    {
        "id": "231bc32f.dfc7fc",
        "type": "catch",
        "z": "3d33a84f.1ae768",
        "name": "Error - File Read",
        "scope": [
            "723de4b4.47b1dc"
        ],
        "uncaught": false,
        "x": 980,
        "y": 140,
        "wires": [
            [
                "cec18b47.9ee088"
            ]
        ]
    },
    {
        "id": "cec18b47.9ee088",
        "type": "debug",
        "z": "3d33a84f.1ae768",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1190,
        "y": 140,
        "wires": []
    },
    {
        "id": "af454285.8fb32",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "Pull Base64 PDF",
        "func": "let message = false;\nfs.readFile(msg.payload,  (err,data) => {\n    if(err){throw err};\n    let encodedData =  data.toString('base64');\n    // Respond with base64 encoded pdf of order\n    message = encodedData\n    msg.payload = encodedData\n    return msg;\n})\nlet getbase64pdf = async () => {\n    let pdfData = await fs.readFileSync(msg.payload);\n    let encodedData = pdfData.toString('base64');\n    msg.payload = encodedData\n    return encodedData\n}\n    return getbase64pdf().then(result=>{\n        msg.payload = result;\n        return msg\n    });\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1070,
        "y": 660,
        "wires": [
            [
                "a05dba05.9f7858",
                "4e6cafd1.0faa5",
                "5cb5b00e.80624"
            ]
        ]
    },
    {
        "id": "3fa9b6bd.1af56a",
        "type": "function",
        "z": "3d33a84f.1ae768",
        "name": "Pull Base64 PDF",
        "func": "let message = false;\n\nlet getbase64pdf = async () => {\n    let pdfData = await fs.readFileSync(msg.payload);\n    let encodedData = pdfData.toString('base64');\n    msg.payload = encodedData\n    return encodedData\n}\n    return getbase64pdf().then(result=>{\n        msg.payload = result;\n        return msg\n    });\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1590,
        "y": 460,
        "wires": [
            [
                "a05dba05.9f7858",
                "6a7461f.6f1e4a"
            ]
        ]
    },
    {
        "id": "13692907.f7c157",
        "type": "delay",
        "z": "3d33a84f.1ae768",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 900,
        "y": 660,
        "wires": [
            [
                "af454285.8fb32"
            ]
        ]
    },
    {
        "id": "c28a01dc.d286",
        "type": "delay",
        "z": "3d33a84f.1ae768",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1440,
        "y": 420,
        "wires": [
            [
                "3fa9b6bd.1af56a"
            ]
        ]
    },
    {
        "id": "2ba7f472.70221c",
        "type": "http in",
        "z": "e4db3e08.3ae77",
        "name": "editOrder",
        "url": "/api/editOrder",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 60,
        "y": 800,
        "wires": [
            [
                "848f8fae.85103",
                "e2328a6a.9710a8"
            ]
        ]
    },
    {
        "id": "988ffdcf.4f0bd",
        "type": "http response",
        "z": "e4db3e08.3ae77",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1740,
        "y": 1120,
        "wires": []
    },
    {
        "id": "b479c40e.eeae38",
        "type": "catch",
        "z": "e4db3e08.3ae77",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 1710,
        "y": 840,
        "wires": [
            [
                "2c8d01e4.9ee18e"
            ]
        ]
    },
    {
        "id": "2e38bc04.cad084",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 1040,
        "wires": [
            [
                "3afe5ae9.26cfb6"
            ]
        ]
    },
    {
        "id": "1a77877c.e69ef9",
        "type": "catch",
        "z": "e4db3e08.3ae77",
        "name": "Error - WarehouseOrder",
        "scope": [
            "4a0069f3.ed4dc8",
            "4ab1f337.acbe7c",
            "103cd822.0a4878",
            "14f2329d.e9775d",
            "84c4ef00.8f4ac",
            "ea5d12f4.ecb19"
        ],
        "uncaught": false,
        "x": 1700,
        "y": 880,
        "wires": [
            [
                "9bca4a09.7cd8a8"
            ]
        ]
    },
    {
        "id": "2851dd0b.3ab892",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = orderNumber\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.orderNumber = orderNumber\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.order;\nmsg.orderToEmail = msg.order.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 160,
        "y": 960,
        "wires": [
            [
                "2e38bc04.cad084"
            ]
        ]
    },
    {
        "id": "9bca4a09.7cd8a8",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 880,
        "wires": []
    },
    {
        "id": "4a0069f3.ed4dc8",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Generate BlendSheet PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\nfunction createBlendSheet(invoice, path) {\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n  generateHeader(doc);\n  generateCustomerInformation(doc, invoice);\n  generateInvoiceTable(doc, invoice);\n  generateFooter(doc,invoice);\n\n  doc.end();\n  doc.pipe(fs.createWriteStream(path));\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Blending\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    // .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 150);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop + 15)\n    .text(formatDate(new Date()), 150, customerInformationTop + 15)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop + 30)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop + 30\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop + 45)\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop + 45)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 60)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 60)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 30)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 30)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -15)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -5\n    )\n    \n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop + 40) \n    .text(invoice.origin.address, 380, customerInformationTop + 40)\n\n    .moveDown();\n\n  generateHr(doc, 290);\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Quantity\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description,\n      item.Package,\n      item.Quantity\n    //   formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n//   generateTableRow(\n//     doc,\n//     subtotalPosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     \"Subtotal\",\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n\n  const paidToDatePosition = subtotalPosition + 20;\n  // generateTableRow(\n  //   doc,\n  //   paidToDatePosition,\n  //   \"\",\n  //   \"\",\n  //   \"\",\n  //   \"Paid To Date\",\n  //   \"\",\n  //   formatCurrency(invoice.paid)\n  // );\n\n  const duePosition = paidToDatePosition + 25;\n//   doc.font(\"Helvetica-Bold\");\n//   generateTableRow(\n//     doc,\n//     duePosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     `${sentenceCase(invoice.sales.quoteType)} Total`,\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n//   doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 120, y)\n    .text(package, 300, y)\n    .text(unitCost, 320, y, { width: 90, align: \"right\" })\n    .text(quantity, 370, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\n\ntry{\n   createBlendSheet(msg.payload, msg.blendfilename )\n    msg.order = msg.payload\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.blendfilename), path: msg.blendfilename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 620,
        "y": 1260,
        "wires": [
            [
                "4ab1f337.acbe7c"
            ]
        ]
    },
    {
        "id": "4ab1f337.acbe7c",
        "type": "e-mail",
        "z": "e4db3e08.3ae77",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com,d.lee@kppetro.com",
        "dname": "Send Blendsheet Email",
        "x": 1150,
        "y": 1280,
        "wires": []
    },
    {
        "id": "103cd822.0a4878",
        "type": "e-mail",
        "z": "e4db3e08.3ae77",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Warehouse Confirmation Email",
        "x": 1190,
        "y": 1320,
        "wires": []
    },
    {
        "id": "14f2329d.e9775d",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 580,
        "y": 1320,
        "wires": [
            [
                "3d2f2aeb.2f0626"
            ]
        ]
    },
    {
        "id": "26eb99ba.a391c6",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Format Order Update",
        "func": "let orderId = msg.payload[0]._id\nmsg.query = {_id: orderId }\nmsg.payload = { $set: {requestPayload: msg.order}};\nmsg.newOrder = msg.payload\nmsg.newOrder.requestPayload = msg.order\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1780,
        "y": 640,
        "wires": [
            [
                "fb83419a.7a93d",
                "89beb30e.69206",
                "2851dd0b.3ab892"
            ]
        ]
    },
    {
        "id": "fb83419a.7a93d",
        "type": "mongodb out",
        "z": "e4db3e08.3ae77",
        "d": true,
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Order",
        "collection": "order",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 2060,
        "y": 640,
        "wires": []
    },
    {
        "id": "2c8d01e4.9ee18e",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 840,
        "wires": []
    },
    {
        "id": "e2328a6a.9710a8",
        "type": "switch",
        "z": "e4db3e08.3ae77",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 330,
        "y": 800,
        "wires": [
            [
                "f3c60a99.3d31c8"
            ],
            [
                "acfc10c4.dafc4"
            ]
        ]
    },
    {
        "id": "acfc10c4.dafc4",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse, and the orderNumber\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 1020,
        "wires": [
            [
                "988ffdcf.4f0bd"
            ]
        ]
    },
    {
        "id": "3afe5ae9.26cfb6",
        "type": "switch",
        "z": "e4db3e08.3ae77",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 310,
        "y": 1040,
        "wires": [
            [
                "52565989.565af8"
            ],
            [
                "4a0069f3.ed4dc8",
                "14f2329d.e9775d"
            ],
            [
                "acfc10c4.dafc4"
            ]
        ]
    },
    {
        "id": "52565989.565af8",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 590,
        "y": 1100,
        "wires": [
            [
                "6ea4437a.23f86c"
            ]
        ]
    },
    {
        "id": "b8698ba1.cb0f78",
        "type": "e-mail",
        "z": "e4db3e08.3ae77",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Fuel Confirmation Email",
        "x": 1170,
        "y": 1100,
        "wires": []
    },
    {
        "id": "a75b5a86.959978",
        "type": "catch",
        "z": "e4db3e08.3ae77",
        "name": "Error - FuelOrder",
        "scope": [
            "52565989.565af8",
            "b8698ba1.cb0f78",
            "d508b47e.991e08",
            "314de6b9.2891da"
        ],
        "uncaught": false,
        "x": 1720,
        "y": 920,
        "wires": [
            [
                "ef424ef2.ba318"
            ]
        ]
    },
    {
        "id": "ef424ef2.ba318",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 920,
        "wires": []
    },
    {
        "id": "3d2f2aeb.2f0626",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\n\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 840,
        "y": 1320,
        "wires": [
            [
                "103cd822.0a4878",
                "57a90b2f.5de894"
            ]
        ]
    },
    {
        "id": "6ea4437a.23f86c",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 860,
        "y": 1100,
        "wires": [
            [
                "b8698ba1.cb0f78",
                "57a90b2f.5de894"
            ]
        ]
    },
    {
        "id": "848f8fae.85103",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 720,
        "wires": []
    },
    {
        "id": "f3c60a99.3d31c8",
        "type": "switch",
        "z": "e4db3e08.3ae77",
        "name": "Check If OrderNumber Exists in headers",
        "property": "req.headers.ordernumber",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 720,
        "y": 780,
        "wires": [
            [
                "31364d93.d496f2"
            ],
            [
                "acfc10c4.dafc4"
            ]
        ]
    },
    {
        "id": "31364d93.d496f2",
        "type": "switch",
        "z": "e4db3e08.3ae77",
        "name": "Switch On Order Type",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1000,
        "y": 740,
        "wires": [
            [
                "ef33835c.05bf2"
            ],
            [
                "bee1b5c0.d862b8"
            ],
            [
                "acfc10c4.dafc4"
            ]
        ]
    },
    {
        "id": "3191274a.6b7218",
        "type": "mongodb in",
        "z": "e4db3e08.3ae77",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetFuelOrderByOrderNumber",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 1470,
        "y": 640,
        "wires": [
            [
                "26eb99ba.a391c6",
                "89beb30e.69206"
            ]
        ]
    },
    {
        "id": "ef33835c.05bf2",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Get Order Number ",
        "func": "let orderNumber = msg.req.headers.ordernumber\nmsg.orderNo = orderNumber;\nmsg.order = msg.payload;\nmsg.payload = {\"PO\": order };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 640,
        "wires": [
            [
                "3191274a.6b7218",
                "89beb30e.69206"
            ]
        ]
    },
    {
        "id": "698ee563.ca20ec",
        "type": "mongodb in",
        "z": "e4db3e08.3ae77",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetWarehouseOrderByOrderNumber",
        "collection": "orders",
        "operation": "find",
        "x": 1570,
        "y": 740,
        "wires": [
            [
                "89beb30e.69206",
                "7e7615c9.55c70c"
            ]
        ]
    },
    {
        "id": "bee1b5c0.d862b8",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Get Order Number ",
        "func": "let orderNumber = msg.req.headers.ordernumber;\nmsg.orderNo = orderNumber;\nmsg.order = msg.payload;\nmsg.orderNumber = orderNumber;\nmsg.payload = {\"PO\": orderNumber };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 740,
        "wires": [
            [
                "698ee563.ca20ec",
                "89beb30e.69206"
            ]
        ]
    },
    {
        "id": "89beb30e.69206",
        "type": "debug",
        "z": "e4db3e08.3ae77",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1890,
        "y": 540,
        "wires": []
    },
    {
        "id": "7e7615c9.55c70c",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Format Order Update",
        "func": "let orderId = msg.payload[0]._id\nmsg.query = {_id: orderId }\nmsg.payload = { $set: {requestPayload: msg.order}};                  \nmsg.newOrder = msg. payload[0]\nmsg.newOrder.requestPayload = msg.order\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1880,
        "y": 720,
        "wires": [
            [
                "cdad7d0c.a4d54",
                "89beb30e.69206",
                "2851dd0b.3ab892"
            ]
        ]
    },
    {
        "id": "cdad7d0c.a4d54",
        "type": "mongodb out",
        "z": "e4db3e08.3ae77",
        "d": true,
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Order",
        "collection": "order",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 2080,
        "y": 720,
        "wires": []
    },
    {
        "id": "57a90b2f.5de894",
        "type": "function",
        "z": "e4db3e08.3ae77",
        "name": "Format Response",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: false,\n    Message: \"Order updated Properly\",\n    Order: msg.newOrder,\n    orderNumber: msg.orderNumber\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1304,
        "y": 1192,
        "wires": [
            [
                "1053c8fe.83b127"
            ]
        ]
    },
    {
        "id": "1053c8fe.83b127",
        "type": "delay",
        "z": "e4db3e08.3ae77",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1580,
        "y": 1180,
        "wires": [
            [
                "988ffdcf.4f0bd"
            ]
        ]
    },
    {
        "id": "895e2f2f.24b0f",
        "type": "http in",
        "z": "bfa4b585.801268",
        "name": "submitOrder",
        "url": "/api/submitOrder",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 60,
        "wires": [
            [
                "8133dc1d.9ad7e",
                "ff66a6ce.fd9998"
            ]
        ]
    },
    {
        "id": "aee86530.76e118",
        "type": "http response",
        "z": "bfa4b585.801268",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1520,
        "y": 280,
        "wires": []
    },
    {
        "id": "e8e18d9e.c6c75",
        "type": "catch",
        "z": "bfa4b585.801268",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 1710,
        "y": 100,
        "wires": [
            [
                "9a0f4161.b4e9f"
            ]
        ]
    },
    {
        "id": "7396e83.5a10b18",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Get Order Number ",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 160,
        "wires": [
            [
                "db3b6fe3.5aba2"
            ]
        ]
    },
    {
        "id": "e741f411.4b7fc8",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        if(typeof currentItem.Package === 'object'){\n            itemObj.Package = currentItem.Package.packName;\n        }else {\n            itemObj.Package = currentItem.Package;\n        }\n        \n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 180,
        "wires": [
            [
                "cbc14c0f.30689"
            ]
        ]
    },
    {
        "id": "cde0745b.635d18",
        "type": "catch",
        "z": "bfa4b585.801268",
        "name": "Error - WarehouseOrder",
        "scope": [
            "34ad76fc.fb554a",
            "e5eae6d2.c65fc8",
            "7be62d55.c7c594",
            "b1bfd65f.b4e5a8",
            "6ae72142.12977",
            "43353931.9811f8"
        ],
        "uncaught": false,
        "x": 1700,
        "y": 140,
        "wires": [
            [
                "b811f323.6442"
            ]
        ]
    },
    {
        "id": "db3b6fe3.5aba2",
        "type": "mongodb in",
        "z": "bfa4b585.801268",
        "mongodb": "50415189.3a11b",
        "name": "GetOrderNumber",
        "collection": "counter",
        "operation": "find",
        "x": 810,
        "y": 120,
        "wires": [
            [
                "3f1af7cd.ce53e8",
                "f2a4a1c9.0cbdb"
            ]
        ]
    },
    {
        "id": "f2a4a1c9.0cbdb",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.payload[0].sequence_value\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = `DJ0F${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.orderNumber = `DJ0W${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.order;\nmsg.orderToEmail = msg.order.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 120,
        "wires": [
            [
                "e741f411.4b7fc8"
            ]
        ]
    },
    {
        "id": "b811f323.6442",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 140,
        "wires": []
    },
    {
        "id": "34ad76fc.fb554a",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Generate BlendSheet PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\nfunction createBlendSheet(invoice, path) {\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n  generateHeader(doc);\n  generateCustomerInformation(doc, invoice);\n  generateInvoiceTable(doc, invoice);\n  generateFooter(doc,invoice);\n\n  doc.end();\n  doc.pipe(fs.createWriteStream(path));\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Blending\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    // .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 150);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop + 15)\n    .text(formatDate(new Date()), 150, customerInformationTop + 15)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop + 30)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop + 30\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop + 45)\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop + 45)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 60)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 60)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 30)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 30)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -15)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -5\n    )\n    \n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop + 40) \n    .text(invoice.origin.address, 380, customerInformationTop + 40)\n\n    .moveDown();\n\n  generateHr(doc, 290);\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Quantity\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description,\n      item.Package,\n      item.Quantity\n    //   formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n//   generateTableRow(\n//     doc,\n//     subtotalPosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     \"Subtotal\",\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n\n  const paidToDatePosition = subtotalPosition + 20;\n  // generateTableRow(\n  //   doc,\n  //   paidToDatePosition,\n  //   \"\",\n  //   \"\",\n  //   \"\",\n  //   \"Paid To Date\",\n  //   \"\",\n  //   formatCurrency(invoice.paid)\n  // );\n\n  const duePosition = paidToDatePosition + 25;\n//   doc.font(\"Helvetica-Bold\");\n//   generateTableRow(\n//     doc,\n//     duePosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     `${sentenceCase(invoice.sales.quoteType)} Total`,\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n//   doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact help@kppetro.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 120, y)\n    .text(package, 300, y)\n    .text(unitCost, 320, y, { width: 90, align: \"right\" })\n    .text(quantity, 370, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\n\ntry{\n   createBlendSheet(msg.payload, msg.blendfilename )\n    msg.order = msg.payload\n    msg.payload = `New Order Created\n    \n    Notes: ${msg.order.notes}\n    `\n    msg.topic = \"NEW WAREHOUSE ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.blendfilename), path: msg.blendfilename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 620,
        "y": 580,
        "wires": [
            [
                "e5eae6d2.c65fc8"
            ]
        ]
    },
    {
        "id": "e5eae6d2.c65fc8",
        "type": "e-mail",
        "z": "bfa4b585.801268",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com,d.lee@kppetro.com,s.james@kppetro.com,j.acosta@kppetro.com",
        "dname": "Send Blendsheet Email",
        "x": 1170,
        "y": 580,
        "wires": []
    },
    {
        "id": "7be62d55.c7c594",
        "type": "e-mail",
        "z": "bfa4b585.801268",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Warehouse Confirmation Email",
        "x": 1630,
        "y": 720,
        "wires": []
    },
    {
        "id": "b1bfd65f.b4e5a8",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact help@kppetro.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 100,
        "y": 640,
        "wires": [
            [
                "1f1dbf94.ed9ba",
                "40596b0f.3212d4"
            ]
        ]
    },
    {
        "id": "6ae72142.12977",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Warehouse Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\ninvoiceData.items.items = invoiceData.items.items.map(item => {\n        \n    if(item.Package.packName || typeof item.Package === 'object'){\n        let package = item.Package.packName;\n        item.Package = package\n    }\n    return item;\n    \n})\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 500,
        "wires": [
            [
                "43353931.9811f8",
                "9aa91567.5b8ab8",
                "bc77d456.fed138"
            ]
        ]
    },
    {
        "id": "43353931.9811f8",
        "type": "mongodb out",
        "z": "bfa4b585.801268",
        "mongodb": "c5ee0161.50223",
        "name": "Insert Warehouse Order Into MongoDB",
        "collection": "orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 930,
        "y": 520,
        "wires": []
    },
    {
        "id": "9aa91567.5b8ab8",
        "type": "delay",
        "z": "bfa4b585.801268",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1280,
        "y": 400,
        "wires": [
            [
                "aee86530.76e118"
            ]
        ]
    },
    {
        "id": "3f1af7cd.ce53e8",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Counter Update",
        "func": "let count = msg.payload[0].sequence_value\nmsg.query = {_id: 'orderid'}\nmsg.payload = { $set: {sequence_value: Number(count) + 1}};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 60,
        "wires": [
            [
                "15b2df60.ed2b51"
            ]
        ]
    },
    {
        "id": "15b2df60.ed2b51",
        "type": "mongodb out",
        "z": "bfa4b585.801268",
        "mongodb": "50415189.3a11b",
        "name": "Update Order Counter",
        "collection": "counter",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 1320,
        "y": 60,
        "wires": []
    },
    {
        "id": "9a0f4161.b4e9f",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 100,
        "wires": []
    },
    {
        "id": "8133dc1d.9ad7e",
        "type": "switch",
        "z": "bfa4b585.801268",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 290,
        "y": 200,
        "wires": [
            [
                "7396e83.5a10b18"
            ],
            [
                "4d8ce2ae.1357ec"
            ]
        ]
    },
    {
        "id": "4d8ce2ae.1357ec",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 280,
        "wires": [
            [
                "aee86530.76e118"
            ]
        ]
    },
    {
        "id": "cbc14c0f.30689",
        "type": "switch",
        "z": "bfa4b585.801268",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 310,
        "y": 300,
        "wires": [
            [
                "209b0f4e.8d2ae",
                "7cb5bff2.e29fc"
            ],
            [
                "34ad76fc.fb554a",
                "6ae72142.12977",
                "b1bfd65f.b4e5a8"
            ],
            [
                "4d8ce2ae.1357ec"
            ]
        ]
    },
    {
        "id": "209b0f4e.8d2ae",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact help@kppetro.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Fuel Order Created'\n    msg.topic = \"TEST - NEW FUEL ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 590,
        "y": 360,
        "wires": [
            [
                "b2d24643.0ea908"
            ]
        ]
    },
    {
        "id": "a501589d.11db98",
        "type": "e-mail",
        "z": "bfa4b585.801268",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Fuel Confirmation Email",
        "x": 2470,
        "y": 420,
        "wires": []
    },
    {
        "id": "7cb5bff2.e29fc",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Fuel Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 400,
        "wires": [
            [
                "dd9d9208.7495b",
                "9aa91567.5b8ab8",
                "ddb15988.a018b8"
            ]
        ]
    },
    {
        "id": "dd9d9208.7495b",
        "type": "mongodb out",
        "z": "bfa4b585.801268",
        "mongodb": "c5ee0161.50223",
        "name": "Insert Fuel Order Into MongoDB",
        "collection": "Fuel_Orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 890,
        "y": 420,
        "wires": []
    },
    {
        "id": "b5fc2a29.f2b2b8",
        "type": "catch",
        "z": "bfa4b585.801268",
        "name": "Error - FuelOrder",
        "scope": [
            "209b0f4e.8d2ae",
            "a501589d.11db98",
            "7cb5bff2.e29fc",
            "dd9d9208.7495b"
        ],
        "uncaught": false,
        "x": 1720,
        "y": 180,
        "wires": [
            [
                "353c48bb.864cb8"
            ]
        ]
    },
    {
        "id": "353c48bb.864cb8",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 180,
        "wires": []
    },
    {
        "id": "46e6478d.05e498",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Pull Warehouse Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,mark@kppetro.com,b.schomburg@kppetro.com,j.capuzzi@kppetro.com,t.holmwood@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,b.schomburg@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\n//msg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\nmsg.to = `${msg.order.sales.email},${emails}` // emails\n\nmsg.cc = 'dylan.jackson@kppetro.com'\n\nmsg.payload = `Please see your attached Order\n\nYou can view this order at anytime using the following link:\nhttps://kppetro.io/viewpdf/${msg.orderMongoID}/warehouse\n\nThis link will always contain the updated order if future changes are made.\n\n Please reach out if you have any questions!\n \n Notes:\n \n ${msg.order.notes || ''}\n \n `\nmsg.topic = `New Warehouse Order - ${msg.order.sequenceNumber} - ${msg.order.shipping.name}`\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1310,
        "y": 720,
        "wires": [
            [
                "7be62d55.c7c594"
            ]
        ]
    },
    {
        "id": "defe2d5a.6938f",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Pull Fuel Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,mark@kppetro.com,b.schomburg@kppetro.com,j.capuzzi@kppetro.com,t.holmwood@kppetro.com,g.rybarski@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\") || origin.includes(\"Harlingen\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,b.schomburg@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\n//msg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\nmsg.to = `${msg.order.sales.email},${emails}` // emails\n\nmsg.cc = 'dylan.jackson@kppetro.com'\n\nmsg.payload = `Please see your attached Order\n\nYou can view this order at anytime using the following link:\nhttps://kppetro.io/viewpdf/${msg.orderMongoID}/fuel\n\nThis link will always contain the updated order if future changes are made.\n\n Please reach out if you have any questions!\n \n Notes:\n \n ${msg.order.notes || ''}\n \n `\nmsg.topic = `New Fuel Order - ${msg.order.sequenceNumber} - ${msg.order.shipping.name}`\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1790,
        "y": 420,
        "wires": [
            [
                "a501589d.11db98"
            ]
        ]
    },
    {
        "id": "ff66a6ce.fd9998",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 40,
        "wires": []
    },
    {
        "id": "c3660dc6.39c73",
        "type": "http in",
        "z": "bfa4b585.801268",
        "name": "editOrder",
        "url": "/api/editOrderTEST",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1140,
        "wires": [
            [
                "fa195cca.eec4c",
                "f7a4e8b0.68a938"
            ]
        ]
    },
    {
        "id": "4d3c2ce3.2bf784",
        "type": "http response",
        "z": "bfa4b585.801268",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1740,
        "y": 1460,
        "wires": []
    },
    {
        "id": "ce11ea80.c90748",
        "type": "catch",
        "z": "bfa4b585.801268",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 1890,
        "y": 1600,
        "wires": [
            [
                "1aab4245.309fce"
            ]
        ]
    },
    {
        "id": "9d8cde3d.a5271",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType || 'Order'\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.order, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 140,
        "y": 1380,
        "wires": [
            [
                "d6f16fd1.081f3",
                "20fac78f.c02a58"
            ]
        ]
    },
    {
        "id": "2c91c6fe.ed258a",
        "type": "catch",
        "z": "bfa4b585.801268",
        "name": "Error - WarehouseOrder",
        "scope": [
            "da45cf95.9dd4",
            "bd2a06f3.57ece8",
            "64214207.3950ac",
            "2f7e29ed.ba84d6",
            "84c4ef00.8f4ac",
            "ea5d12f4.ecb19"
        ],
        "uncaught": false,
        "x": 1880,
        "y": 1640,
        "wires": [
            [
                "1ee52079.b1545"
            ]
        ]
    },
    {
        "id": "e1ceb7e.f539848",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = orderNumber\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.orderNumber = orderNumber\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.order;\nmsg.orderToEmail = msg.order.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2200,
        "y": 1320,
        "wires": [
            [
                "9d8cde3d.a5271"
            ]
        ]
    },
    {
        "id": "1ee52079.b1545",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2110,
        "y": 1640,
        "wires": []
    },
    {
        "id": "da45cf95.9dd4",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Generate BlendSheet PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\nfunction createBlendSheet(invoice, path) {\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n  generateHeader(doc);\n  generateCustomerInformation(doc, invoice);\n  generateInvoiceTable(doc, invoice);\n  generateFooter(doc,invoice);\n\n  doc.end();\n  doc.pipe(fs.createWriteStream(path));\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Blending\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    // .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 150);\n\n  const customerInformationTop = 200;\n  let dateString = msg.order.sales.deliveryDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop + 15)\n    .text(formatDate(new Date()), 150, customerInformationTop + 15)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop + 30)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop + 30\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop + 45)\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop + 45)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 60)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 60)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 30)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 30)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -15)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -5\n    )\n    \n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop + 40) \n    .text(invoice.origin.address, 380, customerInformationTop + 40)\n\n    .moveDown();\n\n  generateHr(doc, 290);\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Quantity\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description,\n      item.Package,\n      item.Quantity\n    //   formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n//   generateTableRow(\n//     doc,\n//     subtotalPosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     \"Subtotal\",\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n\n  const paidToDatePosition = subtotalPosition + 20;\n  // generateTableRow(\n  //   doc,\n  //   paidToDatePosition,\n  //   \"\",\n  //   \"\",\n  //   \"\",\n  //   \"Paid To Date\",\n  //   \"\",\n  //   formatCurrency(invoice.paid)\n  // );\n\n  const duePosition = paidToDatePosition + 25;\n//   doc.font(\"Helvetica-Bold\");\n//   generateTableRow(\n//     doc,\n//     duePosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     `${sentenceCase(invoice.sales.quoteType)} Total`,\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n//   doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 120, y)\n    .text(package, 300, y)\n    .text(unitCost, 320, y, { width: 90, align: \"right\" })\n    .text(quantity, 370, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\n\ntry{\n   createBlendSheet(msg.payload, msg.blendfilename )\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.blendfilename), path: msg.blendfilename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 620,
        "y": 1600,
        "wires": [
            [
                "bd2a06f3.57ece8"
            ]
        ]
    },
    {
        "id": "bd2a06f3.57ece8",
        "type": "e-mail",
        "z": "bfa4b585.801268",
        "d": true,
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com,d.lee@kppetro.com",
        "dname": "Send Blendsheet Email",
        "x": 1130,
        "y": 1600,
        "wires": []
    },
    {
        "id": "64214207.3950ac",
        "type": "e-mail",
        "z": "bfa4b585.801268",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Warehouse Confirmation Email",
        "x": 1190,
        "y": 1660,
        "wires": []
    },
    {
        "id": "2f7e29ed.ba84d6",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 580,
        "y": 1660,
        "wires": [
            [
                "9718d9c5.db03e8"
            ]
        ]
    },
    {
        "id": "8db1218e.4f2e6",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Order Update",
        "func": "let orderId = msg.payload[0]._id\nmsg.query = {_id: orderId }\nmsg.payload = { $set: {'requestPayload': msg.order}};\nmsg.newOrder = msg.payload\nmsg.newOrder.requestPayload = msg.order\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1900,
        "y": 1100,
        "wires": [
            [
                "b53fda30.2bc638",
                "e1ceb7e.f539848"
            ]
        ]
    },
    {
        "id": "b53fda30.2bc638",
        "type": "mongodb out",
        "z": "bfa4b585.801268",
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Order",
        "collection": "order",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 2220,
        "y": 1080,
        "wires": []
    },
    {
        "id": "1aab4245.309fce",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2110,
        "y": 1600,
        "wires": []
    },
    {
        "id": "f7a4e8b0.68a938",
        "type": "switch",
        "z": "bfa4b585.801268",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 330,
        "y": 1140,
        "wires": [
            [
                "1bcafdd4.313072"
            ],
            [
                "c93a1048.a25df"
            ]
        ]
    },
    {
        "id": "c93a1048.a25df",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse, and the orderNumber\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 1360,
        "wires": [
            [
                "4d3c2ce3.2bf784"
            ]
        ]
    },
    {
        "id": "d6f16fd1.081f3",
        "type": "switch",
        "z": "bfa4b585.801268",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 350,
        "y": 1380,
        "wires": [
            [
                "f9570bcd.3f9ff8"
            ],
            [
                "da45cf95.9dd4",
                "2f7e29ed.ba84d6"
            ],
            [
                "c93a1048.a25df"
            ]
        ]
    },
    {
        "id": "f9570bcd.3f9ff8",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 590,
        "y": 1440,
        "wires": [
            [
                "875a5ae.55502a8"
            ]
        ]
    },
    {
        "id": "927b5d7c.27e1b",
        "type": "e-mail",
        "z": "bfa4b585.801268",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Fuel Confirmation Email",
        "x": 1170,
        "y": 1440,
        "wires": []
    },
    {
        "id": "3c621caf.609d34",
        "type": "catch",
        "z": "bfa4b585.801268",
        "name": "Error - FuelOrder",
        "scope": [
            "f9570bcd.3f9ff8",
            "927b5d7c.27e1b",
            "d508b47e.991e08",
            "314de6b9.2891da"
        ],
        "uncaught": false,
        "x": 1900,
        "y": 1680,
        "wires": [
            [
                "49c3f1d0.6c0a4"
            ]
        ]
    },
    {
        "id": "49c3f1d0.6c0a4",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2110,
        "y": 1680,
        "wires": []
    },
    {
        "id": "9718d9c5.db03e8",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.OriginAddress)\n// msg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}, ${emails}`\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}`\n\n\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 840,
        "y": 1660,
        "wires": [
            [
                "64214207.3950ac",
                "57fdf670.f24e08"
            ]
        ]
    },
    {
        "id": "875a5ae.55502a8",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.OriginAddress || msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}, ${emails}`\n// msg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}`\n\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 860,
        "y": 1440,
        "wires": [
            [
                "927b5d7c.27e1b",
                "57fdf670.f24e08"
            ]
        ]
    },
    {
        "id": "fa195cca.eec4c",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 1060,
        "wires": []
    },
    {
        "id": "1bcafdd4.313072",
        "type": "switch",
        "z": "bfa4b585.801268",
        "name": "Check If OrderNumber Exists in headers",
        "property": "req.headers.ordernumber",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 720,
        "y": 1120,
        "wires": [
            [
                "454a2149.ee975"
            ],
            [
                "c93a1048.a25df"
            ]
        ]
    },
    {
        "id": "454a2149.ee975",
        "type": "switch",
        "z": "bfa4b585.801268",
        "name": "Switch On Order Type",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1000,
        "y": 1120,
        "wires": [
            [
                "25a20c48.e6a9d4"
            ],
            [
                "66a3f400.42353c"
            ],
            [
                "c93a1048.a25df"
            ]
        ]
    },
    {
        "id": "44ee0835.9909e8",
        "type": "mongodb in",
        "z": "bfa4b585.801268",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetFuelOrderByOrderNumber",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 1610,
        "y": 1100,
        "wires": [
            [
                "8db1218e.4f2e6"
            ]
        ]
    },
    {
        "id": "25a20c48.e6a9d4",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Get Order Number Fuel",
        "func": "let orderNumber = msg.req.headers.ordernumber\nmsg.orderNo = orderNumber;\nmsg.order = msg.payload;\nmsg.payload = {\"PO\": orderNumber };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 1100,
        "wires": [
            [
                "44ee0835.9909e8"
            ]
        ]
    },
    {
        "id": "bcd5dfbb.7700f",
        "type": "mongodb in",
        "z": "bfa4b585.801268",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetWarehouseOrderByOrderNumber",
        "collection": "orders",
        "operation": "find",
        "x": 1690,
        "y": 1160,
        "wires": [
            [
                "6126d053.e3539"
            ]
        ]
    },
    {
        "id": "66a3f400.42353c",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Get Order Number Warehouse",
        "func": "let orderNumber = msg.req.headers.ordernumber;\nmsg.orderNo = orderNumber;\nmsg.order = msg.payload;\nmsg.orderNumber = orderNumber;\nmsg.payload = {\"PO\": orderNumber };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 1160,
        "wires": [
            [
                "bcd5dfbb.7700f"
            ]
        ]
    },
    {
        "id": "6126d053.e3539",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Order Update",
        "func": "msg.query = {\"PO\": msg.orderNumber };\nmsg.newOrder = msg.payload[0]\nmsg.newOrder.requestPayload = msg.order\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nmsg.payload = { $set: {'requestPayload': msg.order, 'TotalAmount': getInvoiceTotal(msg.order.items.items)}};                  \nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1980,
        "y": 1160,
        "wires": [
            [
                "efe37cf.ac8448",
                "e1ceb7e.f539848",
                "d9522eef.116ee"
            ]
        ]
    },
    {
        "id": "efe37cf.ac8448",
        "type": "mongodb out",
        "z": "bfa4b585.801268",
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Order",
        "collection": "orders",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 2220,
        "y": 1160,
        "wires": []
    },
    {
        "id": "57fdf670.f24e08",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Response",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: false,\n    Message: \"Order updated Properly\",\n    Order: msg.newOrder,\n    orderNumber: msg.orderNumber\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1304,
        "y": 1532,
        "wires": [
            [
                "573dbe1d.2568a"
            ]
        ]
    },
    {
        "id": "573dbe1d.2568a",
        "type": "delay",
        "z": "bfa4b585.801268",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1580,
        "y": 1520,
        "wires": [
            [
                "4d3c2ce3.2bf784"
            ]
        ]
    },
    {
        "id": "20fac78f.c02a58",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 270,
        "y": 1540,
        "wires": []
    },
    {
        "id": "d9522eef.116ee",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2190,
        "y": 1220,
        "wires": []
    },
    {
        "id": "2cfa836a.e7d9bc",
        "type": "http in",
        "z": "93d64002.30cc8",
        "name": "/api/dipatch/pullWarehouseOrders",
        "url": "/api/dipatch/pullWarehouseOrders",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 80,
        "wires": [
            [
                "fb68ad7c.fdc82",
                "c37f4dbd.27c45"
            ]
        ]
    },
    {
        "id": "473a7d4b.1ba774",
        "type": "function",
        "z": "93d64002.30cc8",
        "name": "",
        "func": "let email = msg.req.headers.email\nlet driverNumber = msg.req.headers.driver\nmsg.payload = { \n        \"driverID\" : parseInt(driverNumber)\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 100,
        "wires": [
            [
                "554b1b58.c5f5b4",
                "fb68ad7c.fdc82"
            ]
        ]
    },
    {
        "id": "22e6ad4.db13952",
        "type": "http response",
        "z": "93d64002.30cc8",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1260,
        "y": 160,
        "wires": []
    },
    {
        "id": "fb68ad7c.fdc82",
        "type": "debug",
        "z": "93d64002.30cc8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 280,
        "wires": []
    },
    {
        "id": "554b1b58.c5f5b4",
        "type": "mongodb in",
        "z": "93d64002.30cc8",
        "mongodb": "f76d58a.2802ea8",
        "name": "Pull Orders by Driver ID",
        "collection": "Dispatch_InProgress_Navasota",
        "operation": "find",
        "x": 710,
        "y": 100,
        "wires": [
            [
                "9c3bd090.e6eb4",
                "22e6ad4.db13952",
                "fb68ad7c.fdc82"
            ]
        ]
    },
    {
        "id": "8131325e.a475c",
        "type": "catch",
        "z": "93d64002.30cc8",
        "name": "Error - GetProducts",
        "scope": [
            "2cfa836a.e7d9bc",
            "473a7d4b.1ba774",
            "554b1b58.c5f5b4"
        ],
        "uncaught": false,
        "x": 1090,
        "y": 80,
        "wires": [
            [
                "22e6ad4.db13952"
            ]
        ]
    },
    {
        "id": "9c3bd090.e6eb4",
        "type": "function",
        "z": "93d64002.30cc8",
        "d": true,
        "name": "Format Response",
        "func": "let result = msg.payload;\n\nlet addressIDSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].customerID\n    }\n    addressIDSuggestions.push(obj);\n}\nlet addressNameSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].name\n    }\n    addressNameSuggestions.push(obj);\n}\n\nlet returnObj = {\n    nameSuggestions: addressNameSuggestions,\n    idSuggestions: addressIDSuggestions,\n    customerAddresses: result\n}\nmsg.payload = returnObj\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 160,
        "wires": [
            [
                "22e6ad4.db13952"
            ]
        ]
    },
    {
        "id": "c37f4dbd.27c45",
        "type": "switch",
        "z": "93d64002.30cc8",
        "name": "",
        "property": "req.headers.driver",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 250,
        "y": 180,
        "wires": [
            [
                "473a7d4b.1ba774"
            ],
            [
                "2bd2c6ea.0115da"
            ]
        ]
    },
    {
        "id": "2bd2c6ea.0115da",
        "type": "function",
        "z": "93d64002.30cc8",
        "name": "Invalid Email Response",
        "func": "msg.payload = {\"Error\":\"true\",\"Message\":\"Please enter valid truck id\"}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 300,
        "wires": [
            [
                "f8b13020.40ed2"
            ]
        ]
    },
    {
        "id": "f8b13020.40ed2",
        "type": "http response",
        "z": "93d64002.30cc8",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 720,
        "y": 380,
        "wires": []
    },
    {
        "id": "f749e432.b400c8",
        "type": "http in",
        "z": "f2cbf0d9.c520a",
        "name": "/api/dipatch/completedWarehouseOrders",
        "url": "/api/dipatch/completedWarehouseOrders",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 80,
        "wires": [
            [
                "c2170393.ebcbc",
                "d4da377e.7c19e8"
            ]
        ]
    },
    {
        "id": "764c1ef3.0ef9d",
        "type": "function",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "func": "msg.request = msg.payload\nmsg.payload = { \n        \"success\" : true,\n        orders: msg.request\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 160,
        "wires": [
            [
                "7d8de9f9.931958"
            ]
        ]
    },
    {
        "id": "7d8de9f9.931958",
        "type": "http response",
        "z": "f2cbf0d9.c520a",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1360,
        "y": 240,
        "wires": []
    },
    {
        "id": "c2170393.ebcbc",
        "type": "debug",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 80,
        "wires": []
    },
    {
        "id": "f3b49fe0.30ea3",
        "type": "catch",
        "z": "f2cbf0d9.c520a",
        "name": "Error - GetProducts",
        "scope": [
            "f749e432.b400c8",
            "764c1ef3.0ef9d",
            "c1b1d2fc.951d"
        ],
        "uncaught": false,
        "x": 1030,
        "y": 60,
        "wires": [
            [
                "7d8de9f9.931958",
                "7744992.9d21a68"
            ]
        ]
    },
    {
        "id": "d4da377e.7c19e8",
        "type": "switch",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "istype",
                "v": "array",
                "vt": "array"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 330,
        "y": 200,
        "wires": [
            [
                "764c1ef3.0ef9d",
                "c2170393.ebcbc",
                "bf9ef9c3.294ed8"
            ],
            [
                "91492dbc.1a6ea",
                "b01c3b3d.41cb18"
            ]
        ]
    },
    {
        "id": "91492dbc.1a6ea",
        "type": "function",
        "z": "f2cbf0d9.c520a",
        "name": "Invalid Email Response",
        "func": "msg.payload = {\"Error\":\"true\",\"Message\":\"Please send array of orders with Truck ID\"}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 400,
        "wires": [
            [
                "736a766e.7f3208"
            ]
        ]
    },
    {
        "id": "736a766e.7f3208",
        "type": "http response",
        "z": "f2cbf0d9.c520a",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 720,
        "y": 480,
        "wires": []
    },
    {
        "id": "4ba1aa50.9d29d4",
        "type": "mongodb out",
        "z": "f2cbf0d9.c520a",
        "mongodb": "f76d58a.2802ea8",
        "name": "",
        "collection": "completedDispatchOrdersWarehouse",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 1000,
        "y": 320,
        "wires": []
    },
    {
        "id": "b01c3b3d.41cb18",
        "type": "debug",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 211,
        "y": 359,
        "wires": []
    },
    {
        "id": "7744992.9d21a68",
        "type": "debug",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 100,
        "wires": []
    },
    {
        "id": "bf9ef9c3.294ed8",
        "type": "function",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "func": "let orders = msg.payload\nfor(let i in orders){\n    let order = orders[i];\n    let orderId = order._id\n    delete order._id\n    order.orderId = orderId\n    orders[i] = order\n}\nmsg.payload = orders\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 240,
        "wires": [
            [
                "4ba1aa50.9d29d4"
            ]
        ]
    },
    {
        "id": "f90f8fd6.8f449",
        "type": "http in",
        "z": "facee7fa.33b2e8",
        "name": "/api/dipatch/pullUserInfo",
        "url": "/api/dipatch/pullUserInfo",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 80,
        "wires": [
            [
                "f4dec650.74f0c8",
                "324412e0.086d0e"
            ]
        ]
    },
    {
        "id": "40903d87.059504",
        "type": "function",
        "z": "facee7fa.33b2e8",
        "name": "",
        "func": "let email = msg.req.headers.email\nmsg.payload = { \n        \"AssignedTruck\" : 1\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 120,
        "wires": [
            [
                "28f97e81.930462",
                "f4dec650.74f0c8"
            ]
        ]
    },
    {
        "id": "9c7a724c.2ebf1",
        "type": "http response",
        "z": "facee7fa.33b2e8",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1280,
        "y": 180,
        "wires": []
    },
    {
        "id": "f4dec650.74f0c8",
        "type": "debug",
        "z": "facee7fa.33b2e8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 300,
        "wires": []
    },
    {
        "id": "28f97e81.930462",
        "type": "mongodb in",
        "z": "facee7fa.33b2e8",
        "mongodb": "f76d58a.2802ea8",
        "name": "Pull Orders by Salesman Email",
        "collection": "Dispatch_InProgress_Navasota_Warehouse",
        "operation": "find",
        "x": 750,
        "y": 120,
        "wires": [
            [
                "9c7a724c.2ebf1",
                "f4dec650.74f0c8",
                "b055b6ea.909b58"
            ]
        ]
    },
    {
        "id": "ed8cd263.687c8",
        "type": "catch",
        "z": "facee7fa.33b2e8",
        "name": "Error - GetProducts",
        "scope": [
            "f90f8fd6.8f449",
            "40903d87.059504",
            "28f97e81.930462"
        ],
        "uncaught": false,
        "x": 1110,
        "y": 100,
        "wires": [
            [
                "9c7a724c.2ebf1"
            ]
        ]
    },
    {
        "id": "b055b6ea.909b58",
        "type": "function",
        "z": "facee7fa.33b2e8",
        "d": true,
        "name": "Format Response",
        "func": "let result = msg.payload;\n\nlet addressIDSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].customerID\n    }\n    addressIDSuggestions.push(obj);\n}\nlet addressNameSuggestions = [];\nfor(let x in result){\n    let obj = {\n        \"label\": result[x].name\n    }\n    addressNameSuggestions.push(obj);\n}\n\nlet returnObj = {\n    nameSuggestions: addressNameSuggestions,\n    idSuggestions: addressIDSuggestions,\n    customerAddresses: result\n}\nmsg.payload = returnObj\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 180,
        "wires": [
            [
                "9c7a724c.2ebf1"
            ]
        ]
    },
    {
        "id": "324412e0.086d0e",
        "type": "switch",
        "z": "facee7fa.33b2e8",
        "name": "",
        "property": "req.headers.email",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 290,
        "y": 180,
        "wires": [
            [
                "40903d87.059504"
            ],
            [
                "1b0f8b33.21cc75"
            ]
        ]
    },
    {
        "id": "1b0f8b33.21cc75",
        "type": "function",
        "z": "facee7fa.33b2e8",
        "name": "Invalid Email Response",
        "func": "msg.payload = {\"Error\":\"true\",\"Message\":\"Please enter valid truck id\"}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 320,
        "wires": [
            [
                "b7d0593d.7fd888"
            ]
        ]
    },
    {
        "id": "b7d0593d.7fd888",
        "type": "http response",
        "z": "facee7fa.33b2e8",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 740,
        "y": 400,
        "wires": []
    },
    {
        "id": "ab978435.3836e8",
        "type": "http in",
        "z": "64c352fe.7a49dc",
        "name": "/api/dipatch/SyncUser",
        "url": "/api/dipatch/SyncUser",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 100,
        "wires": [
            [
                "8b9363a6.e17e6",
                "be02fccd.79e9c"
            ]
        ]
    },
    {
        "id": "be02fccd.79e9c",
        "type": "function",
        "z": "64c352fe.7a49dc",
        "name": "",
        "func": "let events = msg.payload.data.events\n\nmsg.payload = events\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 140,
        "wires": [
            [
                "e6a73be6.7decb8",
                "375cf6a8.3251aa",
                "24c13b07.376884"
            ]
        ]
    },
    {
        "id": "e6a73be6.7decb8",
        "type": "http response",
        "z": "64c352fe.7a49dc",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1000,
        "y": 140,
        "wires": []
    },
    {
        "id": "8b9363a6.e17e6",
        "type": "debug",
        "z": "64c352fe.7a49dc",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 100,
        "wires": []
    },
    {
        "id": "be0efda6.b717b",
        "type": "catch",
        "z": "64c352fe.7a49dc",
        "name": "Error - GetProducts",
        "scope": [
            "ab978435.3836e8",
            "be02fccd.79e9c",
            "c1b1d2fc.951d"
        ],
        "uncaught": false,
        "x": 690,
        "y": 40,
        "wires": [
            [
                "e6a73be6.7decb8",
                "93367494.8e24e8"
            ]
        ]
    },
    {
        "id": "baebc804.db12d8",
        "type": "http response",
        "z": "64c352fe.7a49dc",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 720,
        "y": 500,
        "wires": []
    },
    {
        "id": "93367494.8e24e8",
        "type": "debug",
        "z": "64c352fe.7a49dc",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 40,
        "wires": []
    },
    {
        "id": "6aa735c1.fad23c",
        "type": "function",
        "z": "64c352fe.7a49dc",
        "name": "",
        "func": "let userEmail = msg.payload.target[0].alternateId;\nlet userName = msg.payload.target[0].displayName;\nlet createdBy = msg.payload.actor.alternateId;\nlet createdAt = msg.payload.published\nlet id = msg.payload.uuid\n\nlet userQuery = {\n    \"email\": userEmail\n}\nmsg.query = userQuery;\n\nlet userObj = {\n    id: id,\n    email: userEmail,\n    name: userName,\n    createdBy: createdBy,\n    createdAt: createdAt\n}\nmsg.User = userObj\nmsg.UserQuery = userQuery\n\nmsg.payload = userQuery\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 240,
        "wires": [
            [
                "614cb55a.2ef0fc"
            ]
        ]
    },
    {
        "id": "2f7a0a21.aa9ee6",
        "type": "http in",
        "z": "64c352fe.7a49dc",
        "name": "/api/dipatch/SyncUser",
        "url": "/api/dipatch/SyncUser",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 720,
        "wires": [
            [
                "489091c.746d67",
                "8de0f025.7760f"
            ]
        ]
    },
    {
        "id": "8de0f025.7760f",
        "type": "function",
        "z": "64c352fe.7a49dc",
        "name": "",
        "func": "msg.payload = { \n        \"verification\": msg.req.headers[\"x-okta-verification-challenge\"]\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 720,
        "wires": [
            [
                "2de5431f.d1eb9c",
                "b3b94711.de37e8"
            ]
        ]
    },
    {
        "id": "2de5431f.d1eb9c",
        "type": "http response",
        "z": "64c352fe.7a49dc",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 980,
        "y": 720,
        "wires": []
    },
    {
        "id": "489091c.746d67",
        "type": "debug",
        "z": "64c352fe.7a49dc",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 640,
        "wires": []
    },
    {
        "id": "acede19.39f132",
        "type": "catch",
        "z": "64c352fe.7a49dc",
        "name": "Error - GetProducts",
        "scope": [
            "2f7a0a21.aa9ee6",
            "8de0f025.7760f",
            "c1b1d2fc.951d"
        ],
        "uncaught": false,
        "x": 750,
        "y": 620,
        "wires": [
            [
                "2de5431f.d1eb9c",
                "8cdc147c.298258"
            ]
        ]
    },
    {
        "id": "8cdc147c.298258",
        "type": "debug",
        "z": "64c352fe.7a49dc",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 740,
        "wires": []
    },
    {
        "id": "b3b94711.de37e8",
        "type": "debug",
        "z": "64c352fe.7a49dc",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 660,
        "wires": []
    },
    {
        "id": "375cf6a8.3251aa",
        "type": "debug",
        "z": "64c352fe.7a49dc",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 180,
        "wires": []
    },
    {
        "id": "24c13b07.376884",
        "type": "split",
        "z": "64c352fe.7a49dc",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 370,
        "y": 220,
        "wires": [
            [
                "6aa735c1.fad23c"
            ]
        ]
    },
    {
        "id": "614cb55a.2ef0fc",
        "type": "mongodb in",
        "z": "64c352fe.7a49dc",
        "mongodb": "f76d58a.2802ea8",
        "name": "findDispatchUser",
        "collection": "DispatchUsers",
        "operation": "find",
        "x": 650,
        "y": 360,
        "wires": [
            [
                "3cf46063.edb34"
            ]
        ]
    },
    {
        "id": "8d2029e1.858958",
        "type": "debug",
        "z": "64c352fe.7a49dc",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 280,
        "wires": []
    },
    {
        "id": "3cf46063.edb34",
        "type": "switch",
        "z": "64c352fe.7a49dc",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 850,
        "y": 360,
        "wires": [
            [
                "8d2029e1.858958"
            ],
            [
                "52cd0c2d.de8214"
            ]
        ]
    },
    {
        "id": "871ff4a1.b0fb78",
        "type": "mongodb out",
        "z": "64c352fe.7a49dc",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Into Users",
        "collection": "DispatchUsers",
        "payonly": true,
        "upsert": true,
        "multi": false,
        "operation": "insert",
        "x": 1200,
        "y": 440,
        "wires": []
    },
    {
        "id": "52cd0c2d.de8214",
        "type": "function",
        "z": "64c352fe.7a49dc",
        "name": "",
        "func": "msg.payload = msg.User\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 440,
        "wires": [
            [
                "871ff4a1.b0fb78"
            ]
        ]
    },
    {
        "id": "f8c8b8d8.a95148",
        "type": "http in",
        "z": "93d64002.30cc8",
        "name": "/api/dipatch/pullCompletedWarehouseOrders",
        "url": "/api/dipatch/pullCompletedWarehouseOrders",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 460,
        "wires": [
            [
                "ccba0d56.4e90f",
                "e5cecd20.d9093"
            ]
        ]
    },
    {
        "id": "c05f4a19.5f8b58",
        "type": "function",
        "z": "93d64002.30cc8",
        "name": "",
        "func": "let email = msg.req.headers.email\nmsg.payload = { \n        \n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 540,
        "wires": [
            [
                "133ecef1.c50f31",
                "ccba0d56.4e90f"
            ]
        ]
    },
    {
        "id": "a7e8d13f.56963",
        "type": "http response",
        "z": "93d64002.30cc8",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1260,
        "y": 540,
        "wires": []
    },
    {
        "id": "ccba0d56.4e90f",
        "type": "debug",
        "z": "93d64002.30cc8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 720,
        "wires": []
    },
    {
        "id": "133ecef1.c50f31",
        "type": "mongodb in",
        "z": "93d64002.30cc8",
        "mongodb": "f76d58a.2802ea8",
        "name": "Pull Orders by Salesman Email",
        "collection": "completedDispatchOrders",
        "operation": "find",
        "x": 730,
        "y": 540,
        "wires": [
            [
                "3ebcf4ce.20351c",
                "ccba0d56.4e90f"
            ]
        ]
    },
    {
        "id": "4b2d6f2a.08592",
        "type": "catch",
        "z": "93d64002.30cc8",
        "name": "Error - GetProducts",
        "scope": [
            "f8c8b8d8.a95148",
            "c05f4a19.5f8b58",
            "133ecef1.c50f31",
            "e5cecd20.d9093",
            "e9ac3ac.c294bc8",
            "fcdb902f.22fa8",
            "3ebcf4ce.20351c",
            "a7e8d13f.56963"
        ],
        "uncaught": false,
        "x": 1070,
        "y": 460,
        "wires": [
            [
                "a7e8d13f.56963"
            ]
        ]
    },
    {
        "id": "3ebcf4ce.20351c",
        "type": "function",
        "z": "93d64002.30cc8",
        "name": "Format Response",
        "func": "let result = msg.payload;\nlet orders = [];\nfor (let i in result){\n    orders.push(result[i].order)\n}\nmsg.payload = orders\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 540,
        "wires": [
            [
                "a7e8d13f.56963"
            ]
        ]
    },
    {
        "id": "e5cecd20.d9093",
        "type": "switch",
        "z": "93d64002.30cc8",
        "name": "",
        "property": "req.headers.driver",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": true,
        "outputs": 2,
        "x": 250,
        "y": 580,
        "wires": [
            [
                "c05f4a19.5f8b58"
            ],
            [
                "e9ac3ac.c294bc8"
            ]
        ]
    },
    {
        "id": "e9ac3ac.c294bc8",
        "type": "function",
        "z": "93d64002.30cc8",
        "name": "Invalid Email Response",
        "func": "msg.payload = {\"Error\":\"true\",\"Message\":\"Please enter valid truck id\"}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 740,
        "wires": [
            [
                "fcdb902f.22fa8"
            ]
        ]
    },
    {
        "id": "fcdb902f.22fa8",
        "type": "http response",
        "z": "93d64002.30cc8",
        "name": "Send Error Response",
        "statusCode": "400",
        "headers": {},
        "x": 720,
        "y": 820,
        "wires": []
    },
    {
        "id": "8d7abe0f.ed4cc",
        "type": "http in",
        "z": "34623ca.2719ac4",
        "name": "Get products PRIMUS",
        "url": "/api/getProductsPrimus",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 720,
        "wires": [
            [
                "5bf54475.c507ec",
                "610bb3ff.5021ac"
            ]
        ]
    },
    {
        "id": "5bf54475.c507ec",
        "type": "function",
        "z": "34623ca.2719ac4",
        "name": "",
        "func": "msg.payload = { \"Description\" : /.*PRIMUS.*/i }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 780,
        "wires": [
            [
                "448975c1.04eb2c"
            ]
        ]
    },
    {
        "id": "c5a62e26.8dd7e",
        "type": "http response",
        "z": "34623ca.2719ac4",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 720,
        "y": 780,
        "wires": []
    },
    {
        "id": "610bb3ff.5021ac",
        "type": "debug",
        "z": "34623ca.2719ac4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 860,
        "wires": []
    },
    {
        "id": "448975c1.04eb2c",
        "type": "mongodb in",
        "z": "34623ca.2719ac4",
        "mongodb": "3846e700.384eea",
        "name": "Pull Products",
        "collection": "products",
        "operation": "find",
        "x": 470,
        "y": 780,
        "wires": [
            [
                "610bb3ff.5021ac",
                "c5a62e26.8dd7e"
            ]
        ]
    },
    {
        "id": "a94bed19.e927f",
        "type": "catch",
        "z": "34623ca.2719ac4",
        "name": "Error - GetProducts",
        "scope": [
            "8d7abe0f.ed4cc",
            "5bf54475.c507ec",
            "448975c1.04eb2c"
        ],
        "uncaught": false,
        "x": 450,
        "y": 860,
        "wires": [
            [
                "c5a62e26.8dd7e"
            ]
        ]
    },
    {
        "id": "ba6c14af.a38958",
        "type": "comment",
        "z": "34623ca.2719ac4",
        "name": "PRIMUS ONLY",
        "info": "",
        "x": 440,
        "y": 720,
        "wires": []
    },
    {
        "id": "c3dcc48d.3f1b68",
        "type": "http in",
        "z": "20a6f2ef.da319e",
        "name": "submitQuotePrimus",
        "url": "/api/submitQuotePrimus",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 1000,
        "wires": [
            [
                "f0fe6063.a7e6b"
            ]
        ]
    },
    {
        "id": "615fec9d.a02ed4",
        "type": "http response",
        "z": "20a6f2ef.da319e",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1500,
        "y": 1300,
        "wires": []
    },
    {
        "id": "4dad2ddf.0efbf4",
        "type": "catch",
        "z": "20a6f2ef.da319e",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 1290,
        "y": 1020,
        "wires": [
            [
                "c4cc0803.a89c78"
            ]
        ]
    },
    {
        "id": "b4cb2b30.bf2d08",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Get Order Number ",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1040,
        "wires": [
            [
                "8f832de1.7b05b"
            ]
        ]
    },
    {
        "id": "31282b91.6b7b94",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: PurchaseOrderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 1160,
        "wires": [
            [
                "a027c61.f04f638"
            ]
        ]
    },
    {
        "id": "4e2e7d98.4c5114",
        "type": "catch",
        "z": "20a6f2ef.da319e",
        "name": "Error - WarehouseOrder",
        "scope": [
            "a9b8cac.ec62938",
            "594d3f10.ccc1d",
            "7258f1ec.faa66",
            "9ad9a06.8cab06",
            "93c32e6.898dad",
            "7adc4cf5.20ec64"
        ],
        "uncaught": false,
        "x": 1280,
        "y": 1080,
        "wires": [
            [
                "793e4218.62736c",
                "615fec9d.a02ed4"
            ]
        ]
    },
    {
        "id": "8f832de1.7b05b",
        "type": "mongodb in",
        "z": "20a6f2ef.da319e",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetOrderNumber",
        "collection": "quoteCounter",
        "operation": "find",
        "x": 730,
        "y": 1040,
        "wires": [
            [
                "c084a4bf.e7a938",
                "fd508e79.fe2d6"
            ]
        ]
    },
    {
        "id": "fd508e79.fe2d6",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.payload[0].sequence_value\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = `DJ0F${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Quote.pdf`\n} else {\n    msg.orderNumber = `DJ0W${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Quote.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Quote_BlendSheet.pdf`\nmsg.payload = msg.order;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 1160,
        "wires": [
            [
                "31282b91.6b7b94"
            ]
        ]
    },
    {
        "id": "793e4218.62736c",
        "type": "debug",
        "z": "20a6f2ef.da319e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 1080,
        "wires": []
    },
    {
        "id": "7258f1ec.faa66",
        "type": "e-mail",
        "z": "20a6f2ef.da319e",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com, d.lee@kppetro.com",
        "dname": "Send Warehouse Confirmation Email",
        "x": 810,
        "y": 1500,
        "wires": []
    },
    {
        "id": "9ad9a06.8cab06",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAikAAAD9CAYAAAB5o+cOAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAXxaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDgtMTdUMTM6MTA6MzgtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmVjYzg4MWNjLTMzOGEtMTc0MS05MTE2LWUyOTAxYzNlMjhkOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjg0NWU2OGVkLTNjYTEtODc0Ni1iNWJlLTIyNTMzOTIwMjkyMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODQ1ZTY4ZWQtM2NhMS04NzQ2LWI1YmUtMjI1MzM5MjAyOTIxIiBzdEV2dDp3aGVuPSIyMDIxLTA4LTE3VDEzOjEwOjM4LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgc3RFdnQ6d2hlbj0iMjAyMS0wOC0xN1QxMzoyMDo0OS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgNIh6UAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyMTowODoxNyAxMzoyMDo1MEjTEeYAAEvRSURBVHhe7d0HYBvV/Qfwn7b3zt57kg0BwkgYZYY9W9oCBVpG2f1TdukuUGhLoYy2FCh7tZQZAiEJI4QwEhKyyB6O4z217/7vnV9i2X6y7k53kmx/P8rPfj9ZepLPiu6nG+85FEVRCQAAACDDOMV3AAAAgIyCIgUAAAAyEooUHaItO0QLAAAAUgVFig6h6hXsq9KaAAAAQEqgSNFBCVZRuHalyAAAACAVUKTooEaaKVixWGQAAACQCihSdFDCdRTYs5C3Wq8AAAAA26FI0UEN1ZESrKZQ1TJxDQAAANgNRYoOSqhe++7f+Zr2HQAAAOyHIkWHaLBS+x6q/IjUUI3WBgAAAHuhSElEjewvTFQlQv7db2ptAAAAsBeKlASUQCWpatv0RoFdb4gWAAAA2AlFSgJR/27RahVp2kqR+m9EBgAAAHZBkZKAbEj8QPkC0QIAAAC7oEhJINLcuUgJVrwvWgAAAGAXFCkJRJu3ilabaKCSIg1rRQYAAAB2QJGSQKRpk2i1h4HdAAAA7IUipQtqpImi/gqRtReq+VK0AAAAwA4oUroQadwgWp1FGtaLFgAAANgBRUoXwvXxjztRwg2k+MtFBgAAAFZDkdKFROOhRBo3ihYAAABYDUVKF8J1q0VLLiI58wcAAACsgSIlDiVQTtHAXpHJRSVjqAAAAIA1UKTEEar5SrTik41GCwAAANZAkRJHuOYL0YovGpCfngwAAADJQ5ESR6h6uWjFpwSrRAsAAACshiJFItq0JeHxKJyqREgN1YoMAAAArIQiRSJU9YloJcbHSwEAAADroUiRCFYuFa3E+ND5AAAAYD0UKR2o4QYK134tssSUcKNoAQAAgJVQpHQQ3LuEVDUqMh3UsGgAAACAlVCkdBDcs1C09OEHz8ajtmwXLQAAADAKRUoMvqsnVPO5yHTqYquL2rSFdyoyAAAAMAJFSozAnve63DIi5XCJhoTDSWr9OpEAAACAEShSYgR2vyla+jmcbtGScGaRUq//IFwAAABogyJF4PPwJJr1WMrpFQ0JVsCogSq+iUZcAQAAAHqhSBECO18TLWOc7lzRkhC7gpS6Ndp3AAAA0A9FCqdGyL/rDZEY43Dni1ZnDlGkqI3f4gBaAAAAg1CkMMGKD0gxOQeP0xO/SNm3JUVVwqQ2bNTaAAAAoA+KFMa//SXRMoYfNOvwloisa2rDWtECAAAAPXp9kRJpXE+h2pUiM8bpKxWteFTxnbX8FcQeSGQAAACQSK8vUvxbnxct41xZ/UQrDrWtSOFUVhABAACAPr26SFGClRTY867IjHPlDBateBTxvZXauIl/bU0AAACgS726SGnZ9rzxEWZjuHKGipYcP2A2lhppIfLvEhkAAAB0pdcWKWqkkQI7/iMyc1y5XRcp1KFI4bTTkQEAACChXluktGx9jpRIs8jMceePEa04lJBoxGjexioVjJkCAACQSK8sUtRoC/m3vygyc5zunMTHpEiKFG33UvN2kQEAAEA8vbJIadn6DCnhRpGZ4y4YK1rxacegyDRtEQ0AAACIp9cVKSorTvxbnxOZeZ7CA0SrC9E4RYq/XL4rCAAAAPbrdUVKy5Z/J30sCucpSlykqBG/aLWnqgp2+QAAACTQq4oUJVBBLSaHwI/lcDjJUzxVZF2INImGRPNW0QAAAACZXlWkNH37GKnRoMjMc+ePJoenQGRxKCH2WAGRSAT2YpcPAABAF3pNkRJp3EDBPe+LLDme0gNFKz41XC9actoun5adIgMAAICOek2R0rzxMVYYWDMkva/sYNHqQrhBNLqAIgUAACCuXlGkhKo+oXDtKpElx+nJI0/xdJHFpwZrRKsLgXJ2w6hIAAAAIFbPL1KUELVsfEwkyfPyrSgOl8jiU4PVotUFhRUogQqRAAAAQKweX6T4t71EUX6QqkV8feeKVtfUkI4iheNjpgAAAEAnPbpIUQJ7yL/jVZElz+HKYkXKYSLrmhqsEq0EUKQAAABI9egipWXT46RKZiI2y9fnULbEfCKLTw3VkBrVeXoxHzo/wZlAAAAAvVGPLVLC1SsoXPOVyKyRNfAE0eqaGtgjWjr5Dd4eAACgF+iZRUrUT/5NT4jEGk5vMXnLDhFZ11SjRYfRogYAAKAX6JFFin/b86SEakVmjayBx+k6q4dTjI5/EqhkX6wZwwUAAKCn6HFFSrRhPYX3LhWZdbIHnypaCahRUvn4JwZox83oOWUZAACgF+lZRYoaJv/mf1s2suw+3uJp5ModLrKuqf7drOgwMUCbhadJAwAA9AQ9qkgJ7vwfKTas7LOHnilaiSkmZzdWtV0+AAAAsE+PKVKUpi0U3rNIZNZxZfUhX795IkuMPw9T9I6rAgAA0Ev0jCJFDVNg67OtMwtbLHvIGboPmOVD8Kstu0RijMrHS4k0iwwAAAB6RJES2vkGKQHrt0TwEWa1IkUnvqtHTWbCQBw8CwAAsF+3L1KUpk0UqVomMmtlD55PDk+ByBJTGtaLljl8pFoAAABo1b2LlGiAQttfsfxsHs7hdFPO8PNFpk+0YYNomWTx2C4AAADdWbcuUkK7XiclVCcya2UNOI6cWQNElpjaspPUcKPITApiSwoAAMA+3bZIidaupGjdNyKzlsPhopyRF4pMn2j9atFKgnbgrPUH/wIAAHRH3bJIUUO1FClfKDLr+QYcS66cwSLTJ1qXfJGinZ2U7NYYAACAHqIbFikKRXa9QaoSErm1+LEouaN+JDJ9lJbtrHCqF1mSUKQAAABoul2REt37ESn+CpFZL2vg8ca3otR+JVrJUyMoUgAAALhuVaSoLTtIsbAg6Mjh8lHuqEtFppMapWjdKpFYIOIXDQAAgN6t+xQpSoCi5e/bcrrxPjnDziVnVl+R6ROt/4ZUKwuLaItoAAAA9G7dpkhRKpawYsC+YeOd3kLKGfEDkekXqf5MtKyhRrElBQAAgOsWRYpav46U5h0is0fuyIvJ4c4VmT58hFilcaPILBINigYAAEDvlvlFSqiW1OrPRWIPV84gyh56psj0i1R9av2khmpENAAAAHq3zC5S+Ap779LkJu3TIW/slfyoWZHpxJ5TpHq5SCykhEUDAACgd8vsIqXy4+SHmk/AWzqLfP3miUy/SO0X9jw3mwsyAACA7iJjixS1YR2pTVtEZg8+cFv++OtFZkykYrFoAQAAgB0ys0gJ1ZBa9YlI7JM95Exy5Y0QmX5K07cUbdkpMgAAALBD5hUpaoSU8gWkKvYeQOr0FlPu6EtEZkzYxnmDiBziOwAAQO+WcUWKUvEBqcEakdknb+wV5HDniUw/xb+bog32zL6scXpEAwAAoHfLqCJFqV/DwsYCQPCWTKesQSeLzJhw+Tu2jnqLIgUAAKBVxhQpaqiaorbuRmnlcHopf+JNIjNGDeylSM0XIrMJihQAAABNZhQpaoQiO/5DqhISV9gnZ+QF5ModJjJjgrvftH7wtg4crhzRAgAA6N0yokiJ7H6blECFyOzjZsVJ7kjj8/NwanCvNsKs7dwoUgAAALi0FynR+tUUqV4hMvs4HA7Kn3g9a7jFNcYEd75m+1YUDbakAAAAaNJapKihWgrveFVk9vINPJ48RVNEZozi32XPEPgSDm+haAEAAPRu6StSVIVCW58mNRoQV9gnmTFRuOD2l1OzFYXzoEgBAADg0lakhHe/TtHmHSKzV+6YS0yNicJFG7+lsN1n9Ah8mH4y+TwBAAB6mrQUKdGGtRSuWCQye3lLZpC375EiMy647VnRSgFviWgAAABAyosUNdJIwc1P2jsgmuBw+Sh37E9EZlykZgVFGjaKLAWyykQDAAAAUl6kBDY9Tkq4QWT2yh5+Hjmz+orMIDVKga0p3IrCOHwoUgAAAPZJaZESKn+HInVrRGYvd8FY8g08UWTGBcvfpqh/j8hSJLu/aAAAAEDKihSlZQcFt78kMns5nB7KGXOpyIzTdkltf1lkqeHwFGCMFAAAgBipKVLUCLVseIhUJSyusFfWkNPImT1AZMYFtj5DSqRZZCmSxPMFAADoiVJSpPCVfrR5u8js5cobTt6Bx4vMOH7KcWjP+yJLHUfOINECAAAAzvYiJVK3ioK7XheZvfhunuxRF/JW6xUmtGx8JHUDtwn8eVMOtqQAAADEsrdIifqpef0DKTndmONbUJLZzRMsX0CRxhSecryP9pxTdngQAABAt2DrmrH520dJCVSKzF6u3MGsSPmOyIxTI03k3/KkyFIsd6hoAAAAwD62FSnh6uUULH9XZPZyOFzkG34ea5n/dfybn0jZ+C3tOL1EOB4FAACgE1uKFH4Kb9Pa+0VmP0//eeTMHigy4yIN61hB9Y7IUix3MPuCXT0AAAAd2bJ2bGQFihKsEpm9nNn9yTPgaJGZoCrUvO5PKT9Ydr+8kaIBAAAAsSwvUkLVyymw+y2R2cvhcJJ36BmsZf7XCGx/gSJNW0SWYt4iTCoIAAAQh7VFihKkxm/+IBL7ufscQs5s88dzKP5yatnyb5GlQf4Y0QAAAICOLC1Smr59jKItu0VmL6evlNz95orMnKZ195EaDYostRz8gNm8ESIDAACAjiwrUiKNG8i/7XmR2cvhcJBn0Ems4RLXGMcPlA1VfyayNCgYw56/WyQAAADQkWVFSuOa35OqRERmL1fJ9KSGkVfDddS47k8iSz1+LA0VjBMZAAAAyFhSpAR2vUbh+rUis5fDW0CuvoeLzJzGtfeREqoTWRrw3TyY8RgAAKBLSRcpfKTWpg1/E5n93P2PTmo3SajyQwqkaJA5Gb6rioqmiAwAAADiSbpI0Ya+T9FWCWfheHLkDBGZcWqkmRq/uVtkaZI7nMhTIBIAAACIJ6kiJdq0ifw7XhWZvRzubHL1nSMyc5rWP0DRFM0lJMO3ojiKp4sMAAAAupJUkcIPPk3VwbLOskPYF5/IjAvXrNCOnUknBx9d1lssMgAAAOiK6SIlVPUJhapXiMxejtzBbAWfxJgi0QA1rPkdqaoqrkg9fkaPo2SmyAAAACAR00VK04YHRcteDqebnGWzRWYOf66pGmQuHgc/5dhTKDIAAABIxFSREix/myKNm0RmM34mjDtXJMaFa1eSf8crIksPh9NDjiQLLQAAgN7GeJGiRqnp27+LxF4OXwlR4XiRmcDnElrzm/TNcCw4SqZjXBQAAACDDBcpgd1vULRll8jso40nwg+WJfbdpKaND1OkeYfI0sPhziVnyQyRAQAAgF7GihQ1Ss2bnxCJvbRjOHxlIjMuUr+a/NteEFn6OMsO5pWKyAAAAEAvQ0VKYPfbKTkA1eHKIkfpQSIzQQlRw9e/Tv9uHlZkOQoniQwAAACMMFSktGx5SrTs5ShjBUoSY6LwUXAjzdtElj6ufkeKFgAAABilu0gJ7l2ckhW/I6sPOQoni8y4SP0aatn6nMjSx5k/ihx8CHwAAAAwRXeR4t/6rGjZhx8s6+o7V2QmqGFqWM3P5omKK9KDj+3i7n+UyAAAAMAMXUVKpGE9hWpXisw+zoLxRNkDRGZc87f/oEjTFpGlj6v0YCJPkcgAAADADF1Fin+7/WfJ8K0Prr5HiMw4Xki1bH1aZOnj8BaSq8+hIgMAAACzEhYpaqSRAnveE5l9XCUHEnkKRGaQGm3dzZOiyQ674u5/LKtUcMoxAABAshIWKYFdb7EaICgye/ABz5LZ+tCy5UmKNG4UWfq48ke27rICAACApCUsUvy7/ita9nHzU3VNnnIcbd5KzZseF1n6OBwucg88UWQAAACQrC6LlEjjehabRWYPp6+UXKWzRGaUKnbzhEWePq6+c7TB2wAAAMAaXRYpfFeP3dz9+Km6CTfoSPm3PUfhutUiSx+nt5j9HvNEBgAAAFboojpQKbhnoWjbw5nVl1zFU0VmjOIvp6aNj4osvTyD5+NgWQAAAIvFLVLCtSspGqwWmT08A45lX83Ncty49l5SowGRpY+7aDI588eJDAAAAKwSt0gJVrwvWvZwZg8gV9EUkRkT3PsBBSs/Fln6OFw+8gw+RWQAAABgpfhFyt4PRcse3oEniJZBSpCa1t4vkvTyDDiOHJ5CkQEAAICVpEVKtGkTRf3lIrNeMltRmjc/SdHAXpGljzNnELn7Hi4yAAAAsJq0SLF7V4pXOxbFOCWwh1q2PiOy9HE4nOQbeg5vtV4BAAAAlpMWKaGaFaJlPaevhNylB4rMmKYND2bGwbJ95pAzd5jIAAAAwA6dixQ1TOHaVSKxntfkuCiRhrUUTMEcQok4vYXkHYSDZQEAAOzWqVoI139j29YKhyuLPH0PE5kxTesfJFVVRZY+3qFnEbHfAwAAAOzVuUixcSuKVqC4skWmX6hqGYVqPhdZ+vAxUdzFM0QGAAAAdupcpNR9LVrWa93VY1zzt+kfWZaPiZI14rsiAwAAALt1KlIiDetEy1ruwgnkzB4oMv1ClR9SuH6tyNLHN+gUcnhLRQYAAAB2cyiKsv9ADzVUQ5WLThJZclzuPG3rg8PhJofTQ7kTriNP2aHip/rVfnIhhRvWi8xaTu35edhScGrPUfvO6rb9bf7cHS5y5Q2n3Cl3sXvEP+W48p9PUNOyT0XWzTmd5MrNJWdeHvmGDCbfqJGUO3MGuQryxQ0AAADs165ICVV/SnUrrhVZcmKLFJe3iAoOfow9Glv5G8CPRan7/DqRWU9PkeJk7ZwD7mCFykhxL7lt1/2Mql/5j8h6HofLRTmTJ1HxKSdT6Zmnkau4WPwEAADsokYiFNq1m0LleyhcU0PRhkaKNjdRtKmZlECA1ECQlEiYKBIlNRohla/SFYV9V0QP8TnYB1L+oVTG4WQfyrV1o7gNyx1OF1uNsw/vHg85eWRlkTMnm60f88hdWEjuslLy9u1L3gH94/ZrVLsixb/teWpc9yeRJSe2SMkadDJlj75E/ES/us+uoFDNlyKznp4ixdf/aMoadbG4R3xbe3iREsvp81HpOWfSgKsuJ09/9mK00daf/bxHLtd9//H5f3JXbg65WdHn6d+PskaPptypU6jg0IPJVVQkbm2dltVraO2pZ4rMvPyDZ9PYp58QmT5VL7xEW2++TWT2G3LLTdTvRxeJLPOUP/gw7bzPmvdbPYbefgv1u/AHIkts3fnfp8bln4nMvEn/e5VyJk4QWeb45rSzqWlV8sdgTln4FmWNHCGy5IXKy6nu/Q+o/uNl1Mz+vwa372DFR1T8tHtwZvkoZ9w4yp81kwqPmEOFh83RChsz2pU6keatomUtbz/jw8dH6tfYWqDo4WSFlm8YH1k2MbUXXaLBAO196mlaPfdY2sPeaHmlbxv2n5P33x1D6SKioRBF2aegcF0dBdinpCb2ZlS78H0qf/hR+vbyq+jLGbNpww8uooalH4kFYRFVlT4fo2HmTZN/spP1ZVfsfuAhUpqaxKNnlgj7u+9+6BFSwuy5pij4394I/jeW9WM0jD5uqigK+/0krxujYZWGZZ/Suh9eTF8ecgRtZsV89f9ep8CWLdrWEbYQu1XwLTxNK1dS+T/+yX6nH9HnMw6ibXf+koI7d7GfG9OuSIk2bxct67iy+pIrf5zI9GvZ9pxopY9v6JnkYIUKyEX9ftp597207vSzKcSqfTvI/wv0/FDYCqJu8VJad8EPaf33L9Q+XVlF9nhmwgy+vkpVhGpqtUIgE+36y0MUbmyULlc7wwjZ/c1EZpM9Y6ORnNCePbT+R5fRmnO+S7WLFrPiSZE+SneOcH0D7X78Cfpq3rG04+4/khoOs2v1aV+k+PeIlnXMDN6mBCspWPGByNLDlT2QvAOOEZk+sj9Obwi+yXTNyadSkwWbhjuSPV63CfbFiqhb/CGtPv4Uavos+bGCWHfSxzATRvG7pDrK//EvClekf0LSWPzTZMVT/2Yt2TO2M4yS9WEmMpPsmZqJZFS/8RatPPp4qnn3PWnfPS2iwSDt+OtDtOqUM3RvVYkpUlRWHFj/n9lbdoho6eff/jKpio27EHTIHvE99rVdDdcl2R+kNwWvlNexT/x17y1imYVY57IVZLeI1qdvSYRqa+mbC35IdR8sZllyZP0bDXNkPdkbUX8L7bz/z6ydOXbcc5/2Zi1/xvaFUbI+zEQmkz1fo2FW+T//RRuu+GlatqilO5rWfEOrTj+LAlu3saxr+9fCSrDa8sLA6SsjV/4YkemkRimw63WRpIe7YDy5S2aJTB/pSqqXRdQfpA2XX0WNn1q3RYV1221Dfq35UPx+2viTq8i/LtlT8uX9Gw/jZL3YHRUvvESBzVtYK/1avllLlf99Tfo8UxFGyfowE5lI9jzNhlE1by+gLXf9mhT2xinrrzdEsGIvrb30J6QGQyyLr61ICdWKlnW8ZQeJln7ByqXsU0a1yNIja/h5omWM7A/R24IfMLX+sp9QaPdulllB9ijdI+TXJheRlhZazwpBI/t0O5L1aybMkPVjd/CDG7f94R7WSr9tv787bcccGCXrw0xkKtlzNRNGReobaONNN3cqUHqj5vUbaMdDD4tMztYixVMyU7T0C+x8TbTSw1M8hdyFk0RmVOxLrncG/xquraMNV1zNXlTtz9NXo37R0q/zIyBaNm2miqefZS1zZH2aCaNkfaQqqt56hxq/SO/ZgvUff0I1HyyRPr9UhFGyPswEtLf77//Q3iM74u+evfGy6x//1D7cxrO/SFHD9aJlDYfTTZ6iqSLTRwnVUKhqucjSI2vYuaJljOw/Z2+OBrZCKH/iKdZq43Bls/+cX4hMP1n/vT12P/4k+2qOrD8zYYasn1TF1t/+gX1NH/74/HlAZohdUSZzaX116bfn+Rf237f9pf3rtbdEuKGBqt5+h7Xk2oqUSItoWYPP1UOuLJHpEyxfQKqavkFrPIXjk9iK0nnh9/bYfu/92ngQsSL169gP9R/7JOsXQdSyZQu1rDM+z5asLzPRHdUv/4xqFr4vstSqev1NahQDh8WullJ9MaL1b538JVPtey0nG0Y0rVxFgT0V0n5ij+/rbVHzfvyzeduKlKi1RYqnaIpo6RfYHb+aSoWsoWeLlnFsOSM6BD9qfdcjf2etNu780eTf/orIEpP1213CbvXL0rvV0ajW5ZLey9bf/4E9iVT8dWJEo7T1nntjnkXbaySVYYasH6ORsdiT67iyNBNG1K/4XNqHFuznvTXqP4+/hT2mSAmKljXcBosUxb+bwjbNwKyHK2cQeUoOFJlxsgWfTLjy86n4qHlUdup826P0xBMob/o0cvh80udiJDoqf/Lf7fY3ekpmkH/Hy+zG5g/87C7aVkr2XJpWrxaPZExsH8lczOj4ekl1NG3YSBUvstdfCu3+9zPUsmVr2/NgX9IVRsjubypEf5mGPy8rwoimdeulffDozQI7drL1hLwG2T93T/Omf1Dzt+0/9ZrlcDipz9EL+Yho4prE/Fufocb1D4gsNWLn7skbfzX5BpqfAXrDtTfS3ldeFVlyyk44jsbc+wetUEmlaFMTVTz/Iu348wMUrjN3jJJs5TXu/nup75lniIxVzV/epJ35lT0k8RwyG667kSpe1r/lJZPY/cZTeOAsmvryCyLTp+nr1fTFSaeIzLyiQw6mKc8/IzJ99jz7PK3/v5tFlj6+gQNo9pJFrCj3imvsw08b/3TOXApVVopr0rdCGnPXHTTo4gtFlthXZ59PdRbM7D7r7dcpb9JEkWWOL+afTg1frRSZebMXL6TskV1PQLtPV8vUbOHvLSmh/GlTKXvYUPYhsIScbjdbue3f/mAZPk1CpL6e/Nu2a8ccBvdaO67awYvfky7HtiLl28dYofJP7cpkufOGU8kcY2cf1H56GVsxJj/ZkxH7ihSHJ49KDnuOXeETPzFuw7U3UIUFRQp/oc18bwE5vPa/gcYT2lNBay6+RJtPxijZf7PSo+bRpH/9Q2R8sL4XqYUVpaWHv8SPphXXyq3vzkWKzWujrCGDafbHS0SmDy9SPj/RgiLl0INpqsEipTxDihRu1K0/pyE/uUxk9tl6/59p632ZMZgcipT2Pp9/miVFSryVq8ynRx5FLXHG7DH6dlHACpNRN99ExYcaHzDVClUL3qUNt91BgXJrRqqf+epLVDir8xnBthQpWQNPoIID7hBZYmq4gaoWncje1FN70Oy+IiVr8CmUO+6n4lpz1ltUpAy75qc07IbrRJY+kbp6+vLU08m/xdikk7IVsys3lw5b8xVrtBYk0aYtVP3Rd6lw2m/I1+8o7bp4eJGy56Xki5Shl/9Y+7SRMmxB8PE5Ig0NFKrYq42wWPfJMoo0N4sbJM/Nl+s6Y4U9L1JWWFCkFHfzIsVTVEizP1pC7gL7tlaGq6u1rSgd/+ZmPzEna8xdd9JgA0XKl2efZ0mRcqBWpJg/IcEuKywsUnJ0FikfTp1JoZoakbVn5FVRNHMmzXjhmbR+mOX4+uHT407U5nFL1rQnH6fSeXNF1mb/NiF+yrBVPPmjRUufUPWnKS9QYmUNMr+bZx/+Atu/DzaJ8A0c2NphmrnZm/j4++9jLYf0ecYNdo+Owd+k+b7YfVx5I8jpKSD/thfFNfHJ+jMT+TNnUNmJx6cuTjqB+p46nwZ+/3s0/MbraPLjj9EhX3xKw6+9mv1fs2ZTbLSlhf1y/LfrPlqPZkn/JVRXR9se+Kt4VvbY+qe/ULi5KeZR913avzZTFWbI+jEamUr2XM2EEWH2Xijrw2iMuvn/0l6gcNkjhlO/00+VPkejocQZoLLt3dJhXZHiytNXVe4TqlomWqnnzh9p+PnGI1vwRsOOfYlm5c+YRkVHHiF9nvEiHj4AWSxP0WQK1X5FkcaN4pqez5WTQ8NvuJZG3XErW1bJXxRVMfwJpvXvZMXFnNjXipnwlJWRMztL+jOjsfNfT1LQwtmlY/H99rueflb6uEbDN6A/5Y4bK/2Z0TBCdn8zkclkz9doGMFXxLI+eOjlcLmku0XSpfgg4yPLS0XbD/65T8yWFPPHY3TkZp+UjQjVGB/gyyq+/sZmOu5t+px4vGjpE7sai70Edu4Ut2jlEePRJJqnKbaPZC7G3gbsNfhHF1HW0CH7n1VSETJ+lpS0HxNhlKwPo+EpLaEhl14i/ZnRiAQCtPne+1nLepv+cA9Fu1ghGYlRP7+JnKzAlf3MSBgl68NsQCu1wyjcsWTLTRYOr0crVDKFu7BA+jzNhExbkeLJFa3kOJxecmb1E1liir+cfRq05sAboxwOB3kTHBOhV+wKMdlLJmn9BGfk0vmFxyPS1MS+tnEXtE48GShfwG7Q9a4+WX9GI9Pwg4llz9NwRI1PCirtx0SYIevHaAy78nLy9u0r/ZnR2P3yK9S8wdqteXzQtorX35A+Hg8jCqdNpf5nnCYysJLsb2MmDGHFhawPLVT2/qkjIi1+Csc5riUd8idPpsl/uT/pKJwqH7akrUhx54lWclzZ/UVLH77JP13cBRPJ6SsVWXKkLzoTkWlceXnS52k0oh3OgXfnj9W+K6E6ClV+rLVlZH2ZjUySO26c9Dkaji4+mcUj7cdgpBPfbTbSooPL+WmV3/7O2uHyN/7299rKJJ6OyzJesE9RNPYXrScgyH5uNIyS9WEmMlXHlb/ZMPJLOtxuaR9asJ/rjd2v/Id9zQy+/v1owOmnJR18aACZ/UWK023NUe6ubPkDxROpN36aq1W8/Y4ULWvIXkxGI9Pw8+Jlz9No8OMIYvGtbQ536zg6gYr4Q5XL+jITmcZbZk1xbNVBuKkg+7uYCW7Q+edS7nhrCr29C9+juuWfsVbyqhcvoeqPPpY+zv6QraAk0Xf+SVQ4cwa7h/77dBnaoxsg68NEZKp2f5MkwoiudtsZsfEP91DFm2+JrGdrK1J8JaKVHKevj2jpE05jkeLrM0e0kid70ZmNTNKw6mvpc4wX8bgLCkSrjTtnqPY9VPkRu3P6zu5KB4fHK11+RsPhMn7Au6wfM2GcfCVmNDR8K8Ptt0p/biY2/OZ3rf0maYPYitJlsNslCl7Uj721/enastsZCaNkfZgJaOMp7Pw+uI9s2cWLiN9PX152OS055HD6+prradP9f6btTzxF5f/5L1W++x7VfLKM6r/8ihrXrKGm9Ru0A7kDu8spVFWlDdQZbW7WRnhVI8Z3F6daW5HitahI8RaJlg5sxRRp3CSS1HLnDGZvBINEBvHs+e9roqWP7D8Uj+yhrQVJLFfuEO27Em6kcG38afRl/RmNTMN3M0hXYAbDmWVsEk9teUj6MRNmxP5NzESs0iMOp7J5c6W3Mxq1n39Be7uYiVWP8lf/Qw1rvpH2Hxt6DL/sUsrKkOEIejLZ38dM6OUp6yO9v9lo3rGDdr78Cm344/205tbb6aurrqEVF/2IPj37PPp4/mn04XEn0dKjv0MfzDmCFh10CL03bRYtnDyVFoybRO+MHkdvDx9Nbw8ZQe+MHEsLxkyghRMOoPemzKBFs2bTB7Pn0GJ2vyVHHkUfsj4++s4J9PHxJ9MnrN9lp59Fy9ljrPjeD+jziy6hr664ir6+4We09s5f0kb2XLb/60mqeOtt9v9hTdzh7vVqOybFU6Ad9Josp7dYtBKLNm8nVUnPHC7ePtaO0id7AZmJTFL5zgKqY9W47HnGDcnKjEfu6M6necceYB2Mcxo6u2unvkyF6C9ThOvqOi87g+HweNgyNH5WnqwvM5EJ+NYUq8502PD7u1nFbPwYH04Nh2nj3X8UWddkyzI2fP360YirrmCtNrLbmQkjZPc3E5lK9lzNhBHZQwZL+0hnKOz9MRoKaVtnQo2NFKypIf+eCmrZtYuat22npk2bqWH9Bqr/Zi3VrV5NtWydUPPZCqr6ZBntXbyEKt5dSLtfe512PP8ibfnHP2nj/X+m1bfdQZ9f+hOtSFowfhJ9fNIptPG+P1HzJuMbJdrt0HblDhYt8/gQ83pFmtKzFYXzlFh8njn7a0tXjkZDdJdufPPgmp/9XP4cuwp2347hKS6i3DGtZ/PEcmX1FS0+OucK0WpP1p+ZyDRm/rN2xOfp6E5kfxczEStv7Bga/N3zpLczGk3fbqKdzz7PWsZtf/Lf1MI+1cr6NRpjbvoZubLbz3smu53RMErWh9nIRLLnaSaMyB09StpHa/TMSzQSptqVK2nDfffTB0ceRcvOOY8q31/EfmN92hUpbgsGNXMYmFSQb0lJB+3U4+LpIrOG/EVnPDJBw8pVtPysc7SKWvYcuwqZ4kPkW62c3raDR/mgbmqkUWQ9X+XipdLlZySyBhg7k24fWV9GwyxZX0ajo9E3Xk/u/HzpbY0G/7QXO2u3Hvz0+m///IC0P6NRcMABNOics1irPdltzYRRsj6MRqaKXZEmczGCn2Ybe9/YS29R/fEntPwHF9Kys8+llq3bxLXxpbdIaWk/wFequHKHa7u3oL3Gb9bSNzffSstOOd30pFGxb077YsCp89nXzpzeQtFit1MVCtetFll7sj6NRibZ+84Cql+9Wvo8jUTOqFHsq3GyvsyEUbI+zERH3tJSGnHl5dLbGg1/RQVteaxtMkw9Nj/0sMGCPv5lwl23s1t0FnsbsxejYu+bzAXalMw+iFw++S7a9q+Rnh98d9GS40+kykUfsCy+9rt7DI4UK5VgVttYUf9u0UotT6E9M3LK/hBGw4gaVpGuuvo6+vS0M7UDmj4+/iRT8dHR36H3Jk3VDoza/tTTpPCDOln/VgTf1dPnWPmovh0LxUj9WtFqI+vTTGQEVaWdz79IX/30WulzNBqF081NmCjry0yYEbvyMneRG3Hpjyhr0MCY25m/bHrobxSurRM9d41PV7/5sb/H3DvxJZ4BJ59EJVYNMQ4Jxb6Wkwkj+IHufY4+StoPe3vodRFubKLlF19KVUs/ZEtArl2R4ilI7XTa0cBe0Uotd+EE0bIOW96WhR573niTlp/3Pdr1yqtUs+Jz7ZN5/eo1poIfFBWyaDyUjjHs4ovIGWcirI5b3cIN60SrPVm/RoP/nlWLl6QuPlhMe99dSLtefoU2P/worbr+RnrvoINp5Q03UriFTzKW3IUcRH2Omsd+M2Ni+0j2kkmc7NPp+JtvEllywo2NtPHPfxFZ1/juIXPzJ7UP/vwndDjluCPZ/YyEUbI+zETGYk9OtuI0GkYNZ++Jsn7Yv14Z/KDdFZdfScGKCpZ15lAUhd9uv+rFpyZVPBTNvJ+8ZQeLrGuV7x5JqhISWeoUz36EPEXyIXjNWnnN9doKKVlT/ng3DT73HJHJ+XftoqVHH9dpqPlMELvy8hYV0byPl0rHSOGUYCVbmZ8iMtJGKy494lWRtVp57fW086WXRQb7lB02h2Y/94zI9Kv/+mv68ISTRWZe6aGH0MEvPCcyfXY8+xyt/FlyhUT+uHF05HsLRNbZhyefQnUWTL/PN8nPXfw+ZQ+OfzJB86bNtPjoY0kxONYEXyF1NOaqK7ossj48+VTtrIpkTP7lL2jEjy4SWWIfn3kOVS/7VGTmHfnOm1QwuXWurkyy9KRTqNaC18rRSxZR7ihjh0rwrQd73mn/Os60wj/VBp92Ks188AGRtWm3JYXzFCe58lb1nVKsRprSUqBw7jxz+/K7tu/zZXIXPdb+6jcUbmqMuVfmXGKNu+lncQsUztFh16DCi+M0vSbswJeGHcHn/xj3c/Mre1mfRsOMTp8cTUSiB594x+3S+xmNSCBI6+6+V/Qqt/b3d1M0HJHev8tg940NX58+NObqq1grvo73MRNmyPoxE5mo9blZcTFu2r13swJ4UEwfmbqUUmfXa/+j5i1bRdamc5GS5BYGNarvyPh0ncnh8pWRw23NZIrpwAeL4rt6MtW+N6WS2bNp6Pcv0K6LzyG+t+IHz3Y8mHpff90y2Bc7YsKtt1DRNHPHo3CyPs2EGfxuyUZXSg46kAacdKL0fkZj56v/1f6/ydR+8SWVv/W29H6Jo/1l3P/dSK7crt+TZPczfjHGmsc0+qi9g7ekmOa8+BzljWw7DrR1effeUBSFtj37LGu116lI8ZYeKFrm6C9SmkUrtVw5yY8FIyNb6GajK+vv/aM2+I7sfhkR7Iu3pISmSzbbdSR7A4v6d4mWwG4Su2LsVtH69C0LftzClD/8lkZedgnLzJP1bSaMar1f8pdEJt52szadfex9zFwUJUrf/O73otf21vz6t+z/oRJza/2XWIWTJ9Gw888VGaTSvtdxsmFWztChNPedt2jkJRdrW0dlffe22N1hFxjXqUjhp+canSQwlhrWt4VEiRg72Mwqrhx7hpqWrqRMhPaXioPva9+zYKH0fpkSfM6RWf94jLL6t40mG5fSebhkJdh+CnLWZTcOay58g1P/E46jIxe8RcMu+B7rOTmxfSdzyVT8zX/kRReKLDkViz6gqo/az9Jd8d77VP2p+WM1Yl8jk++8g+/35FcnFHs/M2GUrA9TwYq5TCR9riYiGXxG7wPu+gUd++Fi7TXLt7DIHqO3RMO3myhU034d0KlI4XxJDBmvhGpFKwE1PRMbGZ0A0QjZQjcT8fB95LLbZ0rwAuXAxx6hkgNnsSwxNdq5SIkGq0SrVexKsbtdkpXdvz+N/smP6eili+mgvz9KeaPtOJYqtTq+ZsyEHmOvvZo8Fr3h860m+7FKfA2fRJA3k4wBJxxPZYfqe6+V3d9MGCG7v5lQgpl5nJkSjUifr9GwAi+sp/76l3TSyi9p7mv/oQNuv1U7kLRoygHkKSyUPm5PjdpVq9jXNtIixVuWTJGib3wBPrlgOjh9ZaJlrdiVUzKX1j9TZzXLl1PF4sX7b5dpF09RIR3yzL+p77y54hknxg+e7kjV+/rpBmL/4xmNMT+9kuYtWkiT2JtV7ojh7BpryB7LTJgl68to6OEpKKDx110nvb/RqGFvmrv+9zprEW1/8SWqX7dOejsj4fB6aTL72+ol68NomCHrx2jwU7ozUZQVT7LnazQs5XRSycwZNIZ9ODnowQfoqLfeoPnffE2nbVxHx3+8lOb97z902NNP0uy/PUgz7/kDTb3rTjrglp/TxBuuo/HsPWPsjy+l0ZdcTCO/fwGNOP9cGnb2WTT0jNNoyCkn06ATT6CBxx1LA44+ivrNPYL6HnYo9Tl4NpUeOJNKpk+j4imTqXDCeCoYO4byR42g3CGDKatvH/IWFpDT62FPTvbbWx9Nm7ew7206nYKsUcNU9f4JpJg4bsRXNpsKZ/5JZPGFaz6n2s+6PqLdDoVTf0W+/vLBxZLxxdXX0g4LTkGe/sd7aOh5nfdRf3TmOVS1TD4JX7oVT59OBz78YJena8qEKj+kui9+JrJW2YNOovzJt4mMLddrrqPt3fQU5M7/sYxxut1UMmsWDTn9VBpy5hmd5nMxo+7rr2nR8SeJzLw+hx5Ch71obJ6brc88R1/87P9EZk7BuHF0zPvviqxrfKbphfOOpsZNm8U15uWNGEFHvfOm1l/LruQGoeSvi7FsJcQ/Leu16ORTqebL+DOF6zHtl3fRKAOnIC895zza22FXlxkz77mbhn/3PJFljjemz6TA3uTH6jpuyWLKM3gKcnekhEIUrq+nQFWV9n+ggRXrlWydtPfDj0gJWzdR8NjLLqUpfDeoIN2SQg4PefseIRJjdI8i63SLRmo53PonQDSirQ5MLmQql36ovRhkt09nuHKyaeItN9Ph/33FcIHCyXYNqtH2xyrJHre3RDQS0f7uX9x0M701azZt+vs/2bXJkz2WmTBD1o+RMILPjjz51luk/RiNxi1baMlZ51Ize3OW/dxI+EpLaMK1V7OWEbKezIR+Vn16rl8vH6Qxnfis1YHqasmzNR4Ol3w12tPwQTn56fKFEybQgGOOpnFXXUmH/fspOuGTj6jvnDntjk1MJoIdRnuOu3SzBpjb2hD165vzxcEKoXSw8/RjtnwtiY6+uSezjkXhQzuPvPgiOmbpYhpz5eXaysCMaKDzCIOq0rkilz2H3hbBujr66s5f0CcXX6K9wSZD1r+ZME7Wi5nQb8Bx36E+h/DBJWX9GIvaVXzgL/nPjMTE/7tRmxDRCHlPxsMIh4efISXvx0hULV/OvmaW+vUbSIlEpStJo+Fwp2ddlimyBwygQx//h2UH/YbYe12suEWKt3R2uwng9OIrGSWQuFBxeOzZopGIwykfoj1ZsoVtJjraw88k+PwL6W1TGQ6+6+HAWTT1N7+iEz5fTlN+dRdl9Tc3C+8+il8yDHKHMx1kz6W7hPza5GL3O+/QV7e1bQo1R963sTBO1ouZMErbdOx0SvtKdRSMH08jv2fiDC12Z9kK0kgY5SkolPZjNGpXraamrZ0H6UonvouCPTVLwunTv0759KfX0KLTz5TG+zrjkx9fLnrLHO7cXOo3d650+RiNSKj9gdbyY1KEpnV/opZtxvY7c0Uz70t48K0aqqHKRcnvGzeqdM5T5MobLTLrrLj6WtpmwTEpM/94Dw2POSZl3Z//QvXfdJ54z04O9obOX3TuvDzKHTqU8keNpJJZM7XrrFS3/McUqm1/JHdWv7lUMO13ImPL9ZrraNtLL4mse4n7H8sCRzz3LPU9/DCR6cePSVl4/IkiM6/voYfSEQaPSdnyzLO04sbkjkkpHDeOvrNoocj0++za62nrCy+KLH2OfN7c3+29k06h6iSPSZnOPliM+dHFIkvsq1/8kjY8+pjIkjPi3LPpwPvvE1n6vT3vaG1rihXO2rRB9/Fib889iuo3bBSZObmDB9HJyzPv+MRVv/kdrX3wIZGZ12/OHJr7YtuUG10WKdGmLVT90XdFpl/e2CsoZ8T3RRaHGqXKdw9nlbadb+WdlRz6FLnz7SpSkj/Ac+Yf721XpPRkVYuOJyVUL7JWWQOOpYIpvxQZW7l05yLFxpc2Pyp/7ivGl0vtKuuKlCNfMl6kfGZBkXKciSLFv2cPvXXYERRpSc/4TNzAY4+hw554XGTGLLSgSJlhsEhZ99DfaGXs6ddJcDgcdMjDD9GQ+cnPG5Ws9Q8/Sl/98lciS47T46Gzt+k/MPvtecew4mi9yNrjZ0nq4WYF0Vmbkit07MCX6bqHHxGZef0OO4zmxcwL1uURP668EeQ1MZdPpGmTaHXB4SKHt1gkKWTTqc/85WVF9BZ8csGOBQonO2YodtNxtwr+3G2Kyk+XUyDOrKGJyPozE0bJ+jATZvAxZ/gZNbL+UhH8+I6pMWcsdAd5w4aJVvL4h9FlV/6U1v/tEVKV9Azuxh933d/+Rl/9+tfsb2LNhR+HYYTDzUeWjXdp/5qJF2G/n2pWJj8xotX4QGyy52s0HJ72J9V0uSWFC+x+ixq+bvtkq4c7dwiVHPaCyOKr/eSiuNPz28WOGZC55XxLigWnyh54X+/YkhKqXEp1X3T+VJ074gLKHXulyNhyveY62vpi8ltSxl56CZVMtf7vHg9/Q4wGg9pBYE3btlPVZyvifoIya86jD9Pgk43tMuVbUhZYtCVlnsEtKZst2pJyvIktKVyUvbm/cejh5DdZ3CVj3GWX0rRfmC9S3j1pvgVbUn5JYw1sSeHjwbx1lPXDNeQNHUojzj1H26xfOG6sNliZXYI1tdr/O36W3NZXXqWGTTo+QBtQOm0afefN1jF09Hj35FOo6osvRNZelyviDoadeirN+duDIks/f3k5vTbncIoG9E2L05WhJ51Ihz32qMh0FCl8y0P1ktPZg1eKKxLjm/bK5r3DKqKuj2BvWHkrBfa8L7LU0HO8jBm8SNlqUZEyohcUKc3fPkrNmzpv+s4bdyXlDG+bmPBTi4qUw/75dxp0/HEiS4+9H39My666Rtv1YIXJN1xPk264TmT6pLtIWX5j+3FxjOJFygmL3hOZcVuee54+vf4GkaWGr6SETv74Q22AObMWWFCkzDRYpPBC+6Wx4ynS0iKusR5f+biyssjl85HTbe4swY74Vkw+bgdfYVo5fofM8DNOp0P/mniesn3eP/d82rN0qcjaM1KkcNNvu5UmXpH+g2gDlZX0wQ8vouqvvhLXJGfUeefRwWw9uE/iE7wdLsoedo5I9OGb9iIN8tlDY7lyh4pW6uidW8go/gKzInqLcK38DdeVpWPOn25KO9j0qX8l2OSr/9JSbm5Qsdg+zF7MvFpjX+dmI1n8E3zRxInSvu2KyTden1SBso+sbyNhFD+AvnT6dGlfVkaEFRPB+nryV9dYEoGaGgo1NlKUFSiyx7MyiidNYl/18xQWSPvhYdSXv/4NvXX8CbT+n49rW2f4AGt8y1G4oUEb5deWYH3zAfDq1q6l7a+/Tstv+rm2BcWqAoXLKisVrVa6RqHJHnw6q3KNndkRrk28z8yda90+T72UULVoQdooIQrXyYtYp6+vaO0Tu2o0f8kURexNbeBx39GeUbLB34zNkPVlJsyQ9WM0kuJw0LQ7b5f2a0fwIcZH/+AHrJUcWd9mwqgBR82T9mNVdHd9D54tWvpklcWfO45/uDca1StX0We33kZvnzSfXpl1IL04aTI9P24CPT92vD3B+n5p6nR6/ahjaMmlP6YNTz6lFYSy52Y2cgYNEkukla4ihR/MmD3kdJHpE65JvGnSnT9WtFInGrSnSGGL15JLbxCq+ZxUVqjIdJyluuObWjKRKQYefbT0+RmNcGPnuY8SkfVjNsyQ9WM0ktX/8MNp4DHW/A0SxYw779S2SHRXQ+fP13bf20W2kuoukVVWph2TYgSfD0fWlxbs5wiiwrHt6wLd/3v4KcVGtqZEmzaTGm4QmZwrbzg5XFkiSw2lJbl5N7oiW+BmoqcLVcrnA+Gvr46zVMuWj5nIJEUTxkufo9EImzxWQNaXmejOZtx+O3u92Ts1x6Cjj6IBBibc7ApfhUlXbAaCfRG96cfH5BjIfg9Zf5YEe4zuGiPOOlPbMmcEXwHL+kK0Bh80tLTDCQ66ixSHp4Cyh+ufJEpVlbjHHbRxkqdgvGinRtS/U7SsJVvgZqI3CO5dIlrt8VPeZWTLyWhkkpyB7bcWmRXtMDJjpuOrpE4rKaNh0V+zYMxoGv2978ofw4LgU0XMsPCU446vZ7NhxqSrfyrtqzeH0+ej8ZdewlrG9Jk5g905M0Y/zsQo44OG5uSwVhtD2yFzhn/X0FD54erPRCs+T/FU0UqNSPMO9tX68/RlC9xs9GT8WKVoQD7zqDt/jGj1bN6iIumKzWgoYXNFiqwvo2H2lRr7OjcbVpnysxu1A1plj5FsjPnhD6hgtHWDRsoew2iY1WfWLBp51pnSPntrTGaFW86AAaxlDP+/XzZzprRPIBp55pmi1cZQkeJw5VDuyAtFlli45nP2teuCwFPCKssUUqMBimqFCqRDoPxt0erMU9T5SHnZCtJMZNLbAB+lks8oGvsGZSaUqLliW9aXmTBK1oeZsAo/NZivbGSPkUzwFdHUG60/zVn2WEbDrFm/vKv1eArWtjK6o/6HHkJTr7tWZMaNvUA+d5Ns+fSmyO7bl0adeQZrtWf4iK7soWeTO85m+Y6UcCNF6r4WmZy3eFrKj0uJ2DGAnGTFaCbYF9FhD6QEKVj+rkg68xTKT+eLfSEnE5nEYUWRYnLkTllfZsIMWT9GwmoTLr2EcocOkT6W2Zhyw3VaodKT+IqL6agn/kVeC06ljiVbfpkchWPH0NxHHzV8LEqskWxFzAex69x/777M+sUd0jmQDBcpfNyU/PH6q8h4B0nu5/SSN8VbU8IJCiczOr/gzEVPFihfQEqkWWTtOX0l5ModLrI2smVkJjKOi4+VIn+uRsIoWR9moyfgW7Rm3nKLyJJXOHo0jb/oIpFZR7b8jUayiidMoONeeYmy+pRJ+zcX3edSPJH9/i+9SL7SEvbMzePHKx350IPkzs2J6Z1fZMund8SEiy+ikafLzyA2XqQwntKDtNlq9QjzIkWNiEzO1/cI0UqNUK11A8/Eki18M9FTtWxrmzSqI2/JLNFqT7Z8zESmsfO0zkwm+9sYDasNP/UUKps5Q/pYRmPWnXdoKyGrxa7KzF+SVzJpEs1f8A71O+TgmH6TuXRehpkYY847l05+/X+U3Sf+OCdGFE+cSMc8+SR58vKkj9eb4oArrqCDf/Mb1pIzVaRweRNuIGeCYe85vssnXCOfq2AfHyt4HE57TweMxU+PVkLmBsKKR7bwzURPFar6hCKN8WcL9ZYdJFq9QzQSkf79jYYZsn6Mhhmt903+YoeD7voFqxyTe34DjzyCBh9ztOjRWrHL3mxYJad/fzrh5Zdozr33UBZbacseq6dEEZ91+7ln6bD775fuikgGP7blpP/9T3sM/li9Tf6woXTc0/+mA2+/TVwjZ7pIcfrKKE/nbp/QnvjHIXAOTyH7JD1TZPbjx36EqpaJDFKhedM/Raszh8NFvj6Hiayzjm8cZiOTRAJ+9pySu5j7rWJ7SO5ixr5nnUzYoc/MmTRs/snSx9MTfOvJQXfdxVr2kT2ukbCUw0Fjv/c9OnvZMjr417+m/OHDpY+ZKDJV2QEH0JF/+TOd/v57NOjII8W11iseP45OW/AOTbvmavah36sdktjTo3j8eJpz99101pIlNPioo8SSiM90kcJlDTyRrVwOFVl8kdpVpMQ57XSfrEEni1ZqBCsWi5Y12LK3LHoavhUlXLdaZJ15+MHTrFCVaV0myV8yiRIKdfstKTzMkPVjNOxy4K23aeNfyB4zUYy94AL2iTj1I2inmzsnmyb+6GI6+5OP6aRXXqaJF11IRQZOvZatxNIRDqeLSg+YQlOuvJJOfedtOpUVDqPPPjslowVrx0X9/Od0zicf0eQfX6ad5cKeUo8JXtDyYmzKFVfQKW+8Tmcsep/Gf/8C7ffWI/EsyAkowSqq+fgH7I23VlzTyuXOY58ufOz5udkf2sOKkJMoq6vTl5UQVX0wn5QEo9RahZ9RVDbvTfbdmk14e1esoKbt20VmHv9Elz8s9XMa2UfRXh+RxvhTpOdPvJGyh3Q+P57bseBdqlmbeLLKREbMn08FI0eKLL347KyrH3lEZOb5iopo/A9/KDJ9/JWVtOGZZ0RmXt6QITTqjM6nC3alZs0a2rFwocjMySotpXGsILDL1tdfp3oT0/mP//73tVOa7bLx+ReoubxcZOYMnjuXyqalZlyqYG0t1a5bx5blZmrcsYOad5ez195eCtbVU6i+noINDRRpbqZIMMiKhKRWQe3wosLFVn7u7GxtdmU3D1ZIeXLztDOTPHm57P9NMWWVFGvHl2T37UP57LXMC6uOg4ilU8OWLVS1ejXVbfyWmveUU0vFXgrV1WnLjU/0xydl1GZ5Zh92ohYvQyP48ubL2pObQ77iErZcSyiHLdfcQQOpcMRIKmaFe8nEieTNT3xoSDxJFylcqHo51X9+HVtQbadEdixS+PEr+bP+Qg52fTzNG/5KzVueFpn9Cg+4nXwDk5+2HuLz73iFGr+5R2Sd8ddG2dzXtRGNAaD30bYs8hmL2QqXr3SVaFRrq5JT7PlKUdu6wYJPa+B0ubRdbVqbFSep2PKRifhyU9ly077z5caCf2+N1lW8tn6Oud4obdmLZc6Xtdvn0701JBmWFClc87ePUPOmf4msc5HicHopa9jZ5Bt8mrhFZ0pgD1UvOYstzKi4xl6+0llUOOsBkYHV1FANVX94fpdbx7L6zaOCab8VGQAAQBvLys7c0ZeRl630uxIqf4dVyPFnbnVm9Sdf/8QH0liFj5cSbdoiMrBa47r7E+6+yxpyqmgBAAC0Z+G2MQcVTv0NuXOHiLwzNeKn0O43RSaXO/KHlMoxJAI7XhUtsFJwz3sUKO/6+AN37jBW2M4WGQAAQHuW7sDjxxUUzriPnN74Q0KHK5aQGqoWWWeuvFHk62vfKV8dBfcs1HZLgHWUYCU1fnO3yOLLHna2aAEAAHRm+VFGrpzBVDTjXnK45WfNqEqYgttfEplc7pifEB87IxX48/F3MRIqGKRGqf6rWxPu5nH6Sik7xaedAwBA92LLodDuwkmUP+UucrjkR/7ycVOiDWtF1pkrdxhlDZ4vMvsFdr2pffqH5DWtu0/X3Eg5w8/nlYrIAAAAOrOlSOE8xdMpb/Jt2lk9MqEdr/CDVETWWd6YH+sadt8K2taULkZEBX38256nlu3s75qA01tM2UOMjbEBAAC9j21FCucpnkF5B9xODnfnQXKUQCWF98Q/sNLhKdLOGEqV4N6lFKlbJTIwKlixiJrW/0VkXcsddbFlg+gBAEDPZWuRwrmLDqC8KXdpU/F3FOEH0Qb2iKyz7KFnkqdossjs17zhQVY9hUQGevFh7xtW3dluML94+Nlf2UPkU3IDAADEsr1I4Vy5w1mh8ity5Y8S17Tig7aFtFOA440n56CCybfG3WVktai/nPxbnhQZ6KGNNvzVLdouMz3yxl3D/qypOSgaAAC6t5QUKZzDW0S5k24hb7+54ppWSstOilYtF1lnWoEz5scis19w1xsUqf1SZNAVvoun/osbSY0GxDVd8/U9nLx95ogMAACgaykrUjR8Sv7h51M2P8U4Zq6WSMX7RF2cspo9/LvkLT1QZPbiEzW1rH+A1GCVuAZk/NteoIaVt+veguJ051D+hOtFBgAAkFhqixTBVXQA5Uy6mdxlB5HD4WSfxIMU2bNA/FSucMovyJXVV2T2UsKN1Lz2Xj4qmbgG9lOj1MSWDR/y3sgcS7ljr9SmPQAAANArLUWKxpVN3iFnko+tvFwFYyjasIHUps3ih505vCVUOP0P2qSFqRBp2kIt6//KWumZAjsTKcEqqvvsCmrZ/rK4Rh8+pxNOOQYAAKMsmwU5WWqgnJTGTeTSjlmIP3dPsPxtql91l8iS49Rmafawh+PTf4vvrG7b33a4yddvHmWNvkTco/cKVX5EDWt+ywoVY1MIOL2FVHLoU+T09RHXAAAA6JMxRYoRzRv/Rs2bkz8LR0+Rwofn9/Y/irJGXiju1buo0RZqWvdn8u98TVyjH58osnD6PThYFgAATEnf7p4k5I65nLIGHicy+4UqPqDApr+zVuJxQHoSPvlizdJzTRUoXM7wC1CgAACAad1yS4pGjVLd59dSqHqFuMI4vVtSWn/u1uYkymYFErmyRA89U7R5m3ZgbKjqU3GNcb6yg6lw5n2sFX/XHQAAQFe6b5HC8F0RdcuvpHDDOnGNMUaLFFadkCtnIGWPvpQc2QNbO+lB1EgzNW9+XJuDR1Xiz6uUiDt3GBUf/HdyuPPENQAAAMZ16yKFU8MNVPvZFRRp3CSu0c9MkcK/O91Z5B18Brl7yq4MNUL+7a+wAuVfpIRqxZXmOH2lVHLwY+TMGiCuAQAAMKfbFymcylastcsvp0jzNnGNPmaLFD62Cx+Yjs9L5B16pjYZYrekRimw+y1q2fo0W3Y7Wc6PuTF/3I3TnUtFBz1I7vxx4hoAAADzekSRwmljeKz4KUWatoprEku2SNF+7s4hT/9jWreq8Nt2A2rUT8Hdb1Jgx38o4i/XJgbURo5NokhxuLOpaOb95CmaKq4BAABITo8pUjg1XMcKlWso3LBBXNM1K4oU7Tu7zuktIXf/o8lVzFfSmXmwqOLfRYHdb1OwfAEp4SZtS4qqRpIuUvgAe0XT7yFPiqYuAACA3qFHFSmcGmmius+vo3DdanFNfFYWKfx+vO3M6kOusoNYsTKN5ayfdIsGKFS9jEIViynClomi8KIk0lqQWFCk8Dl5+FgonpIZ4hoAAABr9LgiRaMEqX7VHRSsWCKukLOjSNFux37udOWSs3ACuYomE6X4TCB+lk6kbiWFq7/QZnRWon6tAOFn7PD5dqwqUpyeAiqa+UdyF7LfEQAAwGI9s0jRqNpIqS3bnhd5Z3YWKbxffjvel8OdT868EeTIG9ZasDgtnn8oGqBo8xaKNm6kSP1aUpq2kcIKNV58EC9MKGp5keJiv0fRzPvIlct+JwAAABv04CKllX/Hy6xY+ZO2gu4oVUUKe6TW+7C208lu4y0h4nPZeIuJPAV8YBG+1mfBi5c4x7OwgoIizdop1/xsJiW4lxQ/i5ZdpAQqWosNVmhohQkvOlTRtqFI8RROpKIZ97T+HgAAADbp8UUKF65dSfUrb2Ur9mpxTat0FCnadfvup/Xjbi0cWAHhYAWCyq7b9wfRCitebET8pESD7Jq2YmJ/EbKvwBA/s7tIyR54AuVP+jn7XbziGgAAAHuwtWTP5ymeSiWHPE4efnxIBlNVVSsWeFGihpu0g4C1Nism0o0XW/kTrqP8A+5AgQIAACnRK4oUzunrQ8WzH6HcUReTtnUEdHPnDGbL7jHKHnqOuAYAAMB+vaZIaeWk3NGXUtGBD5IrG8O265E9eD4VH/oEuQswiiwAAKRWLytSWmm7f+Y8TdlDzmg9LgQ6cWX11c7eyZ90CzlcOeJaAACA1Om1a2iHK5tyx11NBTPvJ3fecHEt8AN/c4Z/l0oOe468ZYeIawEAAFKv129GcBdOpMKD/ka5Y35MTk++uLZ38pYdSCWH/Ivyxv1UK+IAAADSqVecgqwXH6k1sO15Cu15Tzs1N9WnIGunBGunEou2OFV4/89tOgWZD8iWO/oSbDkBAICMgiJFQg3VUGDHyxTe+yFL2OLRio2eV6Tws3ayR5xP3r5z2f0BAAAyC4qULvBiJVT+DoX4HEBspd9TihR34TjKGnwqtpwAAEBGQ5GiR9RP4cqlFNr7EanBKlFcdK8ihT8PT+ls8g34DrnyR/PfCgAAIKOhSDFIadpEkaplFKlfw4qX0P7CJBOLFNYgV94o8vQ5pHWrCQ6GBQCAbgRFilmscIg2rKdo/WqtcKFwS0YUKaxTVpiMJlfRZPKUTMckgAAA0G2hSLGI6t/NipXNpPJZif27WM0QbS1IbC5SHPyS1Ydc+aPImTeydVeOk8+mDAAA0L2hSLFLqJrUwF5SgzWszSLcSBQNsB+opooU/p3cOeTwFmpbRxw+FtkDyJk9UOsDAACgp0GRkmrRltZiRQmx78HW4oMXI9qWEpVdGK148RC5WDh9rAbJYQVKHv8B/ykAAECvgCIFAAAAMhDR/wMvqNgFGCzfHQAAAABJRU5ErkJggg==mCC\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"PRIMUS\", 280, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Quote Created'\n    msg.topic = \"TEST - NEW WAREHOUSE QUOTE CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 460,
        "y": 1500,
        "wires": [
            [
                "7258f1ec.faa66"
            ]
        ]
    },
    {
        "id": "93c32e6.898dad",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Format Warehouse Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1460,
        "wires": [
            [
                "7adc4cf5.20ec64",
                "e58cb12c.f460f"
            ]
        ]
    },
    {
        "id": "7adc4cf5.20ec64",
        "type": "mongodb out",
        "z": "20a6f2ef.da319e",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Warehouse Order Into MongoDB",
        "collection": "quotes",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 790,
        "y": 1440,
        "wires": []
    },
    {
        "id": "e58cb12c.f460f",
        "type": "delay",
        "z": "20a6f2ef.da319e",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1080,
        "y": 1380,
        "wires": [
            [
                "615fec9d.a02ed4"
            ]
        ]
    },
    {
        "id": "c084a4bf.e7a938",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Format Counter Update",
        "func": "let count = msg.payload[0].sequence_value\nmsg.query = {_id: 'orderid'}\nmsg.payload = { $set: {sequence_value: Number(count) + 1}};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 1040,
        "wires": [
            [
                "5fe7a42.e6fc45c"
            ]
        ]
    },
    {
        "id": "5fe7a42.e6fc45c",
        "type": "mongodb out",
        "z": "20a6f2ef.da319e",
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Quote Counter",
        "collection": "quoteCounter",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 1000,
        "y": 1140,
        "wires": []
    },
    {
        "id": "c4cc0803.a89c78",
        "type": "debug",
        "z": "20a6f2ef.da319e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 1020,
        "wires": []
    },
    {
        "id": "f0fe6063.a7e6b",
        "type": "switch",
        "z": "20a6f2ef.da319e",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 250,
        "y": 1080,
        "wires": [
            [
                "b4cb2b30.bf2d08"
            ],
            [
                "ca8129fd.9c3648"
            ]
        ]
    },
    {
        "id": "ca8129fd.9c3648",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 1220,
        "wires": [
            [
                "615fec9d.a02ed4"
            ]
        ]
    },
    {
        "id": "a027c61.f04f638",
        "type": "switch",
        "z": "20a6f2ef.da319e",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 210,
        "y": 1280,
        "wires": [
            [
                "9cd0feb9.0ac5c",
                "9bc4d175.5c1a"
            ],
            [
                "93c32e6.898dad",
                "9ad9a06.8cab06"
            ],
            [
                "ca8129fd.9c3648"
            ]
        ]
    },
    {
        "id": "9cd0feb9.0ac5c",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAikAAAD9CAYAAAB5o+cOAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAXxaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDgtMTdUMTM6MTA6MzgtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmVjYzg4MWNjLTMzOGEtMTc0MS05MTE2LWUyOTAxYzNlMjhkOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjg0NWU2OGVkLTNjYTEtODc0Ni1iNWJlLTIyNTMzOTIwMjkyMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODQ1ZTY4ZWQtM2NhMS04NzQ2LWI1YmUtMjI1MzM5MjAyOTIxIiBzdEV2dDp3aGVuPSIyMDIxLTA4LTE3VDEzOjEwOjM4LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgc3RFdnQ6d2hlbj0iMjAyMS0wOC0xN1QxMzoyMDo0OS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgNIh6UAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyMTowODoxNyAxMzoyMDo1MEjTEeYAAEvRSURBVHhe7d0HYBvV/Qfwn7b3zt57kg0BwkgYZYY9W9oCBVpG2f1TdukuUGhLoYy2FCh7tZQZAiEJI4QwEhKyyB6O4z217/7vnV9i2X6y7k53kmx/P8rPfj9ZepLPiu6nG+85FEVRCQAAACDDOMV3AAAAgIyCIgUAAAAyEooUHaItO0QLAAAA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mCC\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"PRIMUS\", 280, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Fuel Quote Created'\n    msg.topic = \"TEST - NEW FUEL QUOTE CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 470,
        "y": 1320,
        "wires": [
            [
                "bd6fd057.bcc3b"
            ]
        ]
    },
    {
        "id": "bd6fd057.bcc3b",
        "type": "e-mail",
        "z": "20a6f2ef.da319e",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com, d.lee@kppetro.com",
        "dname": "Send Fuel Confirmation Email",
        "x": 730,
        "y": 1320,
        "wires": []
    },
    {
        "id": "9bc4d175.5c1a",
        "type": "function",
        "z": "20a6f2ef.da319e",
        "name": "Format Fuel Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1360,
        "wires": [
            [
                "526c6aea.3c8504",
                "e58cb12c.f460f"
            ]
        ]
    },
    {
        "id": "526c6aea.3c8504",
        "type": "mongodb out",
        "z": "20a6f2ef.da319e",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Fuel Order Into MongoDB",
        "collection": "quotes",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 730,
        "y": 1360,
        "wires": []
    },
    {
        "id": "910f52b1.be0c8",
        "type": "catch",
        "z": "20a6f2ef.da319e",
        "name": "Error - FuelOrder",
        "scope": [
            "9cd0feb9.0ac5c",
            "bd6fd057.bcc3b",
            "9bc4d175.5c1a",
            "526c6aea.3c8504"
        ],
        "uncaught": false,
        "x": 1260,
        "y": 1140,
        "wires": [
            [
                "1e73586.06f15a8",
                "615fec9d.a02ed4"
            ]
        ]
    },
    {
        "id": "1e73586.06f15a8",
        "type": "debug",
        "z": "20a6f2ef.da319e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 1140,
        "wires": []
    },
    {
        "id": "bfebf85e.47c238",
        "type": "comment",
        "z": "20a6f2ef.da319e",
        "name": "Give time for mongodb to throw error if failed",
        "info": "",
        "x": 1190,
        "y": 1420,
        "wires": []
    },
    {
        "id": "be28aa00.8a4938",
        "type": "comment",
        "z": "20a6f2ef.da319e",
        "name": "PRIMUS",
        "info": "",
        "x": 370,
        "y": 960,
        "wires": []
    },
    {
        "id": "34f77e37.25fa32",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "formattQuery",
        "func": "return msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 2380,
        "wires": [
            [
                "c72f0d5c.cc6cc"
            ]
        ]
    },
    {
        "id": "71e25ebb.b2d83",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 2440,
        "wires": []
    },
    {
        "id": "1884aabc.0acc95",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "Get All Customers Users",
        "info": "",
        "x": 510,
        "y": 2320,
        "wires": []
    },
    {
        "id": "c72f0d5c.cc6cc",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "f76d58a.2802ea8",
        "name": "Pull Users",
        "collection": "users",
        "operation": "find",
        "x": 630,
        "y": 2440,
        "wires": [
            [
                "14e0a53d.6d03ab"
            ]
        ]
    },
    {
        "id": "dcf48c06.e1937",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "get all customers",
        "url": "/api/getCustomers",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 2340,
        "wires": [
            [
                "34f77e37.25fa32"
            ]
        ]
    },
    {
        "id": "776f34d9.f2017c",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1080,
        "y": 2320,
        "wires": []
    },
    {
        "id": "b0e93437.34c938",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 2420,
        "wires": [
            [
                "34f77e37.25fa32"
            ]
        ]
    },
    {
        "id": "14e0a53d.6d03ab",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "Format Duplicate Entries",
        "func": "let mainStager = [];\nlet emailList = [];\n\nfor(let each in msg.payload){\n    let emailEntry = msg.payload[each]['email'].toLowerCase();\n    if(emailList.includes(emailEntry) == false){\n        mainStager.push(msg.payload[each])\n        emailList.push(emailEntry)\n    }\n}\nmsg.payload = mainStager;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 2380,
        "wires": [
            [
                "776f34d9.f2017c",
                "71e25ebb.b2d83"
            ]
        ]
    },
    {
        "id": "623aa6ea.0c1be8",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "formattQuery",
        "func": "return msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1650,
        "y": 2040,
        "wires": [
            [
                "b8edaa50.4e0518"
            ]
        ]
    },
    {
        "id": "f08ff6ba.4f4868",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2070,
        "y": 2120,
        "wires": []
    },
    {
        "id": "60616de6.488834",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "Salesman Filters",
        "info": "",
        "x": 1680,
        "y": 1980,
        "wires": []
    },
    {
        "id": "b8edaa50.4e0518",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "6733cef8.a8ac2",
        "name": "Pull Filters Saleman",
        "collection": "filters_salesman",
        "operation": "find",
        "x": 1860,
        "y": 2100,
        "wires": [
            [
                "f08ff6ba.4f4868",
                "7942e665.9cd888"
            ]
        ]
    },
    {
        "id": "f3246457.5e7aa8",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "Get all salesmen filters",
        "url": "/api/getSalesmanFilters",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 1400,
        "y": 2000,
        "wires": [
            [
                "623aa6ea.0c1be8"
            ]
        ]
    },
    {
        "id": "7942e665.9cd888",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 2100,
        "y": 2020,
        "wires": []
    },
    {
        "id": "956dde3e.80c46",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1450,
        "y": 2080,
        "wires": [
            [
                "623aa6ea.0c1be8"
            ]
        ]
    },
    {
        "id": "6622b42d.8c58ec",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "formattQuery",
        "func": "return msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2630,
        "y": 2020,
        "wires": [
            [
                "fa364095.7d11e",
                "314f1861.9d0548",
                "30787c3b.de3af4"
            ]
        ]
    },
    {
        "id": "fa364095.7d11e",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2850,
        "y": 2080,
        "wires": []
    },
    {
        "id": "988f8809.9dd578",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "Add New Salesman Filter",
        "info": "",
        "x": 2690,
        "y": 1960,
        "wires": []
    },
    {
        "id": "8a0c9533.c55998",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "new Salesmen Filter",
        "url": "/api/newSalesmenFilter",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 2410,
        "y": 2020,
        "wires": [
            [
                "6622b42d.8c58ec"
            ]
        ]
    },
    {
        "id": "314f1861.9d0548",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 2860,
        "y": 2020,
        "wires": []
    },
    {
        "id": "30787c3b.de3af4",
        "type": "mongodb out",
        "z": "4d643218.bdf09c",
        "mongodb": "6733cef8.a8ac2",
        "name": "newFilterEntry",
        "collection": "filters_salesman",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 2900,
        "y": 2200,
        "wires": []
    },
    {
        "id": "d7c80cc4.73657",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 240,
        "wires": []
    },
    {
        "id": "6eaae4de.c9ac6c",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "Get All Orders",
        "info": "",
        "x": 690,
        "y": 100,
        "wires": []
    },
    {
        "id": "a89f968.cc11a68",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders",
        "collection": "orders",
        "operation": "find",
        "x": 570,
        "y": 160,
        "wires": [
            [
                "9a9f7de6.ebc5d"
            ]
        ]
    },
    {
        "id": "42bb9c4d.eeac24",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "Get all previous orders",
        "url": "/api/getAllOrders",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 100,
        "wires": [
            [
                "27aec95a.5bbf66"
            ]
        ]
    },
    {
        "id": "683b4440.a9cf7c",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 920,
        "y": 120,
        "wires": []
    },
    {
        "id": "47f4366f.ed7648",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{}",
        "payloadType": "json",
        "x": 210,
        "y": 180,
        "wires": [
            [
                "27aec95a.5bbf66"
            ]
        ]
    },
    {
        "id": "9a9f7de6.ebc5d",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "",
        "func": "return msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 200,
        "wires": [
            [
                "683b4440.a9cf7c",
                "d7c80cc4.73657"
            ]
        ]
    },
    {
        "id": "27aec95a.5bbf66",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "",
        "func": "msg.sort = {'createdDate': -1}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 180,
        "wires": [
            [
                "a89f968.cc11a68"
            ]
        ]
    },
    {
        "id": "382e4c09.b5ff54",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 2120,
        "wires": []
    },
    {
        "id": "4ae761a5.77828",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "Get All Salesman",
        "info": "",
        "x": 600,
        "y": 2000,
        "wires": []
    },
    {
        "id": "56a2ec49.814e34",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders",
        "collection": "orders",
        "operation": "find",
        "x": 530,
        "y": 2060,
        "wires": [
            [
                "d1622851.49bb18"
            ]
        ]
    },
    {
        "id": "6aa824ee.70a63c",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "Get all previous salesman",
        "url": "/api/getSalesman",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 230,
        "y": 2000,
        "wires": [
            [
                "b6dc310.ab3a5d"
            ]
        ]
    },
    {
        "id": "a43b2330.bfaff",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 880,
        "y": 2020,
        "wires": []
    },
    {
        "id": "5dd4f927.315e38",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{}",
        "payloadType": "json",
        "x": 170,
        "y": 2080,
        "wires": [
            [
                "b6dc310.ab3a5d"
            ]
        ]
    },
    {
        "id": "d1622851.49bb18",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "",
        "func": "let stager = [];\nconst allOrders = msg.payload\n\nfor(let each in allOrders){\n    let orderSalesman = allOrders[each]['requestPayload']['sales']['firstname'] + \" \" + allOrders[each]['requestPayload']['sales']['lastname']\n    if(stager.includes(orderSalesman) == false){\n        stager.push(orderSalesman)\n    }\n}\n\nmsg.payload = {\n  salesmanNames : stager,\n  allOrderData : allOrders\n};\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 2100,
        "wires": [
            [
                "a43b2330.bfaff",
                "382e4c09.b5ff54"
            ]
        ]
    },
    {
        "id": "b6dc310.ab3a5d",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "",
        "func": "msg.sort = {'createdDate': -1}\nmsg.payload = { \"requestPayload.sales.lastname\" : { $not : /.*TEST.*/i }, $and : [ { \"requestPayload.sales.lastname\" : { $not : /.*Test.*/i } }, { \"requestPayload.sales.lastname\" : { $not : /.*Chilton.*/i } }, { \"requestPayload.sales.lastname\" : { $not : /.*Dylan.*/i } }, { \"requestPayload.sales.lastname\" : { $not : /.*Jackson.*/i } }, { \"requestPayload.sales.lastname\" : { $not : /.*Lee.*/i } } ] }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 2080,
        "wires": [
            [
                "56a2ec49.814e34"
            ]
        ]
    },
    {
        "id": "6dbdcbca.d4d124",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2010,
        "y": 1500,
        "wires": []
    },
    {
        "id": "8ba21b5d.deb598",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "Get Product List",
        "info": "",
        "x": 1860,
        "y": 1380,
        "wires": []
    },
    {
        "id": "9fe322f4.591f7",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "3846e700.384eea",
        "name": "Pull Products",
        "collection": "products",
        "operation": "find",
        "x": 1730,
        "y": 1520,
        "wires": [
            [
                "a59df547.2369e8",
                "6dbdcbca.d4d124"
            ]
        ]
    },
    {
        "id": "991a571b.1daf08",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "Get all products",
        "url": "/api/getProducts",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 1460,
        "y": 1380,
        "wires": [
            [
                "cc863302.b202b"
            ]
        ]
    },
    {
        "id": "a59df547.2369e8",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 2040,
        "y": 1420,
        "wires": []
    },
    {
        "id": "842a86a.81e6078",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{}",
        "payloadType": "json",
        "x": 1430,
        "y": 1460,
        "wires": [
            [
                "cc863302.b202b"
            ]
        ]
    },
    {
        "id": "cc863302.b202b",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "",
        "func": "msg.sort = {\"ID\" : 1}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 1460,
        "wires": [
            [
                "9fe322f4.591f7"
            ]
        ]
    },
    {
        "id": "5cfa78da.bb04e8",
        "type": "debug",
        "z": "4d643218.bdf09c",
        "name": "output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1890,
        "y": 260,
        "wires": []
    },
    {
        "id": "32a2f1a3.beb91e",
        "type": "comment",
        "z": "4d643218.bdf09c",
        "name": "Get All Timely Totals",
        "info": "",
        "x": 1690,
        "y": 120,
        "wires": []
    },
    {
        "id": "8777e7d2.d73b28",
        "type": "mongodb in",
        "z": "4d643218.bdf09c",
        "mongodb": "c5ee0161.50223",
        "name": "Pull Orders",
        "collection": "orders",
        "operation": "find",
        "x": 1550,
        "y": 180,
        "wires": [
            [
                "aa690d5c.6f599"
            ]
        ]
    },
    {
        "id": "2cb3e933.a09726",
        "type": "http in",
        "z": "4d643218.bdf09c",
        "name": "Get all order totals by this day, month and year",
        "url": "/api/getOrderTotals",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 1310,
        "y": 120,
        "wires": [
            [
                "6996ce91.1733e"
            ]
        ]
    },
    {
        "id": "8fda5848.ac2c28",
        "type": "http response",
        "z": "4d643218.bdf09c",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1900,
        "y": 140,
        "wires": []
    },
    {
        "id": "8bbfb652.20edb8",
        "type": "inject",
        "z": "4d643218.bdf09c",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{}",
        "payloadType": "json",
        "x": 1190,
        "y": 200,
        "wires": [
            [
                "6996ce91.1733e"
            ]
        ]
    },
    {
        "id": "aa690d5c.6f599",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "",
        "func": "const allOrders = msg.payload;\nconst today = new Date();\nlet todayOrderCount = 0;\nlet monthlyOrderCount = 0;\nlet yearlyOrderCount = 0;\nlet lastYearOrderCount = 0;\nlet previousMonthOrderCount = 0;\n\nconst todaysDate = new Date();\n\nfor(let each in allOrders){\n    let orderDate = (allOrders[each]['createdDate'])\n    let orderDateString = orderDate.toLocaleString(\"en-US\", {timeZone: \"America/New_York\"});\n    let orderDateInfo = new Date(orderDateString)\n\n    //bellow is to fix time zone difference\n  \n    if(orderDateInfo.getDate() == today.getDate() && orderDateInfo.getMonth() == today.getMonth() && orderDateInfo.getFullYear() == today.getFullYear()){\n        todayOrderCount = todayOrderCount + 1\n        monthlyOrderCount = monthlyOrderCount + 1\n        yearlyOrderCount = yearlyOrderCount + 1\n    }\n    else if(orderDateInfo.getMonth() == today.getMonth() && orderDateInfo.getFullYear() == today.getFullYear()){\n        monthlyOrderCount = monthlyOrderCount + 1\n        yearlyOrderCount = yearlyOrderCount + 1\n    }\n    else if(orderDateInfo.getFullYear() == today.getFullYear()){\n        yearlyOrderCount = yearlyOrderCount + 1\n        if(orderDateInfo.getMonth() < today.getMonth() && orderDateInfo.getDate() <= today.getDate()){\n            previousMonthOrderCount = previousMonthOrderCount + 1\n        }\n    }\n    else if(orderDateInfo.getFullYear() == today.getFullYear()-1 && orderDateInfo.getMonth() <= today.getMonth()){\n        lastYearOrderCount = lastYearOrderCount + 1\n    }\n}\n\nmsg.payload = {\n    dailyOrderTotal : todayOrderCount,\n    monthlyOrderTotal : monthlyOrderCount,\n    yearlyOrderTotal : yearlyOrderCount,\n    lastYearOrderTotal : lastYearOrderCount,\n    previousMonthAverage : previousMonthOrderCount/(todaysDate.getMonth()-1)\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1720,
        "y": 220,
        "wires": [
            [
                "8fda5848.ac2c28",
                "5cfa78da.bb04e8"
            ]
        ]
    },
    {
        "id": "6996ce91.1733e",
        "type": "function",
        "z": "4d643218.bdf09c",
        "name": "",
        "func": "msg.sort = {'createdDate': -1}\nmsg.payload = msg.payload = { \"requestPayload.sales.lastname\" : { $not : /.*TEST.*/i }, $and : [ { \"requestPayload.sales.lastname\" : { $not : /.*Test.*/i } }, { \"requestPayload.sales.lastname\" : { $not : /.*Chilton.*/i } }, { \"requestPayload.sales.lastname\" : { $not : /.*Dylan.*/i } }, { \"requestPayload.sales.lastname\" : { $not : /.*Jackson.*/i } }, { \"requestPayload.sales.lastname\" : { $not : /.*Lee.*/i } } ] }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1360,
        "y": 200,
        "wires": [
            [
                "8777e7d2.d73b28"
            ]
        ]
    },
    {
        "id": "1f1dbf94.ed9ba",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 330,
        "y": 580,
        "wires": []
    },
    {
        "id": "40596b0f.3212d4",
        "type": "delay",
        "z": "bfa4b585.801268",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 160,
        "y": 720,
        "wires": [
            [
                "d885d961.9711c8"
            ]
        ]
    },
    {
        "id": "d885d961.9711c8",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Warehouse Order Select",
        "func": "let orderNumberQuery =  msg.order.sequenceNumber || msg.orderNumber \nlet searchQuery = {\n\t\t\"PO\": orderNumberQuery,\n\t}\nmsg.payload = searchQuery;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 720,
        "wires": [
            [
                "6c4f4c92.deaff4"
            ]
        ]
    },
    {
        "id": "6c4f4c92.deaff4",
        "type": "mongodb in",
        "z": "bfa4b585.801268",
        "mongodb": "c5ee0161.50223",
        "name": "GetOrderNumber",
        "collection": "orders",
        "operation": "find",
        "x": 670,
        "y": 720,
        "wires": [
            [
                "6b3bb932.e44838",
                "3d4af106.90a3de"
            ]
        ]
    },
    {
        "id": "6b3bb932.e44838",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 760,
        "wires": []
    },
    {
        "id": "3d4af106.90a3de",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Warehouse Order Select",
        "func": "msg.orderMongoID = msg.payload[0]._id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 720,
        "wires": [
            [
                "46e6478d.05e498"
            ]
        ]
    },
    {
        "id": "b2d24643.0ea908",
        "type": "delay",
        "z": "bfa4b585.801268",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1620,
        "y": 320,
        "wires": [
            [
                "b48d8afb.8e4e08"
            ]
        ]
    },
    {
        "id": "b48d8afb.8e4e08",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Fuel Order Select",
        "func": "let orderNumberQuery =  msg.order.sequenceNumber || msg.orderNumber \nlet searchQuery = {\n\t\t\"PO\": orderNumberQuery,\n\t}\nmsg.payload = searchQuery;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 320,
        "wires": [
            [
                "2c53c054.ebcc1"
            ]
        ]
    },
    {
        "id": "2c53c054.ebcc1",
        "type": "mongodb in",
        "z": "bfa4b585.801268",
        "mongodb": "c5ee0161.50223",
        "name": "GetOrderNumber",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 2130,
        "y": 320,
        "wires": [
            [
                "83b4ee37.521d",
                "2ea26f03.5b8af"
            ]
        ]
    },
    {
        "id": "83b4ee37.521d",
        "type": "debug",
        "z": "bfa4b585.801268",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 360,
        "wires": []
    },
    {
        "id": "2ea26f03.5b8af",
        "type": "function",
        "z": "bfa4b585.801268",
        "name": "Format Warehouse Order Select",
        "func": "msg.orderMongoID = msg.payload[0]._id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2450,
        "y": 320,
        "wires": [
            [
                "defe2d5a.6938f"
            ]
        ]
    },
    {
        "id": "bc77d456.fed138",
        "type": "mongodb out",
        "z": "bfa4b585.801268",
        "mongodb": "50415189.3a11b",
        "name": "Insert Warehouse Order Into MongoDB",
        "collection": "orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 930,
        "y": 480,
        "wires": []
    },
    {
        "id": "ddb15988.a018b8",
        "type": "mongodb out",
        "z": "bfa4b585.801268",
        "mongodb": "50415189.3a11b",
        "name": "Insert Fuel Order Into MongoDB",
        "collection": "Fuel_Orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 890,
        "y": 380,
        "wires": []
    },
    {
        "id": "c12c6969.76cc28",
        "type": "comment",
        "z": "facee7fa.33b2e8",
        "name": "Gets Truck From Driver ID",
        "info": "",
        "x": 430,
        "y": 640,
        "wires": []
    },
    {
        "id": "868e15b2.3ea618",
        "type": "http in",
        "z": "facee7fa.33b2e8",
        "name": "/api/dipatch/findTruck",
        "url": "/api/dipatch/findTruck",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 720,
        "wires": [
            [
                "2ee930d2.65c5b"
            ]
        ]
    },
    {
        "id": "2ee930d2.65c5b",
        "type": "function",
        "z": "facee7fa.33b2e8",
        "name": "",
        "func": "//let email = msg.req.headers.email\nlet driverNumber = msg.req.headers.driver\nmsg.payload = { \n        \"driverID\" : parseInt(driverNumber)\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 780,
        "wires": [
            [
                "97380111.f1629"
            ]
        ]
    },
    {
        "id": "97380111.f1629",
        "type": "mongodb in",
        "z": "facee7fa.33b2e8",
        "mongodb": "f76d58a.2802ea8",
        "name": "Find Truck by Driver ID",
        "collection": "DispatchUsers",
        "operation": "find",
        "x": 540,
        "y": 720,
        "wires": [
            [
                "7d308aa1.315534",
                "de83b538.86e2a8"
            ]
        ]
    },
    {
        "id": "7d308aa1.315534",
        "type": "debug",
        "z": "facee7fa.33b2e8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 800,
        "wires": []
    },
    {
        "id": "de83b538.86e2a8",
        "type": "http response",
        "z": "facee7fa.33b2e8",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 780,
        "y": 720,
        "wires": []
    },
    {
        "id": "9bebb3de.02d37",
        "type": "http in",
        "z": "f2cbf0d9.c520a",
        "name": "/api/dispatch/finishedDispatch",
        "url": "/api/dispatch/finishedDispatch",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 660,
        "wires": [
            [
                "12fe8a51.5820f6"
            ]
        ]
    },
    {
        "id": "12fe8a51.5820f6",
        "type": "function",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "func": "msg.payloadData = msg.payload;\n\nmsg.payload = {\n    \"PO\" : msg.payloadData.order\n};\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 740,
        "wires": [
            [
                "421fafc0.02b73"
            ]
        ]
    },
    {
        "id": "56896952.9b7938",
        "type": "comment",
        "z": "f2cbf0d9.c520a",
        "name": "finished a single dispatch order",
        "info": "",
        "x": 450,
        "y": 620,
        "wires": []
    },
    {
        "id": "212ab8c1.91cb28",
        "type": "mongodb out",
        "z": "f2cbf0d9.c520a",
        "mongodb": "f76d58a.2802ea8",
        "name": "",
        "collection": "completedDispatchOrdersWarehouse",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 1160,
        "y": 680,
        "wires": []
    },
    {
        "id": "b7e42f2c.5513e",
        "type": "http response",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 640,
        "wires": []
    },
    {
        "id": "35d5d386.30027c",
        "type": "http in",
        "z": "a1af6fb4.de437",
        "name": "submitOrder",
        "url": "/api/submitOrderTESTING",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 320,
        "wires": [
            [
                "27680921.504766",
                "ef658713.8075d8"
            ]
        ]
    },
    {
        "id": "22d0196e.330eb6",
        "type": "http response",
        "z": "a1af6fb4.de437",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1520,
        "y": 540,
        "wires": []
    },
    {
        "id": "dfb69991.86fb48",
        "type": "catch",
        "z": "a1af6fb4.de437",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 1710,
        "y": 360,
        "wires": [
            [
                "1271a1b1.94663e"
            ]
        ]
    },
    {
        "id": "83bf04fe.3035f8",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Get Order Number ",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 420,
        "wires": [
            [
                "7f216d21.74ae34"
            ]
        ]
    },
    {
        "id": "90cf2399.fc528",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 440,
        "wires": [
            [
                "9768e308.04ec"
            ]
        ]
    },
    {
        "id": "7f97deda.50486",
        "type": "catch",
        "z": "a1af6fb4.de437",
        "name": "Error - WarehouseOrder",
        "scope": [
            "fc5538fa.41ce48",
            "9db98e29.c69e3",
            "df2a4d7d.ae6ca",
            "977781ac.314f8",
            "eebcc74d.d3a258",
            "1ad7a0c7.1ede4f"
        ],
        "uncaught": false,
        "x": 1700,
        "y": 400,
        "wires": [
            [
                "755ed98c.e87d48"
            ]
        ]
    },
    {
        "id": "7f216d21.74ae34",
        "type": "mongodb in",
        "z": "a1af6fb4.de437",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetOrderNumber",
        "collection": "counter",
        "operation": "find",
        "x": 810,
        "y": 380,
        "wires": [
            [
                "6f008bfe.582194",
                "40b82680.dc7248"
            ]
        ]
    },
    {
        "id": "40b82680.dc7248",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.payload[0].sequence_value\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = `DJ0F${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.orderNumber = `DJ0W${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.order;\nmsg.orderToEmail = msg.order.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 380,
        "wires": [
            [
                "90cf2399.fc528"
            ]
        ]
    },
    {
        "id": "755ed98c.e87d48",
        "type": "debug",
        "z": "a1af6fb4.de437",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 400,
        "wires": []
    },
    {
        "id": "fc5538fa.41ce48",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Generate BlendSheet PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\nfunction createBlendSheet(invoice, path) {\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n  generateHeader(doc);\n  generateCustomerInformation(doc, invoice);\n  generateInvoiceTable(doc, invoice);\n  generateFooter(doc,invoice);\n\n  doc.end();\n  doc.pipe(fs.createWriteStream(path));\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Blending\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    // .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 150);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop + 15)\n    .text(formatDate(new Date()), 150, customerInformationTop + 15)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop + 30)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop + 30\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop + 45)\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop + 45)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 60)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 60)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 30)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 30)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -15)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -5\n    )\n    \n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop + 40) \n    .text(invoice.origin.address, 380, customerInformationTop + 40)\n\n    .moveDown();\n\n  generateHr(doc, 290);\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Quantity\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description,\n      item.Package,\n      item.Quantity\n    //   formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n//   generateTableRow(\n//     doc,\n//     subtotalPosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     \"Subtotal\",\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n\n  const paidToDatePosition = subtotalPosition + 20;\n  // generateTableRow(\n  //   doc,\n  //   paidToDatePosition,\n  //   \"\",\n  //   \"\",\n  //   \"\",\n  //   \"Paid To Date\",\n  //   \"\",\n  //   formatCurrency(invoice.paid)\n  // );\n\n  const duePosition = paidToDatePosition + 25;\n//   doc.font(\"Helvetica-Bold\");\n//   generateTableRow(\n//     doc,\n//     duePosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     `${sentenceCase(invoice.sales.quoteType)} Total`,\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n//   doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact help@kppetro.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 120, y)\n    .text(package, 300, y)\n    .text(unitCost, 320, y, { width: 90, align: \"right\" })\n    .text(quantity, 370, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\n\ntry{\n   createBlendSheet(msg.payload, msg.blendfilename )\n    msg.order = msg.payload\n    msg.payload = `New Order Created\n    \n    Notes: ${msg.order.notes}\n    `\n    msg.topic = \"NEW WAREHOUSE ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.blendfilename), path: msg.blendfilename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 620,
        "y": 840,
        "wires": [
            [
                "9db98e29.c69e3"
            ]
        ]
    },
    {
        "id": "9db98e29.c69e3",
        "type": "e-mail",
        "z": "a1af6fb4.de437",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com,d.lee@kppetro.com,s.james@kppetro.com,j.acosta@kppetro.com",
        "dname": "Send Blendsheet Email",
        "x": 1170,
        "y": 840,
        "wires": []
    },
    {
        "id": "df2a4d7d.ae6ca",
        "type": "e-mail",
        "z": "a1af6fb4.de437",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Warehouse Confirmation Email",
        "x": 1630,
        "y": 980,
        "wires": []
    },
    {
        "id": "977781ac.314f8",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact help@kppetro.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 200,
        "y": 860,
        "wires": [
            [
                "16fd1d20.60c393",
                "7c6f9fd.b47776"
            ]
        ]
    },
    {
        "id": "eebcc74d.d3a258",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Format Warehouse Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\ninvoiceData.items.items = invoiceData.items.items.map(item => {\n    if(item.Package.packName){\n        let package = item.Package.packName;\n        item.Package = package\n    }\n    return item;\n    \n})\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 760,
        "wires": [
            [
                "1ad7a0c7.1ede4f",
                "8b34f2ff.34a99",
                "50329dfc.45f9d4"
            ]
        ]
    },
    {
        "id": "1ad7a0c7.1ede4f",
        "type": "mongodb out",
        "z": "a1af6fb4.de437",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Warehouse Order Into MongoDB",
        "collection": "orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 930,
        "y": 780,
        "wires": []
    },
    {
        "id": "8b34f2ff.34a99",
        "type": "delay",
        "z": "a1af6fb4.de437",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1280,
        "y": 660,
        "wires": [
            [
                "22d0196e.330eb6"
            ]
        ]
    },
    {
        "id": "6f008bfe.582194",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Format Counter Update",
        "func": "let count = msg.payload[0].sequence_value\nmsg.query = {_id: 'orderid'}\nmsg.payload = { $set: {sequence_value: Number(count) + 1}};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 320,
        "wires": [
            [
                "a5222482.873cd8"
            ]
        ]
    },
    {
        "id": "a5222482.873cd8",
        "type": "mongodb out",
        "z": "a1af6fb4.de437",
        "mongodb": "50415189.3a11b",
        "name": "Update Order Counter",
        "collection": "counter",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 1320,
        "y": 320,
        "wires": []
    },
    {
        "id": "1271a1b1.94663e",
        "type": "debug",
        "z": "a1af6fb4.de437",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 360,
        "wires": []
    },
    {
        "id": "27680921.504766",
        "type": "switch",
        "z": "a1af6fb4.de437",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 290,
        "y": 460,
        "wires": [
            [
                "83bf04fe.3035f8"
            ],
            [
                "33ceca0e.7b2166"
            ]
        ]
    },
    {
        "id": "33ceca0e.7b2166",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 540,
        "wires": [
            [
                "22d0196e.330eb6"
            ]
        ]
    },
    {
        "id": "9768e308.04ec",
        "type": "switch",
        "z": "a1af6fb4.de437",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 310,
        "y": 560,
        "wires": [
            [
                "86c62a45.39dc48",
                "6df81327.2cb1cc"
            ],
            [
                "fc5538fa.41ce48",
                "eebcc74d.d3a258",
                "977781ac.314f8"
            ],
            [
                "33ceca0e.7b2166"
            ]
        ]
    },
    {
        "id": "86c62a45.39dc48",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"Key Performance Petroleum\", 200, 57)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact help@kppetro.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Fuel Order Created'\n    msg.topic = \"TEST - NEW FUEL ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 590,
        "y": 620,
        "wires": [
            [
                "fdc5e80a.a45c18"
            ]
        ]
    },
    {
        "id": "787312d4.4333ac",
        "type": "e-mail",
        "z": "a1af6fb4.de437",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Fuel Confirmation Email",
        "x": 2470,
        "y": 680,
        "wires": []
    },
    {
        "id": "6df81327.2cb1cc",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Format Fuel Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 660,
        "wires": [
            [
                "e8442b.c5b5bbd8",
                "8b34f2ff.34a99",
                "bbd9cf50.6236a"
            ]
        ]
    },
    {
        "id": "e8442b.c5b5bbd8",
        "type": "mongodb out",
        "z": "a1af6fb4.de437",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Fuel Order Into MongoDB",
        "collection": "Fuel_Orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 890,
        "y": 680,
        "wires": []
    },
    {
        "id": "9d6a93e1.587a3",
        "type": "catch",
        "z": "a1af6fb4.de437",
        "name": "Error - FuelOrder",
        "scope": [
            "86c62a45.39dc48",
            "787312d4.4333ac",
            "6df81327.2cb1cc",
            "e8442b.c5b5bbd8"
        ],
        "uncaught": false,
        "x": 1720,
        "y": 440,
        "wires": [
            [
                "3e9fd3d.d2de22c"
            ]
        ]
    },
    {
        "id": "3e9fd3d.d2de22c",
        "type": "debug",
        "z": "a1af6fb4.de437",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 440,
        "wires": []
    },
    {
        "id": "10f16f1d.d3ab91",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\n//msg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email},${emails}` // emails\n\nmsg.cc = 'dylan.jackson@kppetro.com'\n\nmsg.payload = `Please see your attached Order\n\nYou can view this order at anytime using the following link:\nhttps://kppetro.io/viewpdf/${msg.orderMongoID}/warehouse\n\nThis link will always contain the updated order if future changes are made.\n\n Please reach out if you have any questions!\n \n Notes:\n \n ${msg.order.notes || ''}\n \n `\nmsg.topic = `New Warehouse Order - ${msg.order.sequenceNumber} - ${msg.order.shipping.name}`\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1280,
        "y": 980,
        "wires": [
            [
                "df2a4d7d.ae6ca"
            ]
        ]
    },
    {
        "id": "762336cb.013788",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\") || origin.includes(\"Harlingen\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\n//msg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email},${emails}` // emails\n\nmsg.cc = 'dylan.jackson@kppetro.com'\n\nmsg.payload = `Please see your attached Order\n\nYou can view this order at anytime using the following link:\nhttps://kppetro.io/viewpdf/${msg.orderMongoID}/fuel\n\nThis link will always contain the updated order if future changes are made.\n\n Please reach out if you have any questions!\n \n Notes:\n \n ${msg.order.notes || ''}\n \n `\nmsg.topic = `New Fuel Order - ${msg.order.sequenceNumber} - ${msg.order.shipping.name}`\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1780,
        "y": 680,
        "wires": [
            [
                "787312d4.4333ac"
            ]
        ]
    },
    {
        "id": "ef658713.8075d8",
        "type": "debug",
        "z": "a1af6fb4.de437",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 300,
        "wires": []
    },
    {
        "id": "16fd1d20.60c393",
        "type": "debug",
        "z": "a1af6fb4.de437",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 330,
        "y": 800,
        "wires": []
    },
    {
        "id": "7c6f9fd.b47776",
        "type": "delay",
        "z": "a1af6fb4.de437",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 160,
        "y": 980,
        "wires": [
            [
                "fb4993d4.e9b5c"
            ]
        ]
    },
    {
        "id": "fb4993d4.e9b5c",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Format Warehouse Order Select",
        "func": "let orderNumberQuery =  msg.order.sequenceNumber || msg.orderNumber \nlet searchQuery = {\n\t\t\"PO\": orderNumberQuery,\n\t}\nmsg.payload = searchQuery;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 980,
        "wires": [
            [
                "8070d2fa.7f1c8"
            ]
        ]
    },
    {
        "id": "8070d2fa.7f1c8",
        "type": "mongodb in",
        "z": "a1af6fb4.de437",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetOrderNumber",
        "collection": "orders",
        "operation": "find",
        "x": 670,
        "y": 980,
        "wires": [
            [
                "aab03ba3.67de28",
                "5224bef2.7661"
            ]
        ]
    },
    {
        "id": "aab03ba3.67de28",
        "type": "debug",
        "z": "a1af6fb4.de437",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 1020,
        "wires": []
    },
    {
        "id": "5224bef2.7661",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Format Warehouse Order Select",
        "func": "msg.orderMongoID = msg.payload[0]._id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 980,
        "wires": [
            [
                "10f16f1d.d3ab91"
            ]
        ]
    },
    {
        "id": "fdc5e80a.a45c18",
        "type": "delay",
        "z": "a1af6fb4.de437",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1620,
        "y": 580,
        "wires": [
            [
                "d5d362f4.8ef42"
            ]
        ]
    },
    {
        "id": "d5d362f4.8ef42",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Format Fuel Order Select",
        "func": "let orderNumberQuery =  msg.order.sequenceNumber || msg.orderNumber \nlet searchQuery = {\n\t\t\"PO\": orderNumberQuery,\n\t}\nmsg.payload = searchQuery;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 580,
        "wires": [
            [
                "1bbcf068.39205"
            ]
        ]
    },
    {
        "id": "1bbcf068.39205",
        "type": "mongodb in",
        "z": "a1af6fb4.de437",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetOrderNumber",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 2130,
        "y": 580,
        "wires": [
            [
                "ee1d8e40.f6da3",
                "43e4536d.46caec"
            ]
        ]
    },
    {
        "id": "ee1d8e40.f6da3",
        "type": "debug",
        "z": "a1af6fb4.de437",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 620,
        "wires": []
    },
    {
        "id": "43e4536d.46caec",
        "type": "function",
        "z": "a1af6fb4.de437",
        "name": "Format Warehouse Order Select",
        "func": "msg.orderMongoID = msg.payload[0]._id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2450,
        "y": 580,
        "wires": [
            [
                "762336cb.013788"
            ]
        ]
    },
    {
        "id": "50329dfc.45f9d4",
        "type": "mongodb out",
        "z": "a1af6fb4.de437",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Warehouse Order Into MongoDB",
        "collection": "orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 930,
        "y": 740,
        "wires": []
    },
    {
        "id": "bbd9cf50.6236a",
        "type": "mongodb out",
        "z": "a1af6fb4.de437",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Fuel Order Into MongoDB",
        "collection": "Fuel_Orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 890,
        "y": 640,
        "wires": []
    },
    {
        "id": "421fafc0.02b73",
        "type": "mongodb in",
        "z": "f2cbf0d9.c520a",
        "mongodb": "f76d58a.2802ea8",
        "name": "find order if PO exist",
        "collection": "Dispatch_InProgress_Navasota",
        "operation": "find",
        "x": 500,
        "y": 680,
        "wires": [
            [
                "ca191f64.072ec",
                "7e16d2e1.1f63fc"
            ]
        ]
    },
    {
        "id": "ee3fdbf8.0eedb8",
        "type": "mongodb out",
        "z": "f2cbf0d9.c520a",
        "mongodb": "f76d58a.2802ea8",
        "name": "update currently dispatchProcessed to true",
        "collection": "Dispatch_InProgress_Navasota",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "update",
        "x": 990,
        "y": 840,
        "wires": []
    },
    {
        "id": "ca191f64.072ec",
        "type": "debug",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 820,
        "wires": []
    },
    {
        "id": "7e16d2e1.1f63fc",
        "type": "function",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "func": "msg.updateOrder = msg.payload[0];\nmsg.query = {\n    '_id' : msg.payload[0]._id\n};\n\nmsg.updateOrder.dispatchProcessed = true;\nmsg.updateOrder.requestPayload.sales.deliveryDate = new Date().toISOString()\ndelete msg.updateOrder._id;\n\nmsg.payload = msg.updateOrder;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 740,
        "wires": [
            [
                "ee3fdbf8.0eedb8",
                "fa61e2a1.cb4c5",
                "a3666860.26fb88"
            ]
        ]
    },
    {
        "id": "fa61e2a1.cb4c5",
        "type": "debug",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 900,
        "wires": []
    },
    {
        "id": "a3666860.26fb88",
        "type": "function",
        "z": "f2cbf0d9.c520a",
        "name": "",
        "func": "msg.payload = msg.payloadData;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 640,
        "wires": [
            [
                "b7e42f2c.5513e",
                "212ab8c1.91cb28"
            ]
        ]
    },
    {
        "id": "300c6f02.eee6",
        "type": "http in",
        "z": "27eac956.6dc1d6",
        "name": "submitOrderPrimus",
        "url": "/api/submitOrderPrimus",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 490,
        "y": 440,
        "wires": [
            [
                "49be7086.7b19",
                "c3036a3a.27a6f8"
            ]
        ]
    },
    {
        "id": "65392114.e550c",
        "type": "http response",
        "z": "27eac956.6dc1d6",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 1920,
        "y": 660,
        "wires": []
    },
    {
        "id": "5f419815.8ab768",
        "type": "catch",
        "z": "27eac956.6dc1d6",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 2110,
        "y": 480,
        "wires": [
            [
                "1cbaddeb.9b1872"
            ]
        ]
    },
    {
        "id": "f177e596.2d0b88",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Get Order Number ",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 540,
        "wires": [
            [
                "82cb53bb.4d1f3"
            ]
        ]
    },
    {
        "id": "8c4d0245.6a04c",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.payload, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 560,
        "wires": [
            [
                "b8e7a5fb.3a76e8"
            ]
        ]
    },
    {
        "id": "d3e18b5d.e2c2d8",
        "type": "catch",
        "z": "27eac956.6dc1d6",
        "name": "Error - WarehouseOrder",
        "scope": [
            "d04d5084.6307a",
            "8fe918c1.27e1f8",
            "5804260f.e87f48",
            "d2407e0b.8815c",
            "fc3e7cec.f8857",
            "8b20a94b.3258a8"
        ],
        "uncaught": false,
        "x": 2100,
        "y": 520,
        "wires": [
            [
                "3fffda21.fff016"
            ]
        ]
    },
    {
        "id": "82cb53bb.4d1f3",
        "type": "mongodb in",
        "z": "27eac956.6dc1d6",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetOrderNumber",
        "collection": "counter",
        "operation": "find",
        "x": 1210,
        "y": 500,
        "wires": [
            [
                "22982932.0bdbc6",
                "adab69f9.5587e8"
            ]
        ]
    },
    {
        "id": "adab69f9.5587e8",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.payload[0].sequence_value\nlet currentDate = new Date(Date.now());\nlet year = currentDate.getFullYear().toString().slice(2,4);\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = `DJ0F${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.orderNumber = `DJ0W${orderNumber}${year}`\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.order;\nmsg.orderToEmail = msg.order.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 500,
        "wires": [
            [
                "8c4d0245.6a04c"
            ]
        ]
    },
    {
        "id": "3fffda21.fff016",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 520,
        "wires": []
    },
    {
        "id": "d04d5084.6307a",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Generate BlendSheet PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\nfunction createBlendSheet(invoice, path) {\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n  generateHeader(doc);\n  generateCustomerInformation(doc, invoice);\n  generateInvoiceTable(doc, invoice);\n  generateFooter(doc,invoice);\n\n  doc.end();\n  doc.pipe(fs.createWriteStream(path));\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAikAAAD9CAYAAAB5o+cOAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAXxaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDgtMTdUMTM6MTA6MzgtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmVjYzg4MWNjLTMzOGEtMTc0MS05MTE2LWUyOTAxYzNlMjhkOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjg0NWU2OGVkLTNjYTEtODc0Ni1iNWJlLTIyNTMzOTIwMjkyMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODQ1ZTY4ZWQtM2NhMS04NzQ2LWI1YmUtMjI1MzM5MjAyOTIxIiBzdEV2dDp3aGVuPSIyMDIxLTA4LTE3VDEzOjEwOjM4LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgc3RFdnQ6d2hlbj0iMjAyMS0wOC0xN1QxMzoyMDo0OS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgNIh6UAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyMTowODoxNyAxMzoyMDo1MEjTEeYAAEvRSURBVHhe7d0HYBvV/Qfwn7b3zt57kg0BwkgYZYY9W9oCBVpG2f1TdukuUGhLoYy2FCh7tZQZAiEJI4QwEhKyyB6O4z217/7vnV9i2X6y7k53kmx/P8rPfj9ZepLPiu6nG+85FEVRCQAAACDDOMV3AAAAgIyCIgUAAAAyEooUHaItO0QLAAAA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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 150 })\n    .fillColor(\"#444444\")\n    .fontSize(28)\n    .text(\"PRIMUS\", 280, 70)\n    .fontSize(12)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    // .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 150);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop + 15)\n    .text(formatDate(new Date()), 150, customerInformationTop + 15)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop + 30)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop + 30\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop + 45)\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop + 45)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 60)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 60)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 30)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 30)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -15)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -5\n    )\n    \n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop + 40) \n    .text(invoice.origin.address, 380, customerInformationTop + 40)\n\n    .moveDown();\n\n  generateHr(doc, 290);\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Quantity\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description,\n      item.Package,\n      item.Quantity\n    //   formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n//   generateTableRow(\n//     doc,\n//     subtotalPosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     \"Subtotal\",\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n\n  const paidToDatePosition = subtotalPosition + 20;\n  // generateTableRow(\n  //   doc,\n  //   paidToDatePosition,\n  //   \"\",\n  //   \"\",\n  //   \"\",\n  //   \"Paid To Date\",\n  //   \"\",\n  //   formatCurrency(invoice.paid)\n  // );\n\n  const duePosition = paidToDatePosition + 25;\n//   doc.font(\"Helvetica-Bold\");\n//   generateTableRow(\n//     doc,\n//     duePosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     `${sentenceCase(invoice.sales.quoteType)} Total`,\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n//   doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 120, y)\n    .text(package, 300, y)\n    .text(unitCost, 320, y, { width: 90, align: \"right\" })\n    .text(quantity, 370, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\n\ntry{\n   createBlendSheet(msg.payload, msg.blendfilename )\n    msg.order = msg.payload\n    msg.payload = \"New Order Created\"\n    msg.topic = \"TEST - NEW ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.blendfilename), path: msg.blendfilename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1000,
        "y": 920,
        "wires": [
            [
                "8fe918c1.27e1f8"
            ]
        ]
    },
    {
        "id": "8fe918c1.27e1f8",
        "type": "e-mail",
        "z": "27eac956.6dc1d6",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": false,
        "name": "dylan.jackson@kppetro.com,d.lee@kppetro.com",
        "dname": "Send Blendsheet Email",
        "x": 1550,
        "y": 920,
        "wires": []
    },
    {
        "id": "5804260f.e87f48",
        "type": "e-mail",
        "z": "27eac956.6dc1d6",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": false,
        "name": "",
        "dname": "Send Warehouse Confirmation Email",
        "x": 1590,
        "y": 960,
        "wires": []
    },
    {
        "id": "d2407e0b.8815c",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAikAAAD9CAYAAAB5o+cOAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAXxaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDgtMTdUMTM6MTA6MzgtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmVjYzg4MWNjLTMzOGEtMTc0MS05MTE2LWUyOTAxYzNlMjhkOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjg0NWU2OGVkLTNjYTEtODc0Ni1iNWJlLTIyNTMzOTIwMjkyMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODQ1ZTY4ZWQtM2NhMS04NzQ2LWI1YmUtMjI1MzM5MjAyOTIxIiBzdEV2dDp3aGVuPSIyMDIxLTA4LTE3VDEzOjEwOjM4LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgc3RFdnQ6d2hlbj0iMjAyMS0wOC0xN1QxMzoyMDo0OS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgNIh6UAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyMTowODoxNyAxMzoyMDo1MEjTEeYAAEvRSURBVHhe7d0HYBvV/Qfwn7b3zt57kg0BwkgYZYY9W9oCBVpG2f1TdukuUGhLoYy2FCh7tZQZAiEJI4QwEhKyyB6O4z217/7vnV9i2X6y7k53kmx/P8rPfj9ZepLPiu6nG+85FEVRCQAAACDDOMV3AAAAgIyCIgUAAAAyEooUHaItO0QLAAAAUgVFig6h6hXsq9KaAAAAQEqgSNFBCVZRuHalyAAAACAVUKTooEaaKVixWGQAAACQCihSdFDCdRTYs5C3Wq8AAAAA26FI0UEN1ZESrKZQ1TJxDQAAANgNRYoOSqhe++7f+Zr2HQAAAOyHIkWHaLBS+x6q/IjUUI3WBgAAAHuhSElEjewvTFQlQv7db2ptAAAAsBeKlASUQCWpatv0RoFdb4gWAAAA2AlFSgJR/27RahVp2kqR+m9EBgAAAHZBkZKAbEj8QPkC0QIAAAC7oEhJINLcuUgJVrwvWgAAAGAXFCkJRJu3ilabaKCSIg1rRQYAAAB2QJGSQKRpk2i1h4HdAAAA7IUipQtqpImi/gqRtReq+VK0AAAAwA4oUroQadwgWp1FGtaLFgAAANgBRUoXwvXxjztRwg2k+MtFBgAAAFZDkdKFROOhRBo3ihYAAABYDUVKF8J1q0VLLiI58wcAAACsgSIlDiVQTtHAXpHJRSVjqAAAAIA1UKTEEar5SrTik41GCwAAANZAkRJHuOYL0YovGpCfngwAAADJQ5ESR6h6uWjFpwSrRAsAAACshiJFItq0JeHxKJyqREgN1YoMAAAArIQiRSJU9YloJcbHSwEAAADroUiRCFYuFa3E+ND5AAAAYD0UKR2o4QYK134tssSUcKNoAQAAgJVQpHQQ3LuEVDUqMh3UsGgAAACAlVCkdBDcs1C09OEHz8ajtmwXLQAAADAKRUoMvqsnVPO5yHTqYquL2rSFdyoyAAAAMAJFSozAnve63DIi5XCJhoTDSWr9OpEAAACAEShSYgR2vyla+jmcbtGScGaRUq//IFwAAABogyJF4PPwJJr1WMrpFQ0JVsCogSq+iUZcAQAAAHqhSBECO18TLWOc7lzRkhC7gpS6Ndp3AAAA0A9FCqdGyL/rDZEY43Dni1ZnDlGkqI3f4gBaAAAAg1CkMMGKD0gxOQeP0xO/SNm3JUVVwqQ2bNTaAAAAoA+KFMa//SXRMoYfNOvwloisa2rDWtECAAAAPXp9kRJpXE+h2pUiM8bpKxWteFTxnbX8FcQeSGQAAACQSK8vUvxbnxct41xZ/UQrDrWtSOFUVhABAACAPr26SFGClRTY867IjHPlDBateBTxvZXauIl/bU0AAACgS726SGnZ9rzxEWZjuHKGipYcP2A2lhppIfLvEhkAAAB0pdcWKWqkkQI7/iMyc1y5XRcp1KFI4bTTkQEAACChXluktGx9jpRIs8jMceePEa04lJBoxGjexioVjJkCAACQSK8sUtRoC/m3vygyc5zunMTHpEiKFG33UvN2kQEAAEA8vbJIadn6DCnhRpGZ4y4YK1rxacegyDRtEQ0AAACIp9cVKSorTvxbnxOZeZ7CA0SrC9E4RYq/XL4rCAAAAPbrdUVKy5Z/J30sCucpSlykqBG/aLWnqgp2+QAAACTQq4oUJVBBLSaHwI/lcDjJUzxVZF2INImGRPNW0QAAAACZXlWkNH37GKnRoMjMc+ePJoenQGRxKCH2WAGRSAT2YpcPAABAF3pNkRJp3EDBPe+LLDme0gNFKz41XC9actoun5adIgMAAICOek2R0rzxMVYYWDMkva/sYNHqQrhBNLqAIgUAACCuXlGkhKo+oXDtKpElx+nJI0/xdJHFpwZrRKsLgXJ2w6hIAAAAIFbPL1KUELVsfEwkyfPyrSgOl8jiU4PVotUFhRUogQqRAAAAQKweX6T4t71EUX6QqkV8feeKVtfUkI4iheNjpgAAAEAnPbpIUQJ7yL/jVZElz+HKYkXKYSLrmhqsEq0EUKQAAABI9egipWXT46RKZiI2y9fnULbEfCKLTw3VkBrVeXoxHzo/wZlAAAAAvVGPLVLC1SsoXPOVyKyRNfAE0eqaGtgjWjr5Dd4eAACgF+iZRUrUT/5NT4jEGk5vMXnLDhFZ11SjRYfRogYAAKAX6JFFin/b86SEakVmjayBx+k6q4dTjI5/EqhkX6wZwwUAAKCn6HFFSrRhPYX3LhWZdbIHnypaCahRUvn4JwZox83oOWUZAACgF+lZRYoaJv/mf1s2suw+3uJp5ModLrKuqf7drOgwMUCbhadJAwAA9AQ9qkgJ7vwfKTas7LOHnilaiSkmZzdWtV0+AAAAsE+PKVKUpi0U3rNIZNZxZfUhX795IkuMPw9T9I6rAgAA0Ev0jCJFDVNg67OtMwtbLHvIGboPmOVD8Kstu0RijMrHS4k0iwwAAAB6RJES2vkGKQHrt0TwEWa1IkUnvqtHTWbCQBw8CwAAsF+3L1KUpk0UqVomMmtlD55PDk+ByBJTGtaLljl8pFoAAABo1b2LlGiAQttfsfxsHs7hdFPO8PNFpk+0YYNomWTx2C4AAADdWbcuUkK7XiclVCcya2UNOI6cWQNElpjaspPUcKPITApiSwoAAMA+3bZIidaupGjdNyKzlsPhopyRF4pMn2j9atFKgnbgrPUH/wIAAHRH3bJIUUO1FClfKDLr+QYcS66cwSLTJ1qXfJGinZ2U7NYYAACAHqIbFikKRXa9QaoSErm1+LEouaN+JDJ9lJbtrHCqF1mSUKQAAABoul2REt37ESn+CpFZL2vg8ca3otR+JVrJUyMoUgAAALhuVaSoLTtIsbAg6Mjh8lHuqEtFppMapWjdKpFYIOIXDQAAgN6t+xQpSoCi5e/bcrrxPjnDziVnVl+R6ROt/4ZUKwuLaItoAAAA9G7dpkhRKpawYsC+YeOd3kLKGfEDkekXqf5MtKyhRrElBQAAgOsWRYpav46U5h0is0fuyIvJ4c4VmT58hFilcaPILBINigYAAEDvlvlFSqiW1OrPRWIPV84gyh56psj0i1R9av2khmpENAAAAHq3zC5S+Ap779LkJu3TIW/slfyoWZHpxJ5TpHq5SCykhEUDAACgd8vsIqXy4+SHmk/AWzqLfP3miUy/SO0X9jw3mwsyAACA7iJjixS1YR2pTVtEZg8+cFv++OtFZkykYrFoAQAAgB0ys0gJ1ZBa9YlI7JM95Exy5Y0QmX5K07cUbdkpMgAAALBD5hUpaoSU8gWkKvYeQOr0FlPu6EtEZkzYxnmDiBziOwAAQO+WcUWKUvEBqcEakdknb+wV5HDniUw/xb+bog32zL6scXpEAwAAoHfLqCJFqV/DwsYCQPCWTKesQSeLzJhw+Tu2jnqLIgUAAKBVxhQpaqiaorbuRmnlcHopf+JNIjNGDeylSM0XIrMJihQAAABNZhQpaoQiO/5DqhISV9gnZ+QF5ModJjJjgrvftH7wtg4crhzRAgAA6N0yokiJ7H6blECFyOzjZsVJ7kjj8/NwanCvNsKs7dwoUgAAALi0FynR+tUUqV4hMvs4HA7Kn3g9a7jFNcYEd75m+1YUDbakAAAAaNJapKihWgrveFVk9vINPJ48RVNEZozi32XPEPgSDm+haAEAAPRu6StSVIVCW58mNRoQV9gnmTFRuOD2l1OzFYXzoEgBAADg0lakhHe/TtHmHSKzV+6YS0yNicJFG7+lsN1n9Ah8mH4y+TwBAAB6mrQUKdGGtRSuWCQye3lLZpC375EiMy647VnRSgFviWgAAABAyosUNdJIwc1P2jsgmuBw+Sh37E9EZlykZgVFGjaKLAWyykQDAAAAUl6kBDY9Tkq4QWT2yh5+Hjmz+orMIDVKga0p3IrCOHwoUgAAAPZJaZESKn+HInVrRGYvd8FY8g08UWTGBcvfpqh/j8hSJLu/aAAAAEDKihSlZQcFt78kMns5nB7KGXOpyIzTdkltf1lkqeHwFGCMFAAAgBipKVLUCLVseIhUJSyusFfWkNPImT1AZMYFtj5DSqRZZCmSxPMFAADoiVJSpPCVfrR5u8js5cobTt6Bx4vMOH7KcWjP+yJLHUfOINECAAAAzvYiJVK3ioK7XheZvfhunuxRF/JW6xUmtGx8JHUDtwn8eVMOtqQAAADEsrdIifqpef0DKTndmONbUJLZzRMsX0CRxhSecryP9pxTdngQAABAt2DrmrH520dJCVSKzF6u3MGsSPmOyIxTI03k3/KkyFIsd6hoAAAAwD62FSnh6uUULH9XZPZyOFzkG34ea5n/dfybn0jZ+C3tOL1EOB4FAACgE1uKFH4Kb9Pa+0VmP0//eeTMHigy4yIN61hB9Y7IUix3MPuCXT0AAAAd2bJ2bGQFihKsEpm9nNn9yTPgaJGZoCrUvO5PKT9Ydr+8kaIBAAAAsSwvUkLVyymw+y2R2cvhcJJ36BmsZf7XCGx/gSJNW0SWYt4iTCoIAAAQh7VFihKkxm/+IBL7ufscQs5s88dzKP5yatnyb5GlQf4Y0QAAAICOLC1Smr59jKItu0VmL6evlNz95orMnKZ195EaDYostRz8gNm8ESIDAACAjiwrUiKNG8i/7XmR2cvhcJBn0Ems4RLXGMcPlA1VfyayNCgYw56/WyQAAADQkWVFSuOa35OqRERmL1fJ9KSGkVfDddS47k8iSz1+LA0VjBMZAAAAyFhSpAR2vUbh+rUis5fDW0CuvoeLzJzGtfeREqoTWRrw3TyY8RgAAKBLSRcpfKTWpg1/E5n93P2PTmo3SajyQwqkaJA5Gb6rioqmiAwAAADiSbpI0Ya+T9FWCWfheHLkDBGZcWqkmRq/uVtkaZI7nMhTIBIAAACIJ6kiJdq0ifw7XhWZvRzubHL1nSMyc5rWP0DRFM0lJMO3ojiKp4sMAAAAupJUkcIPPk3VwbLOskPYF5/IjAvXrNCOnUknBx9d1lssMgAAAOiK6SIlVPUJhapXiMxejtzBbAWfxJgi0QA1rPkdqaoqrkg9fkaPo2SmyAAAACAR00VK04YHRcteDqebnGWzRWYOf66pGmQuHgc/5dhTKDIAAABIxFSREix/myKNm0RmM34mjDtXJMaFa1eSf8crIksPh9NDjiQLLQAAgN7GeJGiRqnp27+LxF4OXwlR4XiRmcDnElrzm/TNcCw4SqZjXBQAAACDDBcpgd1vULRll8jso40nwg+WJfbdpKaND1OkeYfI0sPhziVnyQyRAQAAgF7GihQ1Ss2bnxCJvbRjOHxlIjMuUr+a/NteEFn6OMsO5pWKyAAAAEAvQ0VKYPfbKTkA1eHKIkfpQSIzQQlRw9e/Tv9uHlZkOQoniQwAAACMMFSktGx5SrTs5ShjBUoSY6LwUXAjzdtElj6ufkeKFgAAABilu0gJ7l2ckhW/I6sPOQoni8y4SP0aatn6nMjSx5k/ihx8CHwAAAAwRXeR4t/6rGjZhx8s6+o7V2QmqGFqWM3P5omKK9KDj+3i7n+UyAAAAMAMXUVKpGE9hWpXisw+zoLxRNkDRGZc87f/oEjTFpGlj6v0YCJPkcgAAADADF1Fin+7/WfJ8K0Prr5HiMw4Xki1bH1aZOnj8BaSq8+hIgMAAACzEhYpaqSRAnveE5l9XCUHEnkKRGaQGm3dzZOiyQ674u5/LKtUcMoxAABAshIWKYFdb7EaICgye/ABz5LZ+tCy5UmKNG4UWfq48ke27rICAACApCUsUvy7/ita9nHzU3VNnnIcbd5KzZseF1n6OBwucg88UWQAAACQrC6LlEjjehabRWYPp6+UXKWzRGaUKnbzhEWePq6+c7TB2wAAAMAaXRYpfFeP3dz9+Km6CTfoSPm3PUfhutUiSx+nt5j9HvNEBgAAAFboojpQKbhnoWjbw5nVl1zFU0VmjOIvp6aNj4osvTyD5+NgWQAAAIvFLVLCtSspGqwWmT08A45lX83Ncty49l5SowGRpY+7aDI588eJDAAAAKwSt0gJVrwvWvZwZg8gV9EUkRkT3PsBBSs/Fln6OFw+8gw+RWQAAABgpfhFyt4PRcse3oEniJZBSpCa1t4vkvTyDDiOHJ5CkQEAAICVpEVKtGkTRf3lIrNeMltRmjc/SdHAXpGljzNnELn7Hi4yAAAAsJq0SLF7V4pXOxbFOCWwh1q2PiOy9HE4nOQbeg5vtV4BAAAAlpMWKaGaFaJlPaevhNylB4rMmKYND2bGwbJ95pAzd5jIAAAAwA6dixQ1TOHaVSKxntfkuCiRhrUUTMEcQok4vYXkHYSDZQEAAOzWqVoI139j29YKhyuLPH0PE5kxTesfJFVVRZY+3qFnEbHfAwAAAOzVuUixcSuKVqC4skWmX6hqGYVqPhdZ+vAxUdzFM0QGAAAAdupcpNR9LVrWa93VY1zzt+kfWZaPiZI14rsiAwAAALt1KlIiDetEy1ruwgnkzB4oMv1ClR9SuH6tyNLHN+gUcnhLRQYAAAB2cyiKsv9ADzVUQ5WLThJZclzuPG3rg8PhJofTQ7kTriNP2aHip/rVfnIhhRvWi8xaTu35edhScGrPUfvO6rb9bf7cHS5y5Q2n3Cl3sXvEP+W48p9PUNOyT0XWzTmd5MrNJWdeHvmGDCbfqJGUO3MGuQryxQ0AAADs165ICVV/SnUrrhVZcmKLFJe3iAoOfow9Glv5G8CPRan7/DqRWU9PkeJk7ZwD7mCFykhxL7lt1/2Mql/5j8h6HofLRTmTJ1HxKSdT6Zmnkau4WPwEAADsokYiFNq1m0LleyhcU0PRhkaKNjdRtKmZlECA1ECQlEiYKBIlNRohla/SFYV9V0QP8TnYB1L+oVTG4WQfyrV1o7gNyx1OF1uNsw/vHg85eWRlkTMnm60f88hdWEjuslLy9u1L3gH94/ZrVLsixb/teWpc9yeRJSe2SMkadDJlj75E/ES/us+uoFDNlyKznp4ixdf/aMoadbG4R3xbe3iREsvp81HpOWfSgKsuJ09/9mK00daf/bxHLtd9//H5f3JXbg65WdHn6d+PskaPptypU6jg0IPJVVQkbm2dltVraO2pZ4rMvPyDZ9PYp58QmT5VL7xEW2++TWT2G3LLTdTvRxeJLPOUP/gw7bzPmvdbPYbefgv1u/AHIkts3fnfp8bln4nMvEn/e5VyJk4QWeb45rSzqWlV8sdgTln4FmWNHCGy5IXKy6nu/Q+o/uNl1Mz+vwa372DFR1T8tHtwZvkoZ9w4yp81kwqPmEOFh83RChsz2pU6keatomUtbz/jw8dH6tfYWqDo4WSFlm8YH1k2MbUXXaLBAO196mlaPfdY2sPeaHmlbxv2n5P33x1D6SKioRBF2aegcF0dBdinpCb2ZlS78H0qf/hR+vbyq+jLGbNpww8uooalH4kFYRFVlT4fo2HmTZN/spP1ZVfsfuAhUpqaxKNnlgj7u+9+6BFSwuy5pij4394I/jeW9WM0jD5uqigK+/0krxujYZWGZZ/Suh9eTF8ecgRtZsV89f9ep8CWLdrWEbYQu1XwLTxNK1dS+T/+yX6nH9HnMw6ibXf+koI7d7GfG9OuSIk2bxct67iy+pIrf5zI9GvZ9pxopY9v6JnkYIUKyEX9ftp597207vSzKcSqfTvI/wv0/FDYCqJu8VJad8EPaf33L9Q+XVlF9nhmwgy+vkpVhGpqtUIgE+36y0MUbmyULlc7wwjZ/c1EZpM9Y6ORnNCePbT+R5fRmnO+S7WLFrPiSZE+SneOcH0D7X78Cfpq3rG04+4/khoOs2v1aV+k+PeIlnXMDN6mBCspWPGByNLDlT2QvAOOEZk+sj9Obwi+yXTNyadSkwWbhjuSPV63CfbFiqhb/CGtPv4Uavos+bGCWHfSxzATRvG7pDrK//EvClekf0LSWPzTZMVT/2Yt2TO2M4yS9WEmMpPsmZqJZFS/8RatPPp4qnn3PWnfPS2iwSDt+OtDtOqUM3RvVYkpUlRWHFj/n9lbdoho6eff/jKpio27EHTIHvE99rVdDdcl2R+kNwWvlNexT/x17y1imYVY57IVZLeI1qdvSYRqa+mbC35IdR8sZllyZP0bDXNkPdkbUX8L7bz/z6ydOXbcc5/2Zi1/xvaFUbI+zEQmkz1fo2FW+T//RRuu+GlatqilO5rWfEOrTj+LAlu3saxr+9fCSrDa8sLA6SsjV/4YkemkRimw63WRpIe7YDy5S2aJTB/pSqqXRdQfpA2XX0WNn1q3RYV1221Dfq35UPx+2viTq8i/LtlT8uX9Gw/jZL3YHRUvvESBzVtYK/1avllLlf99Tfo8UxFGyfowE5lI9jzNhlE1by+gLXf9mhT2xinrrzdEsGIvrb30J6QGQyyLr61ICdWKlnW8ZQeJln7ByqXsU0a1yNIja/h5omWM7A/R24IfMLX+sp9QaPdulllB9ijdI+TXJheRlhZazwpBI/t0O5L1aybMkPVjd/CDG7f94R7WSr9tv787bcccGCXrw0xkKtlzNRNGReobaONNN3cqUHqj5vUbaMdDD4tMztYixVMyU7T0C+x8TbTSw1M8hdyFk0RmVOxLrncG/xquraMNV1zNXlTtz9NXo37R0q/zIyBaNm2miqefZS1zZH2aCaNkfaQqqt56hxq/SO/ZgvUff0I1HyyRPr9UhFGyPswEtLf77//Q3iM74u+evfGy6x//1D7cxrO/SFHD9aJlDYfTTZ6iqSLTRwnVUKhqucjSI2vYuaJljOw/Z2+OBrZCKH/iKdZq43Bls/+cX4hMP1n/vT12P/4k+2qOrD8zYYasn1TF1t/+gX1NH/74/HlAZohdUSZzaX116bfn+Rf237f9pf3rtbdEuKGBqt5+h7Xk2oqUSItoWYPP1UOuLJHpEyxfQKqavkFrPIXjk9iK0nnh9/bYfu/92ngQsSL169gP9R/7JOsXQdSyZQu1rDM+z5asLzPRHdUv/4xqFr4vstSqev1NahQDh8WullJ9MaL1b538JVPtey0nG0Y0rVxFgT0V0n5ij+/rbVHzfvyzeduKlKi1RYqnaIpo6RfYHb+aSoWsoWeLlnFsOSM6BD9qfdcjf2etNu780eTf/orIEpP1213CbvXL0rvV0ajW5ZLey9bf/4E9iVT8dWJEo7T1nntjnkXbaySVYYasH6ORsdiT67iyNBNG1K/4XNqHFuznvTXqP4+/hT2mSAmKljXcBosUxb+bwjbNwKyHK2cQeUoOFJlxsgWfTLjy86n4qHlUdup826P0xBMob/o0cvh80udiJDoqf/Lf7fY3ekpmkH/Hy+zG5g/87C7aVkr2XJpWrxaPZExsH8lczOj4ekl1NG3YSBUvstdfCu3+9zPUsmVr2/NgX9IVRsjubypEf5mGPy8rwoimdeulffDozQI7drL1hLwG2T93T/Omf1Dzt+0/9ZrlcDipz9EL+Yho4prE/Fufocb1D4gsNWLn7skbfzX5BpqfAXrDtTfS3ldeFVlyyk44jsbc+wetUEmlaFMTVTz/Iu348wMUrjN3jJJs5TXu/nup75lniIxVzV/epJ35lT0k8RwyG667kSpe1r/lJZPY/cZTeOAsmvryCyLTp+nr1fTFSaeIzLyiQw6mKc8/IzJ99jz7PK3/v5tFlj6+gQNo9pJFrCj3imvsw08b/3TOXApVVopr0rdCGnPXHTTo4gtFlthXZ59PdRbM7D7r7dcpb9JEkWWOL+afTg1frRSZebMXL6TskV1PQLtPV8vUbOHvLSmh/GlTKXvYUPYhsIScbjdbue3f/mAZPk1CpL6e/Nu2a8ccBvdaO67awYvfky7HtiLl28dYofJP7cpkufOGU8kcY2cf1H56GVsxJj/ZkxH7ihSHJ49KDnuOXeETPzFuw7U3UIUFRQp/oc18bwE5vPa/gcYT2lNBay6+RJtPxijZf7PSo+bRpH/9Q2R8sL4XqYUVpaWHv8SPphXXyq3vzkWKzWujrCGDafbHS0SmDy9SPj/RgiLl0INpqsEipTxDihRu1K0/pyE/uUxk9tl6/59p632ZMZgcipT2Pp9/miVFSryVq8ynRx5FLXHG7DH6dlHACpNRN99ExYcaHzDVClUL3qUNt91BgXJrRqqf+epLVDir8xnBthQpWQNPoIID7hBZYmq4gaoWncje1FN70Oy+IiVr8CmUO+6n4lpz1ltUpAy75qc07IbrRJY+kbp6+vLU08m/xdikk7IVsys3lw5b8xVrtBYk0aYtVP3Rd6lw2m/I1+8o7bp4eJGy56Xki5Shl/9Y+7SRMmxB8PE5Ig0NFKrYq42wWPfJMoo0N4sbJM/Nl+s6Y4U9L1JWWFCkFHfzIsVTVEizP1pC7gL7tlaGq6u1rSgd/+ZmPzEna8xdd9JgA0XKl2efZ0mRcqBWpJg/IcEuKywsUnJ0FikfTp1JoZoakbVn5FVRNHMmzXjhmbR+mOX4+uHT407U5nFL1rQnH6fSeXNF1mb/NiF+yrBVPPmjRUufUPWnKS9QYmUNMr+bZx/+Atu/DzaJ8A0c2NphmrnZm/j4++9jLYf0ecYNdo+Owd+k+b7YfVx5I8jpKSD/thfFNfHJ+jMT+TNnUNmJx6cuTjqB+p46nwZ+/3s0/MbraPLjj9EhX3xKw6+9mv1fs2ZTbLSlhf1y/LfrPlqPZkn/JVRXR9se+Kt4VvbY+qe/ULi5KeZR913avzZTFWbI+jEamUr2XM2EEWH2Xijrw2iMuvn/0l6gcNkjhlO/00+VPkejocQZoLLt3dJhXZHiytNXVe4TqlomWqnnzh9p+PnGI1vwRsOOfYlm5c+YRkVHHiF9nvEiHj4AWSxP0WQK1X5FkcaN4pqez5WTQ8NvuJZG3XErW1bJXxRVMfwJpvXvZMXFnNjXipnwlJWRMztL+jOjsfNfT1LQwtmlY/H99rueflb6uEbDN6A/5Y4bK/2Z0TBCdn8zkclkz9doGMFXxLI+eOjlcLmku0XSpfgg4yPLS0XbD/65T8yWFPPHY3TkZp+UjQjVGB/gyyq+/sZmOu5t+px4vGjpE7sai70Edu4Ut2jlEePRJJqnKbaPZC7G3gbsNfhHF1HW0CH7n1VSETJ+lpS0HxNhlKwPo+EpLaEhl14i/ZnRiAQCtPne+1nLepv+cA9Fu1ghGYlRP7+JnKzAlf3MSBgl68NsQCu1wyjcsWTLTRYOr0crVDKFu7BA+jzNhExbkeLJFa3kOJxecmb1E1liir+cfRq05sAboxwOB3kTHBOhV+wKMdlLJmn9BGfk0vmFxyPS1MS+tnEXtE48GShfwG7Q9a4+WX9GI9Pwg4llz9NwRI1PCirtx0SYIevHaAy78nLy9u0r/ZnR2P3yK9S8wdqteXzQtorX35A+Hg8jCqdNpf5nnCYysJLsb2MmDGHFhawPLVT2/qkjIi1+Csc5riUd8idPpsl/uT/pKJwqH7akrUhx54lWclzZ/UVLH77JP13cBRPJ6SsVWXKkLzoTkWlceXnS52k0oh3OgXfnj9W+K6E6ClV+rLVlZH2ZjUySO26c9Dkaji4+mcUj7cdgpBPfbTbSooPL+WmV3/7O2uHyN/7299rKJJ6OyzJesE9RNPYXrScgyH5uNIyS9WEmMlXHlb/ZMPJLOtxuaR9asJ/rjd2v/Id9zQy+/v1owOmnJR18aACZ/UWK023NUe6ubPkDxROpN36aq1W8/Y4ULWvIXkxGI9Pw8+Jlz9No8OMIYvGtbQ536zg6gYr4Q5XL+jITmcZbZk1xbNVBuKkg+7uYCW7Q+edS7nhrCr29C9+juuWfsVbyqhcvoeqPPpY+zv6QraAk0Xf+SVQ4cwa7h/77dBnaoxsg68NEZKp2f5MkwoiudtsZsfEP91DFm2+JrGdrK1J8JaKVHKevj2jpE05jkeLrM0e0kid70ZmNTNKw6mvpc4wX8bgLCkSrjTtnqPY9VPkRu3P6zu5KB4fHK11+RsPhMn7Au6wfM2GcfCVmNDR8K8Ptt0p/biY2/OZ3rf0maYPYitJlsNslCl7Uj721/enastsZCaNkfZgJaOMp7Pw+uI9s2cWLiN9PX152OS055HD6+prradP9f6btTzxF5f/5L1W++x7VfLKM6r/8ihrXrKGm9Ru0A7kDu8spVFWlDdQZbW7WRnhVI8Z3F6daW5HitahI8RaJlg5sxRRp3CSS1HLnDGZvBINEBvHs+e9roqWP7D8Uj+yhrQVJLFfuEO27Em6kcG38afRl/RmNTMN3M0hXYAbDmWVsEk9teUj6MRNmxP5NzESs0iMOp7J5c6W3Mxq1n39Be7uYiVWP8lf/Qw1rvpH2Hxt6DL/sUsrKkOEIejLZ38dM6OUp6yO9v9lo3rGDdr78Cm344/205tbb6aurrqEVF/2IPj37PPp4/mn04XEn0dKjv0MfzDmCFh10CL03bRYtnDyVFoybRO+MHkdvDx9Nbw8ZQe+MHEsLxkyghRMOoPemzKBFs2bTB7Pn0GJ2vyVHHkUfsj4++s4J9PHxJ9MnrN9lp59Fy9ljrPjeD+jziy6hr664ir6+4We09s5f0kb2XLb/60mqeOtt9v9hTdzh7vVqOybFU6Ad9Josp7dYtBKLNm8nVUnPHC7ePtaO0id7AZmJTFL5zgKqY9W47HnGDcnKjEfu6M6necceYB2Mcxo6u2unvkyF6C9ThOvqOi87g+HweNgyNH5WnqwvM5EJ+NYUq8502PD7u1nFbPwYH04Nh2nj3X8UWddkyzI2fP360YirrmCtNrLbmQkjZPc3E5lK9lzNhBHZQwZL+0hnKOz9MRoKaVtnQo2NFKypIf+eCmrZtYuat22npk2bqWH9Bqr/Zi3VrV5NtWydUPPZCqr6ZBntXbyEKt5dSLtfe512PP8ibfnHP2nj/X+m1bfdQZ9f+hOtSFowfhJ9fNIptPG+P1HzJuMbJdrt0HblDhYt8/gQ83pFmtKzFYXzlFh8njn7a0tXjkZDdJdufPPgmp/9XP4cuwp2347hKS6i3DGtZ/PEcmX1FS0+OucK0WpP1p+ZyDRm/rN2xOfp6E5kfxczEStv7Bga/N3zpLczGk3fbqKdzz7PWsZtf/Lf1MI+1cr6NRpjbvoZubLbz3smu53RMErWh9nIRLLnaSaMyB09StpHa/TMSzQSptqVK2nDfffTB0ceRcvOOY8q31/EfmN92hUpbgsGNXMYmFSQb0lJB+3U4+LpIrOG/EVnPDJBw8pVtPysc7SKWvYcuwqZ4kPkW62c3raDR/mgbmqkUWQ9X+XipdLlZySyBhg7k24fWV9GwyxZX0ajo9E3Xk/u/HzpbY0G/7QXO2u3Hvz0+m///IC0P6NRcMABNOics1irPdltzYRRsj6MRqaKXZEmczGCn2Ybe9/YS29R/fEntPwHF9Kys8+llq3bxLXxpbdIaWk/wFequHKHa7u3oL3Gb9bSNzffSstOOd30pFGxb077YsCp89nXzpzeQtFit1MVCtetFll7sj6NRibZ+84Cql+9Wvo8jUTOqFHsq3GyvsyEUbI+zERH3tJSGnHl5dLbGg1/RQVteaxtMkw9Nj/0sMGCPv5lwl23s1t0FnsbsxejYu+bzAXalMw+iFw++S7a9q+Rnh98d9GS40+kykUfsCy+9rt7DI4UK5VgVttYUf9u0UotT6E9M3LK/hBGw4gaVpGuuvo6+vS0M7UDmj4+/iRT8dHR36H3Jk3VDoza/tTTpPCDOln/VgTf1dPnWPmovh0LxUj9WtFqI+vTTGQEVaWdz79IX/30WulzNBqF081NmCjry0yYEbvyMneRG3Hpjyhr0MCY25m/bHrobxSurRM9d41PV7/5sb/H3DvxJZ4BJ59EJVYNMQ4Jxb6Wkwkj+IHufY4+StoPe3vodRFubKLlF19KVUs/ZEtArl2R4ilI7XTa0cBe0Uotd+EE0bIOW96WhR573niTlp/3Pdr1yqtUs+Jz7ZN5/eo1poIfFBWyaDyUjjHs4ovIGWcirI5b3cIN60SrPVm/RoP/nlWLl6QuPlhMe99dSLtefoU2P/worbr+RnrvoINp5Q03UriFTzKW3IUcRH2Omsd+M2Ni+0j2kkmc7NPp+JtvEllywo2NtPHPfxFZ1/juIXPzJ7UP/vwndDjluCPZ/YyEUbI+zETGYk9OtuI0GkYNZ++Jsn7Yv14Z/KDdFZdfScGKCpZ15lAUhd9uv+rFpyZVPBTNvJ+8ZQeLrGuV7x5JqhISWeoUz36EPEXyIXjNWnnN9doKKVlT/ng3DT73HJHJ+XftoqVHH9dpqPlMELvy8hYV0byPl0rHSOGUYCVbmZ8iMtJGKy494lWRtVp57fW086WXRQb7lB02h2Y/94zI9Kv/+mv68ISTRWZe6aGH0MEvPCcyfXY8+xyt/FlyhUT+uHF05HsLRNbZhyefQnUWTL/PN8nPXfw+ZQ+OfzJB86bNtPjoY0kxONYEXyF1NOaqK7ossj48+VTtrIpkTP7lL2jEjy4SWWIfn3kOVS/7VGTmHfnOm1QwuXWurkyy9KRTqNaC18rRSxZR7ihjh0rwrQd73mn/Os60wj/VBp92Ks188AGRtWm3JYXzFCe58lb1nVKsRprSUqBw7jxz+/K7tu/zZXIXPdb+6jcUbmqMuVfmXGKNu+lncQsUztFh16DCi+M0vSbswJeGHcHn/xj3c/Mre1mfRsOMTp8cTUSiB594x+3S+xmNSCBI6+6+V/Qqt/b3d1M0HJHev8tg940NX58+NObqq1grvo73MRNmyPoxE5mo9blZcTFu2r13swJ4UEwfmbqUUmfXa/+j5i1bRdamc5GS5BYGNarvyPh0ncnh8pWRw23NZIrpwAeL4rt6MtW+N6WS2bNp6Pcv0K6LzyG+t+IHz3Y8mHpff90y2Bc7YsKtt1DRNHPHo3CyPs2EGfxuyUZXSg46kAacdKL0fkZj56v/1f6/ydR+8SWVv/W29H6Jo/1l3P/dSK7crt+TZPczfjHGmsc0+qi9g7ekmOa8+BzljWw7DrR1effeUBSFtj37LGu116lI8ZYeKFrm6C9SmkUrtVw5yY8FIyNb6GajK+vv/aM2+I7sfhkR7Iu3pISmSzbbdSR7A4v6d4mWwG4Su2LsVtH69C0LftzClD/8lkZedgnLzJP1bSaMar1f8pdEJt52szadfex9zFwUJUrf/O73otf21vz6t+z/oRJza/2XWIWTJ9Gw888VGaTSvtdxsmFWztChNPedt2jkJRdrW0dlffe22N1hFxjXqUjhp+canSQwlhrWt4VEiRg72Mwqrhx7hpqWrqRMhPaXioPva9+zYKH0fpkSfM6RWf94jLL6t40mG5fSebhkJdh+CnLWZTcOay58g1P/E46jIxe8RcMu+B7rOTmxfSdzyVT8zX/kRReKLDkViz6gqo/az9Jd8d77VP2p+WM1Yl8jk++8g+/35FcnFHs/M2GUrA9TwYq5TCR9riYiGXxG7wPu+gUd++Fi7TXLt7DIHqO3RMO3myhU034d0KlI4XxJDBmvhGpFKwE1PRMbGZ0A0QjZQjcT8fB95LLbZ0rwAuXAxx6hkgNnsSwxNdq5SIkGq0SrVexKsbtdkpXdvz+N/smP6eili+mgvz9KeaPtOJYqtTq+ZsyEHmOvvZo8Fr3h860m+7FKfA2fRJA3k4wBJxxPZYfqe6+V3d9MGCG7v5lQgpl5nJkSjUifr9GwAi+sp/76l3TSyi9p7mv/oQNuv1U7kLRoygHkKSyUPm5PjdpVq9jXNtIixVuWTJGib3wBPrlgOjh9ZaJlrdiVUzKX1j9TZzXLl1PF4sX7b5dpF09RIR3yzL+p77y54hknxg+e7kjV+/rpBmL/4xmNMT+9kuYtWkiT2JtV7ojh7BpryB7LTJgl68to6OEpKKDx110nvb/RqGFvmrv+9zprEW1/8SWqX7dOejsj4fB6aTL72+ol68NomCHrx2jwU7ozUZQVT7LnazQs5XRSycwZNIZ9ODnowQfoqLfeoPnffE2nbVxHx3+8lOb97z902NNP0uy/PUgz7/kDTb3rTjrglp/TxBuuo/HsPWPsjy+l0ZdcTCO/fwGNOP9cGnb2WTT0jNNoyCkn06ATT6CBxx1LA44+ivrNPYL6HnYo9Tl4NpUeOJNKpk+j4imTqXDCeCoYO4byR42g3CGDKatvH/IWFpDT62FPTvbbWx9Nm7ew7206nYKsUcNU9f4JpJg4bsRXNpsKZ/5JZPGFaz6n2s+6PqLdDoVTf0W+/vLBxZLxxdXX0g4LTkGe/sd7aOh5nfdRf3TmOVS1TD4JX7oVT59OBz78YJena8qEKj+kui9+JrJW2YNOovzJt4mMLddrrqPt3fQU5M7/sYxxut1UMmsWDTn9VBpy5hmd5nMxo+7rr2nR8SeJzLw+hx5Ch71obJ6brc88R1/87P9EZk7BuHF0zPvviqxrfKbphfOOpsZNm8U15uWNGEFHvfOm1l/LruQGoeSvi7FsJcQ/Leu16ORTqebL+DOF6zHtl3fRKAOnIC895zza22FXlxkz77mbhn/3PJFljjemz6TA3uTH6jpuyWLKM3gKcnekhEIUrq+nQFWV9n+ggRXrlWydtPfDj0gJWzdR8NjLLqUpfDeoIN2SQg4PefseIRJjdI8i63SLRmo53PonQDSirQ5MLmQql36ovRhkt09nuHKyaeItN9Ph/33FcIHCyXYNqtH2xyrJHre3RDQS0f7uX9x0M701azZt+vs/2bXJkz2WmTBD1o+RMILPjjz51luk/RiNxi1baMlZ51Ize3OW/dxI+EpLaMK1V7OWEbKezIR+Vn16rl8vH6Qxnfis1YHqasmzNR4Ol3w12tPwQTn56fKFEybQgGOOpnFXXUmH/fspOuGTj6jvnDntjk1MJoIdRnuOu3SzBpjb2hD165vzxcEKoXSw8/RjtnwtiY6+uSezjkXhQzuPvPgiOmbpYhpz5eXaysCMaKDzCIOq0rkilz2H3hbBujr66s5f0CcXX6K9wSZD1r+ZME7Wi5nQb8Bx36E+h/DBJWX9GIvaVXzgL/nPjMTE/7tRmxDRCHlPxsMIh4efISXvx0hULV/OvmaW+vUbSIlEpStJo+Fwp2ddlimyBwygQx//h2UH/YbYe12suEWKt3R2uwng9OIrGSWQuFBxeOzZopGIwykfoj1ZsoVtJjraw88k+PwL6W1TGQ6+6+HAWTT1N7+iEz5fTlN+dRdl9Tc3C+8+il8yDHKHMx1kz6W7hPza5GL3O+/QV7e1bQo1R963sTBO1ouZMErbdOx0SvtKdRSMH08jv2fiDC12Z9kK0kgY5SkolPZjNGpXraamrZ0H6UonvouCPTVLwunTv0759KfX0KLTz5TG+zrjkx9fLnrLHO7cXOo3d650+RiNSKj9gdbyY1KEpnV/opZtxvY7c0Uz70t48K0aqqHKRcnvGzeqdM5T5MobLTLrrLj6WtpmwTEpM/94Dw2POSZl3Z//QvXfdJ54z04O9obOX3TuvDzKHTqU8keNpJJZM7XrrFS3/McUqm1/JHdWv7lUMO13ImPL9ZrraNtLL4mse4n7H8sCRzz3LPU9/DCR6cePSVl4/IkiM6/voYfSEQaPSdnyzLO04sbkjkkpHDeOvrNoocj0++za62nrCy+KLH2OfN7c3+29k06h6iSPSZnOPliM+dHFIkvsq1/8kjY8+pjIkjPi3LPpwPvvE1n6vT3vaG1rihXO2rRB9/Fib889iuo3bBSZObmDB9HJyzPv+MRVv/kdrX3wIZGZ12/OHJr7YtuUG10WKdGmLVT90XdFpl/e2CsoZ8T3RRaHGqXKdw9nlbadb+WdlRz6FLnz7SpSkj/Ac+Yf721XpPRkVYuOJyVUL7JWWQOOpYIpvxQZW7l05yLFxpc2Pyp/7ivGl0vtKuuKlCNfMl6kfGZBkXKciSLFv2cPvXXYERRpSc/4TNzAY4+hw554XGTGLLSgSJlhsEhZ99DfaGXs6ddJcDgcdMjDD9GQ+cnPG5Ws9Q8/Sl/98lciS47T46Gzt+k/MPvtecew4mi9yNrjZ0nq4WYF0Vmbkit07MCX6bqHHxGZef0OO4zmxcwL1uURP668EeQ1MZdPpGmTaHXB4SKHt1gkKWTTqc/85WVF9BZ8csGOBQonO2YodtNxtwr+3G2Kyk+XUyDOrKGJyPozE0bJ+jATZvAxZ/gZNbL+UhH8+I6pMWcsdAd5w4aJVvL4h9FlV/6U1v/tEVKV9Azuxh933d/+Rl/9+tfsb2LNhR+HYYTDzUeWjXdp/5qJF2G/n2pWJj8xotX4QGyy52s0HJ72J9V0uSWFC+x+ixq+bvtkq4c7dwiVHPaCyOKr/eSiuNPz28WOGZC55XxLigWnyh54X+/YkhKqXEp1X3T+VJ074gLKHXulyNhyveY62vpi8ltSxl56CZVMtf7vHg9/Q4wGg9pBYE3btlPVZyvifoIya86jD9Pgk43tMuVbUhZYtCVlnsEtKZst2pJyvIktKVyUvbm/cejh5DdZ3CVj3GWX0rRfmC9S3j1pvgVbUn5JYw1sSeHjwbx1lPXDNeQNHUojzj1H26xfOG6sNliZXYI1tdr/O36W3NZXXqWGTTo+QBtQOm0afefN1jF09Hj35FOo6osvRNZelyviDoadeirN+duDIks/f3k5vTbncIoG9E2L05WhJ51Ihz32qMh0FCl8y0P1ktPZg1eKKxLjm/bK5r3DKqKuj2BvWHkrBfa8L7LU0HO8jBm8SNlqUZEyohcUKc3fPkrNmzpv+s4bdyXlDG+bmPBTi4qUw/75dxp0/HEiS4+9H39My666Rtv1YIXJN1xPk264TmT6pLtIWX5j+3FxjOJFygmL3hOZcVuee54+vf4GkaWGr6SETv74Q22AObMWWFCkzDRYpPBC+6Wx4ynS0iKusR5f+biyssjl85HTbe4swY74Vkw+bgdfYVo5fofM8DNOp0P/mniesn3eP/d82rN0qcjaM1KkcNNvu5UmXpH+g2gDlZX0wQ8vouqvvhLXJGfUeefRwWw9uE/iE7wdLsoedo5I9OGb9iIN8tlDY7lyh4pW6uidW8go/gKzInqLcK38DdeVpWPOn25KO9j0qX8l2OSr/9JSbm5Qsdg+zF7MvFpjX+dmI1n8E3zRxInSvu2KyTden1SBso+sbyNhFD+AvnT6dGlfVkaEFRPB+nryV9dYEoGaGgo1NlKUFSiyx7MyiidNYl/18xQWSPvhYdSXv/4NvXX8CbT+n49rW2f4AGt8y1G4oUEb5deWYH3zAfDq1q6l7a+/Tstv+rm2BcWqAoXLKisVrVa6RqHJHnw6q3KNndkRrk28z8yda90+T72UULVoQdooIQrXyYtYp6+vaO0Tu2o0f8kURexNbeBx39GeUbLB34zNkPVlJsyQ9WM0kuJw0LQ7b5f2a0fwIcZH/+AHrJUcWd9mwqgBR82T9mNVdHd9D54tWvpklcWfO45/uDca1StX0We33kZvnzSfXpl1IL04aTI9P24CPT92vD3B+n5p6nR6/ahjaMmlP6YNTz6lFYSy52Y2cgYNEkukla4ihR/MmD3kdJHpE65JvGnSnT9WtFInGrSnSGGL15JLbxCq+ZxUVqjIdJyluuObWjKRKQYefbT0+RmNcGPnuY8SkfVjNsyQ9WM0ktX/8MNp4DHW/A0SxYw779S2SHRXQ+fP13bf20W2kuoukVVWph2TYgSfD0fWlxbs5wiiwrHt6wLd/3v4KcVGtqZEmzaTGm4QmZwrbzg5XFkiSw2lJbl5N7oiW+BmoqcLVcrnA+Gvr46zVMuWj5nIJEUTxkufo9EImzxWQNaXmejOZtx+O3u92Ts1x6Cjj6IBBibc7ApfhUlXbAaCfRG96cfH5BjIfg9Zf5YEe4zuGiPOOlPbMmcEXwHL+kK0Bh80tLTDCQ66ixSHp4Cyh+ufJEpVlbjHHbRxkqdgvGinRtS/U7SsJVvgZqI3CO5dIlrt8VPeZWTLyWhkkpyB7bcWmRXtMDJjpuOrpE4rKaNh0V+zYMxoGv2978ofw4LgU0XMsPCU446vZ7NhxqSrfyrtqzeH0+ej8ZdewlrG9Jk5g905M0Y/zsQo44OG5uSwVhtD2yFzhn/X0FD54erPRCs+T/FU0UqNSPMO9tX68/RlC9xs9GT8WKVoQD7zqDt/jGj1bN6iIumKzWgoYXNFiqwvo2H2lRr7OjcbVpnysxu1A1plj5FsjPnhD6hgtHWDRsoew2iY1WfWLBp51pnSPntrTGaFW86AAaxlDP+/XzZzprRPIBp55pmi1cZQkeJw5VDuyAtFlli45nP2teuCwFPCKssUUqMBimqFCqRDoPxt0erMU9T5SHnZCtJMZNLbAB+lks8oGvsGZSaUqLliW9aXmTBK1oeZsAo/NZivbGSPkUzwFdHUG60/zVn2WEbDrFm/vKv1eArWtjK6o/6HHkJTr7tWZMaNvUA+d5Ns+fSmyO7bl0adeQZrtWf4iK7soWeTO85m+Y6UcCNF6r4WmZy3eFrKj0uJ2DGAnGTFaCbYF9FhD6QEKVj+rkg68xTKT+eLfSEnE5nEYUWRYnLkTllfZsIMWT9GwmoTLr2EcocOkT6W2Zhyw3VaodKT+IqL6agn/kVeC06ljiVbfpkchWPH0NxHHzV8LEqskWxFzAex69x/777M+sUd0jmQDBcpfNyU/PH6q8h4B0nu5/SSN8VbU8IJCiczOr/gzEVPFihfQEqkWWTtOX0l5ModLrI2smVkJjKOi4+VIn+uRsIoWR9moyfgW7Rm3nKLyJJXOHo0jb/oIpFZR7b8jUayiidMoONeeYmy+pRJ+zcX3edSPJH9/i+9SL7SEvbMzePHKx350IPkzs2J6Z1fZMund8SEiy+ikafLzyA2XqQwntKDtNlq9QjzIkWNiEzO1/cI0UqNUK11A8/Eki18M9FTtWxrmzSqI2/JLNFqT7Z8zESmsfO0zkwm+9sYDasNP/UUKps5Q/pYRmPWnXdoKyGrxa7KzF+SVzJpEs1f8A71O+TgmH6TuXRehpkYY847l05+/X+U3Sf+OCdGFE+cSMc8+SR58vKkj9eb4oArrqCDf/Mb1pIzVaRweRNuIGeCYe85vssnXCOfq2AfHyt4HE57TweMxU+PVkLmBsKKR7bwzURPFar6hCKN8WcL9ZYdJFq9QzQSkf79jYYZsn6Mhhmt903+YoeD7voFqxyTe34DjzyCBh9ztOjRWrHL3mxYJad/fzrh5Zdozr33UBZbacseq6dEEZ91+7ln6bD775fuikgGP7blpP/9T3sM/li9Tf6woXTc0/+mA2+/TVwjZ7pIcfrKKE/nbp/QnvjHIXAOTyH7JD1TZPbjx36EqpaJDFKhedM/Raszh8NFvj6Hiayzjm8cZiOTRAJ+9pySu5j7rWJ7SO5ixr5nnUzYoc/MmTRs/snSx9MTfOvJQXfdxVr2kT2ukbCUw0Fjv/c9OnvZMjr417+m/OHDpY+ZKDJV2QEH0JF/+TOd/v57NOjII8W11iseP45OW/AOTbvmavah36sdktjTo3j8eJpz99101pIlNPioo8SSiM90kcJlDTyRrVwOFVl8kdpVpMQ57XSfrEEni1ZqBCsWi5Y12LK3LHoavhUlXLdaZJ15+MHTrFCVaV0myV8yiRIKdfstKTzMkPVjNOxy4K23aeNfyB4zUYy94AL2iTj1I2inmzsnmyb+6GI6+5OP6aRXXqaJF11IRQZOvZatxNIRDqeLSg+YQlOuvJJOfedtOpUVDqPPPjslowVrx0X9/Od0zicf0eQfX6ad5cKeUo8JXtDyYmzKFVfQKW+8Tmcsep/Gf/8C7ffWI/EsyAkowSqq+fgH7I23VlzTyuXOY58ufOz5udkf2sOKkJMoq6vTl5UQVX0wn5QEo9RahZ9RVDbvTfbdmk14e1esoKbt20VmHv9Elz8s9XMa2UfRXh+RxvhTpOdPvJGyh3Q+P57bseBdqlmbeLLKREbMn08FI0eKLL347KyrH3lEZOb5iopo/A9/KDJ9/JWVtOGZZ0RmXt6QITTqjM6nC3alZs0a2rFwocjMySotpXGsILDL1tdfp3oT0/mP//73tVOa7bLx+ReoubxcZOYMnjuXyqalZlyqYG0t1a5bx5blZmrcsYOad5ez195eCtbVU6i+noINDRRpbqZIMMiKhKRWQe3wosLFVn7u7GxtdmU3D1ZIeXLztDOTPHm57P9NMWWVFGvHl2T37UP57LXMC6uOg4ilU8OWLVS1ejXVbfyWmveUU0vFXgrV1WnLjU/0xydl1GZ5Zh92ohYvQyP48ubL2pObQ77iErZcSyiHLdfcQQOpcMRIKmaFe8nEieTNT3xoSDxJFylcqHo51X9+HVtQbadEdixS+PEr+bP+Qg52fTzNG/5KzVueFpn9Cg+4nXwDk5+2HuLz73iFGr+5R2Sd8ddG2dzXtRGNAaD30bYs8hmL2QqXr3SVaFRrq5JT7PlKUdu6wYJPa+B0ubRdbVqbFSep2PKRifhyU9ly077z5caCf2+N1lW8tn6Oud4obdmLZc6Xtdvn0701JBmWFClc87ePUPOmf4msc5HicHopa9jZ5Bt8mrhFZ0pgD1UvOYstzKi4xl6+0llUOOsBkYHV1FANVX94fpdbx7L6zaOCab8VGQAAQBvLys7c0ZeRl630uxIqf4dVyPFnbnVm9Sdf/8QH0liFj5cSbdoiMrBa47r7E+6+yxpyqmgBAAC0Z+G2MQcVTv0NuXOHiLwzNeKn0O43RSaXO/KHlMoxJAI7XhUtsFJwz3sUKO/6+AN37jBW2M4WGQAAQHuW7sDjxxUUzriPnN74Q0KHK5aQGqoWWWeuvFHk62vfKV8dBfcs1HZLgHWUYCU1fnO3yOLLHna2aAEAAHRm+VFGrpzBVDTjXnK45WfNqEqYgttfEplc7pifEB87IxX48/F3MRIqGKRGqf6rWxPu5nH6Sik7xaedAwBA92LLodDuwkmUP+UucrjkR/7ycVOiDWtF1pkrdxhlDZ4vMvsFdr2pffqH5DWtu0/X3Eg5w8/nlYrIAAAAOrOlSOE8xdMpb/Jt2lk9MqEdr/CDVETWWd6YH+sadt8K2taULkZEBX38256nlu3s75qA01tM2UOMjbEBAAC9j21FCucpnkF5B9xODnfnQXKUQCWF98Q/sNLhKdLOGEqV4N6lFKlbJTIwKlixiJrW/0VkXcsddbFlg+gBAEDPZWuRwrmLDqC8KXdpU/F3FOEH0Qb2iKyz7KFnkqdossjs17zhQVY9hUQGevFh7xtW3dluML94+Nlf2UPkU3IDAADEsr1I4Vy5w1mh8ity5Y8S17Tig7aFtFOA440n56CCybfG3WVktai/nPxbnhQZ6KGNNvzVLdouMz3yxl3D/qypOSgaAAC6t5QUKZzDW0S5k24hb7+54ppWSstOilYtF1lnWoEz5scis19w1xsUqf1SZNAVvoun/osbSY0GxDVd8/U9nLx95ogMAACgaykrUjR8Sv7h51M2P8U4Zq6WSMX7RF2cspo9/LvkLT1QZPbiEzW1rH+A1GCVuAZk/NteoIaVt+veguJ051D+hOtFBgAAkFhqixTBVXQA5Uy6mdxlB5HD4WSfxIMU2bNA/FSucMovyJXVV2T2UsKN1Lz2Xj4qmbgG9lOj1MSWDR/y3sgcS7ljr9SmPQAAANArLUWKxpVN3iFnko+tvFwFYyjasIHUps3ih505vCVUOP0P2qSFqRBp2kIt6//KWumZAjsTKcEqqvvsCmrZ/rK4Rh8+pxNOOQYAAKMsmwU5WWqgnJTGTeTSjlmIP3dPsPxtql91l8iS49Rmafawh+PTf4vvrG7b33a4yddvHmWNvkTco/cKVX5EDWt+ywoVY1MIOL2FVHLoU+T09RHXAAAA6JMxRYoRzRv/Rs2bkz8LR0+Rwofn9/Y/irJGXiju1buo0RZqWvdn8u98TVyjH58osnD6PThYFgAATEnf7p4k5I65nLIGHicy+4UqPqDApr+zVuJxQHoSPvlizdJzTRUoXM7wC1CgAACAad1yS4pGjVLd59dSqHqFuMI4vVtSWn/u1uYkymYFErmyRA89U7R5m3ZgbKjqU3GNcb6yg6lw5n2sFX/XHQAAQFe6b5HC8F0RdcuvpHDDOnGNMUaLFFadkCtnIGWPvpQc2QNbO+lB1EgzNW9+XJuDR1Xiz6uUiDt3GBUf/HdyuPPENQAAAMZ16yKFU8MNVPvZFRRp3CSu0c9MkcK/O91Z5B18Brl7yq4MNUL+7a+wAuVfpIRqxZXmOH2lVHLwY+TMGiCuAQAAMKfbFymcylastcsvp0jzNnGNPmaLFD62Cx+Yjs9L5B16pjYZYrekRimw+y1q2fo0W3Y7Wc6PuTF/3I3TnUtFBz1I7vxx4hoAAADzekSRwmljeKz4KUWatoprEku2SNF+7s4hT/9jWreq8Nt2A2rUT8Hdb1Jgx38o4i/XJgbURo5NokhxuLOpaOb95CmaKq4BAABITo8pUjg1XMcKlWso3LBBXNM1K4oU7Tu7zuktIXf/o8lVzFfSmXmwqOLfRYHdb1OwfAEp4SZtS4qqRpIuUvgAe0XT7yFPiqYuAACA3qFHFSmcGmmius+vo3DdanFNfFYWKfx+vO3M6kOusoNYsTKN5ayfdIsGKFS9jEIViynClomi8KIk0lqQWFCk8Dl5+FgonpIZ4hoAAABr9LgiRaMEqX7VHRSsWCKukLOjSNFux37udOWSs3ACuYomE6X4TCB+lk6kbiWFq7/QZnRWon6tAOFn7PD5dqwqUpyeAiqa+UdyF7LfEQAAwGI9s0jRqNpIqS3bnhd5Z3YWKbxffjvel8OdT868EeTIG9ZasDgtnn8oGqBo8xaKNm6kSP1aUpq2kcIKNV58EC9MKGp5keJiv0fRzPvIlct+JwAAABv04CKllX/Hy6xY+ZO2gu4oVUUKe6TW+7C208lu4y0h4nPZeIuJPAV8YBG+1mfBi5c4x7OwgoIizdop1/xsJiW4lxQ/i5ZdpAQqWosNVmhohQkvOlTRtqFI8RROpKIZ97T+HgAAADbp8UUKF65dSfUrb2Ur9mpxTat0FCnadfvup/Xjbi0cWAHhYAWCyq7b9wfRCitebET8pESD7Jq2YmJ/EbKvwBA/s7tIyR54AuVP+jn7XbziGgAAAHuwtWTP5ymeSiWHPE4efnxIBlNVVSsWeFGihpu0g4C1Nism0o0XW/kTrqP8A+5AgQIAACnRK4oUzunrQ8WzH6HcUReTtnUEdHPnDGbL7jHKHnqOuAYAAMB+vaZIaeWk3NGXUtGBD5IrG8O265E9eD4VH/oEuQswiiwAAKRWLytSWmm7f+Y8TdlDzmg9LgQ6cWX11c7eyZ90CzlcOeJaAACA1Om1a2iHK5tyx11NBTPvJ3fecHEt8AN/c4Z/l0oOe468ZYeIawEAAFKv129GcBdOpMKD/ka5Y35MTk++uLZ38pYdSCWH/Ivyxv1UK+IAAADSqVecgqwXH6k1sO15Cu15Tzs1N9WnIGunBGunEou2OFV4/89tOgWZD8iWO/oSbDkBAICMgiJFQg3VUGDHyxTe+yFL2OLRio2eV6Tws3ayR5xP3r5z2f0BAAAyC4qULvBiJVT+DoX4HEBspd9TihR34TjKGnwqtpwAAEBGQ5GiR9RP4cqlFNr7EanBKlFcdK8ihT8PT+ls8g34DrnyR/PfCgAAIKOhSDFIadpEkaplFKlfw4qX0P7CJBOLFNYgV94o8vQ5pHWrCQ6GBQCAbgRFilmscIg2rKdo/WqtcKFwS0YUKaxTVpiMJlfRZPKUTMckgAAA0G2hSLGI6t/NipXNpPJZif27WM0QbS1IbC5SHPyS1Ydc+aPImTeydVeOk8+mDAAA0L2hSLFLqJrUwF5SgzWszSLcSBQNsB+opooU/p3cOeTwFmpbRxw+FtkDyJk9UOsDAACgp0GRkmrRltZiRQmx78HW4oMXI9qWEpVdGK148RC5WDh9rAbJYQVKHv8B/ykAAECvgCIFAAAAMhDR/wMvqNgFGCzfHQAAAABJRU5ErkJggg==\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 150 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"PRIMUS\", 280, 57)\n    .fontSize(12)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Order Created'\n    msg.topic = \"TEST - NEW ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 980,
        "y": 960,
        "wires": [
            [
                "95d1b3e6.05675"
            ]
        ]
    },
    {
        "id": "fc3e7cec.f8857",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Format Warehouse Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\ninvoiceData.items.items = invoiceData.items.items.map(item => {\n    if(item.Package.packName){\n        let package = item.Package.packName;\n        item.Package = package\n    }\n    return item;\n    \n})\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 880,
        "wires": [
            [
                "8b20a94b.3258a8",
                "312fe48d.30e51c"
            ]
        ]
    },
    {
        "id": "8b20a94b.3258a8",
        "type": "mongodb out",
        "z": "27eac956.6dc1d6",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Warehouse Order Into MongoDB",
        "collection": "orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 1330,
        "y": 880,
        "wires": []
    },
    {
        "id": "312fe48d.30e51c",
        "type": "delay",
        "z": "27eac956.6dc1d6",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1680,
        "y": 780,
        "wires": [
            [
                "65392114.e550c"
            ]
        ]
    },
    {
        "id": "22982932.0bdbc6",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Format Counter Update",
        "func": "let count = msg.payload[0].sequence_value\nmsg.query = {_id: 'orderid'}\nmsg.payload = { $set: {sequence_value: Number(count) + 1}};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1450,
        "y": 440,
        "wires": [
            [
                "cb7969b1.d1e248"
            ]
        ]
    },
    {
        "id": "cb7969b1.d1e248",
        "type": "mongodb out",
        "z": "27eac956.6dc1d6",
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Order Counter",
        "collection": "counter",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 1720,
        "y": 440,
        "wires": []
    },
    {
        "id": "1cbaddeb.9b1872",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 480,
        "wires": []
    },
    {
        "id": "49be7086.7b19",
        "type": "switch",
        "z": "27eac956.6dc1d6",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 690,
        "y": 580,
        "wires": [
            [
                "f177e596.2d0b88"
            ],
            [
                "c205900.e5a467"
            ]
        ]
    },
    {
        "id": "c205900.e5a467",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 660,
        "wires": [
            [
                "65392114.e550c"
            ]
        ]
    },
    {
        "id": "b8e7a5fb.3a76e8",
        "type": "switch",
        "z": "27eac956.6dc1d6",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 710,
        "y": 680,
        "wires": [
            [
                "c48a4ce0.d74d",
                "23ddd23b.f75bae"
            ],
            [
                "d04d5084.6307a",
                "fc3e7cec.f8857",
                "d2407e0b.8815c"
            ],
            [
                "c205900.e5a467"
            ]
        ]
    },
    {
        "id": "c48a4ce0.d74d",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAikAAAD9CAYAAAB5o+cOAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAXxaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDgtMTdUMTM6MTA6MzgtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmVjYzg4MWNjLTMzOGEtMTc0MS05MTE2LWUyOTAxYzNlMjhkOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjg0NWU2OGVkLTNjYTEtODc0Ni1iNWJlLTIyNTMzOTIwMjkyMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODQ1ZTY4ZWQtM2NhMS04NzQ2LWI1YmUtMjI1MzM5MjAyOTIxIiBzdEV2dDp3aGVuPSIyMDIxLTA4LTE3VDEzOjEwOjM4LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgc3RFdnQ6d2hlbj0iMjAyMS0wOC0xN1QxMzoyMDo0OS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgNIh6UAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyMTowODoxNyAxMzoyMDo1MEjTEeYAAEvRSURBVHhe7d0HYBvV/Qfwn7b3zt57kg0BwkgYZYY9W9oCBVpG2f1TdukuUGhLoYy2FCh7tZQZAiEJI4QwEhKyyB6O4z217/7vnV9i2X6y7k53kmx/P8rPfj9ZepLPiu6nG+85FEVRCQAAACDDOMV3AAAAgIyCIgUAAAAyEooUHaItO0QLAAAA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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 150 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"PRIMUS\", 280, 57)\n    .fontSize(12)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = 'New Fuel Order Created'\n    msg.topic = \"TEST - NEW FUEL ORDER CREATED\"\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 990,
        "y": 740,
        "wires": [
            [
                "4a27e304.6fc48c"
            ]
        ]
    },
    {
        "id": "fada1d0d.74ba",
        "type": "e-mail",
        "z": "27eac956.6dc1d6",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Fuel Confirmation Email",
        "x": 1570,
        "y": 740,
        "wires": []
    },
    {
        "id": "23ddd23b.f75bae",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Format Fuel Order Insert",
        "func": "let invoiceData = msg.order\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet insertObject = {\n\t\tPO: msg.orderNumber,\n\t\tsalesmanFirstName: invoiceData.sales.firstname, \n\t\tsalesmanLastName: invoiceData.sales.lastname, \n\t\trequestPayload: invoiceData, \n\t\tTotalAmount: getInvoiceTotal(invoiceData.items.items), \n\t\tcreatedDate: new Date(Date.now())\n\t}\nmsg.payload = insertObject;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 780,
        "wires": [
            [
                "e607a07e.19ffe",
                "312fe48d.30e51c"
            ]
        ]
    },
    {
        "id": "e607a07e.19ffe",
        "type": "mongodb out",
        "z": "27eac956.6dc1d6",
        "mongodb": "f76d58a.2802ea8",
        "name": "Insert Fuel Order Into MongoDB",
        "collection": "Fuel_Orders",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 1290,
        "y": 800,
        "wires": []
    },
    {
        "id": "3936dffa.a067f",
        "type": "catch",
        "z": "27eac956.6dc1d6",
        "name": "Error - FuelOrder",
        "scope": [
            "c48a4ce0.d74d",
            "fada1d0d.74ba",
            "23ddd23b.f75bae",
            "e607a07e.19ffe"
        ],
        "uncaught": false,
        "x": 2120,
        "y": 560,
        "wires": [
            [
                "5e2ac302.d97b5c"
            ]
        ]
    },
    {
        "id": "5e2ac302.d97b5c",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 560,
        "wires": []
    },
    {
        "id": "95d1b3e6.05675",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\n\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1240,
        "y": 960,
        "wires": [
            [
                "5804260f.e87f48"
            ]
        ]
    },
    {
        "id": "4a27e304.6fc48c",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1260,
        "y": 740,
        "wires": [
            [
                "fada1d0d.74ba"
            ]
        ]
    },
    {
        "id": "c3036a3a.27a6f8",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 420,
        "wires": []
    },
    {
        "id": "7d3025e8.aca0bc",
        "type": "http in",
        "z": "27eac956.6dc1d6",
        "name": "editOrderPrimus",
        "url": "/api/editOrderPrimus",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 480,
        "y": 1180,
        "wires": [
            [
                "67c328e7.1a4ee8",
                "8e6a361a.74b7f8"
            ]
        ]
    },
    {
        "id": "c8905ced.7e081",
        "type": "http response",
        "z": "27eac956.6dc1d6",
        "name": "Send Response",
        "statusCode": "",
        "headers": {},
        "x": 2140,
        "y": 1500,
        "wires": []
    },
    {
        "id": "46c235e7.7d69cc",
        "type": "catch",
        "z": "27eac956.6dc1d6",
        "name": "Error - SubmitOrder",
        "scope": null,
        "uncaught": false,
        "x": 2110,
        "y": 1220,
        "wires": [
            [
                "81a41c2c.5caaa"
            ]
        ]
    },
    {
        "id": "b0e77e7d.b9b91",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "GeneratePDFImputFormat",
        "func": "\nlet VolumeLookup = [\n    {item: \"TOTE\", volume: 1},\n    {item: \"PAIL\", volume: 1},\n    {item: \"THD\", volume: 1},\n    {item: \"12/1qt\", volume:1},\n    {item: \"6/1qt\", volume: 1},\n    {item: \"4/1gl\", volume: 1},\n    {item: \"BULK\", volume: 1},\n    {item: \"3/1gl\", volume: 1},\n    {item: \"6/1gl\", volume: 1},\n    {item: \"4/1g\", volume: 1},\n    {item: \"Tubes\", volume: 1},\n    {item: \"EA\", volume: 1},\n    {item: \"CASE\", volume: 1}\n\n]\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n        // let result = VolumeLookup.filter(package => \n        //     package.item ==  currentItem.Package\n        // )\n        // if(result.length > 0){\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n\n        // } else {\n        //     console.log(\"Could not find an item to lookup\");\n        // }\n    }\n\n    return total\n\n}\n\nlet formatpdfinput = (invoice, PurchaseOrderNumber) => {\n\n  let invoiceInput = {\n      sales:{\n        firstname: invoice.sales.firstname,\n        lastname:  invoice.sales.lastname,\n        email:     invoice.sales.email,\n        quoteType: invoice.sales.quoteType || 'Order'\n      },\n      desiredShipDate: invoice.sales.deliveryDate,\n      shipping: {\n        name: invoice.destination.Customer,\n        customerID: invoice.destination.CustomerID,\n        address: invoice.destination.Address1,\n        city: invoice.destination.City,\n        state: invoice.destination.State,\n        country: \"US\",\n        postal_code: invoice.destination.ZipCode\n      },\n      origin:{\n        name: \"Ship From:\",\n        address:invoice.origin.OriginAddress,\n        city:\"\",\n        state:\"\",\n        country:\"\",\n        postal_code: \"\"\n      },\n      items: [\n      ],\n      subtotal: parseFloat(getInvoiceTotal(invoice.items.items)),\n      paid: 0,\n      invoice_nr: invoice.items.PurchaseOrderNumber || 0,\n      sequenceNumber: msg.orderNumber,\n      notes:invoice.items.notes.substring(0, 254)\n    };\n\n\n    let InvoiceItems = invoice.items.items;\n    let invoiceTotal = 0;\n    for(let index in InvoiceItems){\n        let currentItem = InvoiceItems[index];\n        let itemObj = {\n          Description: \"\",\n          ID: \"0\",\n          Package: \"TOTE\",\n          PackageID: 1,\n          Quantity: \"0\",\n          amount: 0.0,\n        }\n\n        itemObj.Description = currentItem.Description;\n        itemObj.ID = currentItem.ID;\n        itemObj.Package = currentItem.Package.packName;\n        itemObj.PackageID = currentItem.PackageID;\n        itemObj.Quantity = currentItem.Quantity;\n        itemObj.amount = parseFloat(currentItem.PricePerGal)\n        invoiceInput.items.push(itemObj);\n\n    }\nreturn invoiceInput;\n}\nmsg.payload = formatpdfinput(msg.order, msg.orderNumber)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 1420,
        "wires": [
            [
                "970d9e33.5b107",
                "65498552.f1dfbc"
            ]
        ]
    },
    {
        "id": "c57cb066.ed84d",
        "type": "catch",
        "z": "27eac956.6dc1d6",
        "name": "Error - WarehouseOrder",
        "scope": [
            "158c5d73.a89c83",
            "5af8e095.c3493",
            "b4f2a1f7.5784d",
            "c9c6ea4f.cff118",
            "84c4ef00.8f4ac",
            "ea5d12f4.ecb19"
        ],
        "uncaught": false,
        "x": 2100,
        "y": 1260,
        "wires": [
            [
                "5fb94d4.59367b4"
            ]
        ]
    },
    {
        "id": "a9288bb9.bdd628",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Format Order Number",
        "func": "let orderNumber = msg.orderNumber\n\nif(msg.req.headers.ordertype === 'fuel'){\n    msg.orderNumber = orderNumber\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Fuel_Order.pdf`\n} else {\n    msg.orderNumber = orderNumber\n    msg.filename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order.pdf`\n}\n\nmsg.blendfilename = `/root/.node-red/storage/${msg.orderNumber}_Warehouse_Order_BlendSheet.pdf`\nmsg.payload = msg.order;\nmsg.orderToEmail = msg.order.items.customerEmail\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1340,
        "wires": [
            [
                "b0e77e7d.b9b91"
            ]
        ]
    },
    {
        "id": "5fb94d4.59367b4",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 1260,
        "wires": []
    },
    {
        "id": "158c5d73.a89c83",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Generate BlendSheet PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\nfunction createBlendSheet(invoice, path) {\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n  generateHeader(doc);\n  generateCustomerInformation(doc, invoice);\n  generateInvoiceTable(doc, invoice);\n  generateFooter(doc,invoice);\n\n  doc.end();\n  doc.pipe(fs.createWriteStream(path));\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAikAAAD9CAYAAAB5o+cOAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAXxaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDgtMTdUMTM6MTA6MzgtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmVjYzg4MWNjLTMzOGEtMTc0MS05MTE2LWUyOTAxYzNlMjhkOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjg0NWU2OGVkLTNjYTEtODc0Ni1iNWJlLTIyNTMzOTIwMjkyMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODQ1ZTY4ZWQtM2NhMS04NzQ2LWI1YmUtMjI1MzM5MjAyOTIxIiBzdEV2dDp3aGVuPSIyMDIxLTA4LTE3VDEzOjEwOjM4LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgc3RFdnQ6d2hlbj0iMjAyMS0wOC0xN1QxMzoyMDo0OS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgNIh6UAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyMTowODoxNyAxMzoyMDo1MEjTEeYAAEvRSURBVHhe7d0HYBvV/Qfwn7b3zt57kg0BwkgYZYY9W9oCBVpG2f1TdukuUGhLoYy2FCh7tZQZAiEJI4QwEhKyyB6O4z217/7vnV9i2X6y7k53kmx/P8rPfj9ZepLPiu6nG+85FEVRCQAAACDDOMV3AAAAgIyCIgUAAAAyEooUHaItO0QLAAAA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mCC\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 75 })\n    .fillColor(\"#444444\")\n    .fontSize(28)\n    .text(\"PRIMUS\", 280, 70)\n    .fontSize(10)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    // .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 150);\n\n  const customerInformationTop = 200;\n  let dateString = msg.order.sales.deliveryDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop + 15)\n    .text(formatDate(new Date()), 150, customerInformationTop + 15)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop + 30)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop + 30\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop + 45)\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop + 45)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 60)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 60)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 30)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 30)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -15)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -5\n    )\n    \n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop + 40) \n    .text(invoice.origin.address, 380, customerInformationTop + 40)\n\n    .moveDown();\n\n  generateHr(doc, 290);\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Quantity\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description,\n      item.Package,\n      item.Quantity\n    //   formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n//   generateTableRow(\n//     doc,\n//     subtotalPosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     \"Subtotal\",\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n\n  const paidToDatePosition = subtotalPosition + 20;\n  // generateTableRow(\n  //   doc,\n  //   paidToDatePosition,\n  //   \"\",\n  //   \"\",\n  //   \"\",\n  //   \"Paid To Date\",\n  //   \"\",\n  //   formatCurrency(invoice.paid)\n  // );\n\n  const duePosition = paidToDatePosition + 25;\n//   doc.font(\"Helvetica-Bold\");\n//   generateTableRow(\n//     doc,\n//     duePosition,\n//     \"\",\n//     \"\",\n//     \"\",\n//     `${sentenceCase(invoice.sales.quoteType)} Total`,\n//     \"\",\n//     formatCurrency(invoice.subtotal)\n//   );\n//   doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 120, y)\n    .text(package, 300, y)\n    .text(unitCost, 320, y, { width: 90, align: \"right\" })\n    .text(quantity, 370, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\n\ntry{\n   createBlendSheet(msg.payload, msg.blendfilename )\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.blendfilename), path: msg.blendfilename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1020,
        "y": 1640,
        "wires": [
            [
                "5af8e095.c3493"
            ]
        ]
    },
    {
        "id": "5af8e095.c3493",
        "type": "e-mail",
        "z": "27eac956.6dc1d6",
        "d": true,
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "dylan.jackson@kppetro.com,d.lee@kppetro.com",
        "dname": "Send Blendsheet Email",
        "x": 1530,
        "y": 1640,
        "wires": []
    },
    {
        "id": "b4f2a1f7.5784d",
        "type": "e-mail",
        "z": "27eac956.6dc1d6",
        "d": true,
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Warehouse Confirmation Email",
        "x": 1590,
        "y": 1700,
        "wires": []
    },
    {
        "id": "c9c6ea4f.cff118",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Generate Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAikAAAD9CAYAAAB5o+cOAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAXxaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDgtMTdUMTM6MTA6MzgtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmVjYzg4MWNjLTMzOGEtMTc0MS05MTE2LWUyOTAxYzNlMjhkOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjg0NWU2OGVkLTNjYTEtODc0Ni1iNWJlLTIyNTMzOTIwMjkyMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODQ1ZTY4ZWQtM2NhMS04NzQ2LWI1YmUtMjI1MzM5MjAyOTIxIiBzdEV2dDp3aGVuPSIyMDIxLTA4LTE3VDEzOjEwOjM4LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgc3RFdnQ6d2hlbj0iMjAyMS0wOC0xN1QxMzoyMDo0OS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgNIh6UAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyMTowODoxNyAxMzoyMDo1MEjTEeYAAEvRSURBVHhe7d0HYBvV/Qfwn7b3zt57kg0BwkgYZYY9W9oCBVpG2f1TdukuUGhLoYy2FCh7tZQZAiEJI4QwEhKyyB6O4z217/7vnV9i2X6y7k53kmx/P8rPfj9ZepLPiu6nG+85FEVRCQAAACDDOMV3AAAAgIyCIgUAAAAyEooUHaItO0QLAAAA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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 150 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"PRIMUS\", 280, 57)\n    .fontSize(12)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 980,
        "y": 1700,
        "wires": [
            [
                "39c378c5.7863c8"
            ]
        ]
    },
    {
        "id": "96848bd7.cb78f8",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Format Order Update",
        "func": "let orderId = msg.payload[0]._id\nmsg.query = {_id: orderId }\nmsg.payload = { $set: {'requestPayload': msg.order}};\nmsg.newOrder = msg.payload\nmsg.newOrder.requestPayload = msg.order\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2340,
        "y": 1000,
        "wires": [
            [
                "2cffabc.1899454",
                "a9288bb9.bdd628"
            ]
        ]
    },
    {
        "id": "2cffabc.1899454",
        "type": "mongodb out",
        "z": "27eac956.6dc1d6",
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Order",
        "collection": "order",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 2680,
        "y": 1020,
        "wires": []
    },
    {
        "id": "81a41c2c.5caaa",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 1220,
        "wires": []
    },
    {
        "id": "8e6a361a.74b7f8",
        "type": "switch",
        "z": "27eac956.6dc1d6",
        "name": "Check If OrderType Exists in headers",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 730,
        "y": 1180,
        "wires": [
            [
                "5af9ce21.9c282"
            ],
            [
                "1ee020.a17cefe"
            ]
        ]
    },
    {
        "id": "1ee020.a17cefe",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "No OrderType",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: \"True\",\n    Message: \"Please supply orderType - Fuel Or Warehouse, and the orderNumber\"\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1520,
        "y": 1400,
        "wires": [
            [
                "c8905ced.7e081"
            ]
        ]
    },
    {
        "id": "970d9e33.5b107",
        "type": "switch",
        "z": "27eac956.6dc1d6",
        "name": "",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 710,
        "y": 1420,
        "wires": [
            [
                "e60ae4e2.4d97d8"
            ],
            [
                "158c5d73.a89c83",
                "c9c6ea4f.cff118"
            ],
            [
                "1ee020.a17cefe"
            ]
        ]
    },
    {
        "id": "e60ae4e2.4d97d8",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Generate Fuel Order PDF",
        "func": "const PDFDocument = pdfkit\n\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nlet getLineItemTotal = (package, amount,quantity) => {\n    let total = 0;\n    let currentItemTotal =  quantity * amount\n    total+= currentItemTotal\n    return total\n\n}\n\n\n// To Capitalize first character in a string and lowercase the rest\n// EX ORDER => Order\nconst sentenceCase = (str) => str[0].toUpperCase() + str.slice(1).toLowerCase();\n\nfunction createInvoice(invoice, path) {\n  console.log(invoice);\n  let doc = new PDFDocument({ size: \"A4\", margin: 50 });\n\n  let PDFPages = [];\n  var notes = \"\";\n  while(invoice.items.length) {\n      console.log(invoice.notes);\n      let invoiceInput = {\n        sales:{\n          firstname: invoice.sales.firstname,\n          lastname:  invoice.sales.lastname,\n          email:     invoice.sales.email,\n          quoteType: invoice.sales.quoteType\n        },\n        desiredShipDate: invoice.desiredShipDate,\n        shipping: {\n          name: invoice.shipping.name,\n          customerID:invoice.shipping.customerID, // Replace with KP Customer ID\n          address: invoice.shipping.address,\n          city: invoice.shipping.city,\n          state: invoice.shipping.state,\n          country: invoice.shipping.country,\n          postal_code: ''\n        },\n        origin:{\n          name: invoice.origin.name,\n          address: invoice.origin.address,\n          city:invoice.origin.city,\n          state:invoice.origin.state,\n          country: invoice.origin.country,\n          postal_code: invoice.origin.postal_code\n        },\n        items: invoice.items.splice(0,10),\n        subtotal: invoice.subtotal,\n        paid: invoice.paid,\n        invoice_nr: invoice.invoice_nr,\n        sequenceNumber: msg.orderNumber,\n        notes: invoice.notes.substring(0, 254)\n      };\n      console.log(invoiceInput);\n      PDFPages.push(invoiceInput);\n  }\n  if(PDFPages.length == 1){\n    generateHeader(doc);\n    generateCustomerInformation(doc, PDFPages[0]);\n    generateInvoiceTable(doc, PDFPages[0]);\n    generateFooter(doc,PDFPages[0]);\n    console.log(PDFPages[0]);\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  } else {\n    for(let pdfPage in PDFPages){\n        console.log(pdfPage);\n        if(pdfPage == 0){\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        } else {\n          doc.addPage();\n          generateHeader(doc);\n          generateCustomerInformation(doc, PDFPages[pdfPage]);\n          generateInvoiceTable(doc, PDFPages[pdfPage]);\n          generateFooter(doc,PDFPages[pdfPage]);\n        }\n    }\n    doc.end();\n    doc.pipe(fs.createWriteStream(path));\n  }\n}\n\nfunction generateHeader(doc) {\n  let imagePath = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAikAAAD9CAYAAAB5o+cOAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAXxaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChXaW5kb3dzKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDgtMTdUMTM6MTA6MzgtMDU6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA4LTE3VDEzOjIwOjQ5LTA1OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmVjYzg4MWNjLTMzOGEtMTc0MS05MTE2LWUyOTAxYzNlMjhkOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjg0NWU2OGVkLTNjYTEtODc0Ni1iNWJlLTIyNTMzOTIwMjkyMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODQ1ZTY4ZWQtM2NhMS04NzQ2LWI1YmUtMjI1MzM5MjAyOTIxIiBzdEV2dDp3aGVuPSIyMDIxLTA4LTE3VDEzOjEwOjM4LTA1OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjkxOTM2ZmVkLWZmYjYtNjE0MC1hN2U0LTRhNTUzOGUyZmI4OSIgc3RFdnQ6d2hlbj0iMjAyMS0wOC0xN1QxMzoyMDo0OS0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgNIh6UAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyMTowODoxNyAxMzoyMDo1MEjTEeYAAEvRSURBVHhe7d0HYBvV/Qfwn7b3zt57kg0BwkgYZYY9W9oCBVpG2f1TdukuUGhLoYy2FCh7tZQZAiEJI4QwEhKyyB6O4z217/7vnV9i2X6y7k53kmx/P8rPfj9ZepLPiu6nG+85FEVRCQAAACDDOMV3AAAAgIyCIgUAAAAyEooUHaItO0QLAAAA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\"//__dirname + \"/KP_LOGO5.png\";\n  doc\n    .image(new Buffer(imagePath.replace('data:image/png;base64,',''), 'base64'), 50, 45, { width: 150 })\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(\"PRIMUS\", 280, 57)\n    .fontSize(12)\n    // Move text(origin.name) and text(origin.address) to below horizontal line\n    // .text(origin.name, 200, 50, { align: \"right\" })\n    // .text(origin.address, 200, 65, { align: \"right\" })\n    // .text(`${origin.city}, ${origin.state}, ${origin.postal_code}`, 200, 80, { align: \"right\" })\n    .moveDown();\n}\n\nfunction generateCustomerInformation(doc, invoice) {\n  doc\n    .fillColor(\"#444444\")\n    .fontSize(20)\n    .text(invoice.sales.quoteType, 280, 100);\n\n  generateHr(doc, 140);\n\n  const customerInformationTop = 200;\n  let dateString = invoice.desiredShipDate;\n  let newDatestring = dateString.substr(0, dateString.indexOf('T'))\n  let dateArr = newDatestring.split(\"-\")\n  let newMonth = dateArr[1];\n  let newDay = dateArr[2];\n  let newYear = dateArr[0];\n  let newDesiredShipDate = `${newMonth}/${newDay}/${newYear}`;\n  doc\n    .fontSize(10)\n    .text(\"PO Number:\", 50, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.invoice_nr, 150, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(`${sentenceCase(invoice.sales.quoteType)} Date:`, 50, customerInformationTop - 30 )\n    .text(formatDate(new Date()), 150, customerInformationTop  -30)\n    .text(\"Desired Ship Date:\", 50, customerInformationTop -15)\n    .text(\n      newDesiredShipDate,\n      150,\n      customerInformationTop -15\n    )\n    .text(\"Salesman Name:\", 50, customerInformationTop )\n    .text(`${invoice.sales.firstname} ${invoice.sales.lastname}`, 150, customerInformationTop)\n    .text(\"Salesman Email:\", 50, customerInformationTop + 15)\n    .text(`${invoice.sales.email}`, 150, customerInformationTop + 15)\n\n    .text(\"Ship To:\", 320, customerInformationTop - 47)\n    .font(\"Helvetica-Bold\")\n    .text(invoice.shipping.name, 380, customerInformationTop - 47)\n    .font(\"Helvetica\")\n    .text(invoice.shipping.address, 380, customerInformationTop -30)\n    .text(\n      invoice.shipping.city +\n        \", \" +\n        invoice.shipping.state +\n        \", \" +\n        invoice.shipping.country,\n      380,\n      customerInformationTop -15\n    )\n    // TODO - generateHr here\n    .text('Ship From:', 320, customerInformationTop+10 ) \n    .text(invoice.origin.address, 380, customerInformationTop+10 )\n    .font(\"Helvetica-Bold\")\n    .text('Notes', 280, customerInformationTop +35 ) \n    .text(invoice.notes, 75, customerInformationTop + 50 )\n    .font(\"Helvetica\")\n    .moveDown();\n  generateHr(doc, 320);\n\n}\n\nfunction generateInvoiceTable(doc, invoice) {\n  let i;\n  const invoiceTableTop = 330;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    invoiceTableTop,\n    \"Item\",\n    \"Description\",\n    \"Package\",\n    \"Price Per Unit\",\n    \"Quantity\",\n    \"Line Total\"\n  );\n  generateHr(doc, invoiceTableTop + 20);\n  doc.font(\"Helvetica\");\n\n  for (i = 0; i < invoice.items.length; i++) {\n    const item = invoice.items[i];\n\n\n    const position = invoiceTableTop + (i + 1) * 30;\n    generateTableRow(\n      doc,\n      position,\n      item.ID,\n      item.Description.slice(0, 40), // Only pull first 40 characters of item description\n      item.Package,\n      formatCurrency(item.amount ),\n      item.Quantity,\n      formatCurrency(getLineItemTotal(item.Package,item.amount,item.Quantity))\n    );\n\n    generateHr(doc, position + 20);\n  }\n\n  const subtotalPosition = invoiceTableTop + (i + 1) * 30;\n  generateTableRow(\n    doc,\n    subtotalPosition,\n    \"\",\n    \"\",\n    \"\",\n    \"Subtotal\",\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n\n  const paidToDatePosition = subtotalPosition + 20;\n\n  const duePosition = paidToDatePosition + 25;\n  doc.font(\"Helvetica-Bold\");\n  generateTableRow(\n    doc,\n    duePosition,\n    \"\",\n    \"\",\n    \"\",\n    `${sentenceCase(invoice.sales.quoteType)} Total`,\n    \"\",\n    formatCurrency(invoice.subtotal)\n  );\n  doc.font(\"Helvetica\");\n}\n\nfunction generateFooter(doc,invoice) {\n  let footerString =  `Please contact ithelp@kolkhorst.com for assistance. - Sequence Number: ${invoice.sequenceNumber}`\n  doc\n    .fontSize(10)\n    .text(\n      footerString,\n      50,\n      780,\n      { align: \"center\", width: 500 }\n    );\n}\n\nfunction generateTableRow(\n  doc,\n  y,\n  item,\n  description,\n  package,\n  unitCost,\n  quantity,\n  lineTotal\n) {\n  doc\n    .fontSize(10)\n    .text(item, 50, y)\n    .text(description, 100, y)\n    .text(package, 330, y)\n    .text(unitCost, 350, y, { width: 90, align: \"right\" })\n    .text(quantity, 400, y, { width: 90, align: \"right\" })\n    .text(lineTotal, 0, y, { align: \"right\" });\n}\n\nfunction generateHr(doc, y) {\n  doc\n    .strokeColor(\"#aaaaaa\")\n    .lineWidth(1)\n    .moveTo(50, y)\n    .lineTo(550, y)\n    .stroke();\n}\n\nfunction formatCurrency(cents) {\n  return \"$\" + (cents).toFixed(2);\n}\n\nfunction formatDate(date) {\n  const day = date.getDate();\n  const month = date.getMonth() + 1;\n  const year = date.getFullYear();\n  return `${month}/${day}/${year}`\n}\ntry{\n    createInvoice(msg.payload, msg.filename)\n    msg.order = msg.payload\n    msg.payload = `TEST - Order ${msg.orderNumber} Updated`\n    msg.topic = `TEST - Order ${msg.orderNumber} Updated`\n    msg.attachments = [{filename: path.basename(msg.filename), path: msg.filename}]\n    return msg;\n}catch(Error){\n    node.error(Error);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 990,
        "y": 1480,
        "wires": [
            [
                "2d415363.0ad68c"
            ]
        ]
    },
    {
        "id": "61005a20.ad3034",
        "type": "e-mail",
        "z": "27eac956.6dc1d6",
        "server": "smtp-mail.outlook.com",
        "port": "587",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "Send Fuel Confirmation Email",
        "x": 1570,
        "y": 1480,
        "wires": []
    },
    {
        "id": "fe0428f2.1fa728",
        "type": "catch",
        "z": "27eac956.6dc1d6",
        "name": "Error - FuelOrder",
        "scope": [
            "e60ae4e2.4d97d8",
            "61005a20.ad3034",
            "d508b47e.991e08",
            "314de6b9.2891da"
        ],
        "uncaught": false,
        "x": 2120,
        "y": 1300,
        "wires": [
            [
                "a59e6e75.8f07c"
            ]
        ]
    },
    {
        "id": "a59e6e75.8f07c",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2330,
        "y": 1300,
        "wires": []
    },
    {
        "id": "39c378c5.7863c8",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.OriginAddress)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\n\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1240,
        "y": 1700,
        "wires": [
            [
                "b4f2a1f7.5784d",
                "a2886b23.8148a8"
            ]
        ]
    },
    {
        "id": "2d415363.0ad68c",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Pull Email Distro List",
        "func": "let getEmailFromAddress = (origin) => {\n    let emails = ''\n\n  if(origin.includes(\"4 Plaza Loreto Esquina\")){\n        emails = 'J.Marsell@kppetro.com, c.madriz@kppetro.com, W.Vega@kppetro.com,k.stutts@kppetro.com,dylan.jackson@kppetro.com';\n    }else if(origin.includes(\"1558 N Lasalle ST\")){\n        emails = 'L.Chilton@kppetro.com,J.Acosta@kppetro.com,G.Rybarski@kppetro.com,mark@kppetro.com,f.zaragoza@kppetro.com,t.holmwood@kppetro.com,dylan.jackson@kppetro.com'\n    }else if (origin.includes(\"5002 E Harrison Ave\")){\n        emails = 'J.Ontiveros@kppetro.com,C.Ruiz@kppetro.com,c.guel@kppetro.com,v.mendoza@kppetro.com,dylan.jackson@kppetro.com'\n    }\n\t\t\n\treturn emails;\n\t}\n\nlet emails = getEmailFromAddress(msg.order.origin.OriginAddress || msg.order.origin.address)\nmsg.to = `dylan.jackson@kppetro.com,d.lee@kppetro.com, ${msg.order.sales.email}` // emails\nmsg.cc = 'dylan.jackson@kppetro.com'\nif(msg.orderToEmail){\n\tmsg.to += `,${msg.orderToEmail}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "pdfkit",
                "module": "pdfkit"
            },
            {
                "var": "path",
                "module": "path"
            },
            {
                "var": "fs",
                "module": "fs"
            }
        ],
        "x": 1260,
        "y": 1480,
        "wires": [
            [
                "61005a20.ad3034",
                "a2886b23.8148a8"
            ]
        ]
    },
    {
        "id": "67c328e7.1a4ee8",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 1100,
        "wires": []
    },
    {
        "id": "5af9ce21.9c282",
        "type": "switch",
        "z": "27eac956.6dc1d6",
        "name": "Check If OrderNumber Exists in headers",
        "property": "req.headers.ordernumber",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1120,
        "y": 1160,
        "wires": [
            [
                "b46fcb12.f5f6e8"
            ],
            [
                "1ee020.a17cefe"
            ]
        ]
    },
    {
        "id": "b46fcb12.f5f6e8",
        "type": "switch",
        "z": "27eac956.6dc1d6",
        "name": "Switch On Order Type",
        "property": "req.headers.ordertype",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fuel",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "warehouse",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1400,
        "y": 1120,
        "wires": [
            [
                "73f17dd8.df97c4"
            ],
            [
                "98c49abf.4569e8"
            ],
            [
                "1ee020.a17cefe"
            ]
        ]
    },
    {
        "id": "2bb73d8b.16e872",
        "type": "mongodb in",
        "z": "27eac956.6dc1d6",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetFuelOrderByOrderNumber",
        "collection": "Fuel_Orders",
        "operation": "find",
        "x": 1950,
        "y": 1020,
        "wires": [
            [
                "96848bd7.cb78f8"
            ]
        ]
    },
    {
        "id": "73f17dd8.df97c4",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Get Order Number Fuel",
        "func": "let orderNumber = msg.req.headers.ordernumber\nmsg.orderNo = orderNumber;\nmsg.order = msg.payload;\nmsg.payload = {\"PO\": orderNumber };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1670,
        "y": 1040,
        "wires": [
            [
                "2bb73d8b.16e872"
            ]
        ]
    },
    {
        "id": "b45a93d8.85a4d",
        "type": "mongodb in",
        "z": "27eac956.6dc1d6",
        "mongodb": "f76d58a.2802ea8",
        "name": "GetWarehouseOrderByOrderNumber",
        "collection": "orders",
        "operation": "find",
        "x": 1970,
        "y": 1120,
        "wires": [
            [
                "8272275e.55fe78"
            ]
        ]
    },
    {
        "id": "98c49abf.4569e8",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Get Order Number Warehouse",
        "func": "let orderNumber = msg.req.headers.ordernumber;\nmsg.orderNo = orderNumber;\nmsg.order = msg.payload;\nmsg.orderNumber = orderNumber;\nmsg.payload = {\"PO\": orderNumber };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 1120,
        "wires": [
            [
                "b45a93d8.85a4d"
            ]
        ]
    },
    {
        "id": "8272275e.55fe78",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Format Order Update",
        "func": "msg.query = {\"PO\": msg.orderNumber };\nmsg.newOrder = msg.payload[0]\nmsg.newOrder.requestPayload = msg.order\nlet getInvoiceTotal = (data) => {\n    let items = data;\n    let total = 0;\n    for(let item in items){\n        let currentItem = items[item];\n            let currentItemTotal = currentItem.Quantity * currentItem.PricePerGal\n            total+= currentItemTotal\n    }\n\n    return total\n\n}\n\nmsg.payload = { $set: {'requestPayload': msg.order, 'TotalAmount': getInvoiceTotal(msg.order.items.items)}};                  \nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2280,
        "y": 1100,
        "wires": [
            [
                "b16bbd58.08afd",
                "a9288bb9.bdd628",
                "8efc230b.3082b"
            ]
        ]
    },
    {
        "id": "b16bbd58.08afd",
        "type": "mongodb out",
        "z": "27eac956.6dc1d6",
        "mongodb": "f76d58a.2802ea8",
        "name": "Update Order",
        "collection": "orders",
        "payonly": true,
        "upsert": false,
        "multi": true,
        "operation": "update",
        "x": 2580,
        "y": 1100,
        "wires": []
    },
    {
        "id": "a2886b23.8148a8",
        "type": "function",
        "z": "27eac956.6dc1d6",
        "name": "Format Response",
        "func": "let order = msg.payload\nmsg.order = order\nmsg.orderType = \"Warehouse\"\nmsg.payload = {\n    Error: false,\n    Message: \"Order updated Properly\",\n    Order: msg.newOrder,\n    orderNumber: msg.orderNumber\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1704,
        "y": 1572,
        "wires": [
            [
                "6eea1cfa.a49c84"
            ]
        ]
    },
    {
        "id": "6eea1cfa.a49c84",
        "type": "delay",
        "z": "27eac956.6dc1d6",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1980,
        "y": 1560,
        "wires": [
            [
                "c8905ced.7e081"
            ]
        ]
    },
    {
        "id": "65498552.f1dfbc",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 1580,
        "wires": []
    },
    {
        "id": "8efc230b.3082b",
        "type": "debug",
        "z": "27eac956.6dc1d6",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2470,
        "y": 1160,
        "wires": []
    },
    {
        "id": "cf2d78ac.be6908",
        "type": "inject",
        "z": "20a6f2ef.da319e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 60,
        "y": 420,
        "wires": [
            [
                "84a500a0.f3664"
            ]
        ]
    },
    {
        "id": "e3f45a83.6d30e8",
        "type": "http in",
        "z": "fbbd1ed9.96d06",
        "name": "get all fuel costs",
        "url": "/margin/getAllFuelCosts1",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 380,
        "y": 300,
        "wires": [
            [
                "58252793.4341a8"
            ]
        ]
    },
    {
        "id": "729c86d6.390098",
        "type": "debug",
        "z": "fbbd1ed9.96d06",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 240,
        "wires": []
    },
    {
        "id": "58252793.4341a8",
        "type": "function",
        "z": "fbbd1ed9.96d06",
        "name": "prepare for mongo entry",
        "func": "\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 300,
        "wires": [
            [
                "5e22f225.41b9ac"
            ]
        ]
    },
    {
        "id": "16c9ae79.c96b32",
        "type": "http response",
        "z": "fbbd1ed9.96d06",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1110,
        "y": 300,
        "wires": []
    },
    {
        "id": "5aa49429.35d0cc",
        "type": "comment",
        "z": "fbbd1ed9.96d06",
        "name": "Get All Fuel Costs",
        "info": "",
        "x": 610,
        "y": 240,
        "wires": []
    },
    {
        "id": "5e22f225.41b9ac",
        "type": "mongodb in",
        "z": "fbbd1ed9.96d06",
        "mongodb": "66e7a294.1f543c",
        "name": "",
        "collection": "Fuel_Costs",
        "operation": "find",
        "x": 900,
        "y": 260,
        "wires": [
            [
                "729c86d6.390098",
                "16c9ae79.c96b32"
            ]
        ]
    }
]